!function(window,undefined){var create=function(_,$){var conbo={VERSION:"1.1.7",_:_,$:$,toString:function(){return"[Conbo "+this.VERSION+"]"}};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){return _.indexOf(this,a,b)}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){return _.each(this,a,b)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(a){return _.has(this,a)}),conbo.Class=function(){this.initialize.apply(this,arguments)},conbo.Class.prototype={initialize:function(){},callLater:function(a){return _.defer(this.bind.apply(this,[a].concat(_.rest(arguments)))),this},callSuper:function(a){return this._super[a]?this._super[a].apply(this,_.rest(arguments)):undefined},defineProperty:function(a,b,c,d){if(!("defineProperty"in Object))throw new Error("Object.defineProperty is not supported by the current browser");return b=b||function(){return this["_"+a]},c=c||function(b){this["_"+a]=b},Object.defineProperty(this,a,{enumerable:!0,configurable:!0,get:b,set:c}),d!==undefined&&(this[a]=d),this},defineAccessor:function(a,b,c,d){return b=b||function(){return this["_"+a]},c=c||function(b){return this["_"+a]=b,this},this[a]=function(){return(arguments.length?c:b).apply(this,arguments)},d!==undefined&&this[a](d),this},bind:function(a){return _.bind.apply(_,[a,this].concat(_.rest(arguments)))},bindAll:function(){return _.bindAll.apply(_,[this].concat(_.toArray(arguments))),this},toString:function(){return"conbo.Class"}},conbo.Class.extend=function(a,b){var c,d=this;c=a&&_.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},_.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&_.extend(c.prototype,a),c.prototype._super=d.prototype,c},conbo.Injectable=conbo.Class.extend({constructor:function(a){this._inject(a),this.initialize.apply(this,arguments)},toString:function(){return"conbo.Injectable"},_inject:function(a){return a||(a={}),this.defineAccessor("context",undefined,undefined,_.result(this,"context")||a.context),this.context()&&this.context().injectSingletons(this),this}}),conbo.Event=conbo.Injectable.extend({constructor:function(a){if(_.isString(a)?this.type=a:_.defaults(this,a),!this.type)throw new Error("Invalid or undefined event type");this.initialize.apply(this,arguments)},initialize:function(){},clone:function(){return _.clone(this)},preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.cancelBubble=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,this.stopPropagation()},toString:function(){return"conbo.Event"}},{ALL:"all",all:function(a){var b=[];for(var c in this)_.isString(this[c])&&this[c]!=this.ALL&&b.push(this[c]);return a?b:b.join(" ")}}),conbo.ConboEvent=conbo.Event.extend({initialize:function(a,b){_.defaults(this,b)},toString:function(){return"conbo.ConboEvent"}},{ERROR:"error",INVALID:"invalid",CHANGE:"change",ADD:"add",REMOVE:"remove",DESTROY:"destroy",RESET:"reset",SORT:"sort",REQUEST:"request",SYNC:"sync",ROUTE:"route",ALL:"all"}),conbo.EventDispatcher=conbo.Injectable.extend({trigger:function(a){if(!a)throw new Error("Event undefined");if(!_.isString(a)&&a instanceof conbo.Event||(a=new conbo.Event(a)),!this._queue||!(a.type in this._queue)&&!this._queue.all)return this;a.target||(a.target=this),a.currentTarget=this;var b=_.union(this._queue[a.type]||[],this._queue.all||[]);if(!b||!b.length)return this;for(var c=0,d=b.length;d>c;++c){var e=b[c],f=e.handler.call(e.scope||this,a);if(e.once&&this._off(a.type,e.handler,e.scope),f===!1||a.immediatePropagationStopped)break}return this},on:function(a,b,c,d){if(!a)throw new Error("Event type undefined");if(!b||!_.isFunction(b))throw new Error("Event handler is undefined or not a function");return _.isString(a)&&(a=a.split(" ")),_.isArray(a)?_.each(a,function(a){this._on(a,b,c,d,!1)},this):_.each(a,function(a,b){this._on(b,a,c,d,!1)},this),this},one:function(a,b,c,d){if(!a)throw new Error("Event type undefined");if(!b||!_.isFunction(b))throw new Error("Event handler is undefined or not a function");return _.isString(a)&&(a=a.split(" ")),_.isArray(a)?_.each(a,function(a){this._on(a,b,c,d,!0)},this):_.each(a,function(a,b){this._on(b,a,c,d,!0)},this),this},off:function(a,b){if(!arguments.length)return this._queue={},this;if(!a)throw new Error("Event type undefined");if(2==arguments.length&&!b)return this;var c=arguments;return _.isString(a)&&(a=a.split(" ")),_.isArray(a)?_.each(a,function(){this._off.apply(this,c)},this):_.each(a,function(){this._off.apply(this,c)},this),this},toString:function(){return"conbo.EventDispatcher"},dispatchEvent:function(){this.trigger.apply(this,arguments)},addEventListener:function(){this.on.apply(this,arguments)},removeEventListener:function(){this.off.apply(this,arguments)},_on:function(a,b,c,d,e){"*"==a&&(a="all"),this._queue||(this._queue={}),this._off(a,b,c),a in this._queue||(this._queue[a]=[]),this._queue[a].push({handler:b,scope:c,once:e,priority:d||0}),this._queue[a].sort(function(a,b){return b.priority-a.priority})},_off:function(a,b,c){if(!(this._queue&&a in this._queue))return this;var d=this._queue[a];if(1==arguments.length)return delete this._queue[a],this;var e;for(e=0;e<d.length;e++)d[e].handler!=b&&d[e].handler||d[e].scope!=c&&d[e].scope||d.splice(e--,1);return this}}),conbo.Bindable=conbo.EventDispatcher.extend({get:function(a){var b=_.result(this,"_attributes");return _.result(b,a)},set:function(a,b,c){if(_.isObject(a))return _.each(a,function(a,b){this.set(b,a,c)},this),this;var d=_.result(this,"_attributes"),e=!1;if(c||(c={silent:!1}),c.unset?(e=_.has(d,a),delete d[a]):_.isFunction(d[a])?d[a]()!==b&&(d[a](b),e=!0):d[a]!=b&&(d[a]=b,e=!0),e&&!c.silent){var c={attribute:a,value:b,options:c};this.trigger(new conbo.ConboEvent("change:"+a,c)),this.trigger(new conbo.ConboEvent(conbo.ConboEvent.CHANGE,c))}return this},unset:function(a,b){return b=_.defaults({unset:!0},b),this.set(a,undefined,b)},toString:function(){return"conbo.Bindable"},_attributes:function(){return this}}),conbo.Context=conbo.EventDispatcher.extend({constructor:function(a){return a=a||{},this._commands={},this._singletons={},this.defineAccessor("app",undefined,undefined,a.app),this.on(conbo.Event.ALL,this._allHandler),this.initialize.apply(this,arguments),this},initialize:function(){},mapCommand:function(a,b){if(!a)throw new Error("eventType cannot be undefined");if(!b)throw new Error("commandClass cannot be undefined");if(!(this._mapMulti(a,b,this.mapCommand)||this._commands[a]&&-1!=this._commands[a].indexOf(b)))return this._commands[a]=this._commands[a]||[],this._commands[a].push(b),this},unmapCommand:function(a,b){if(!a)throw new Error("eventType cannot be undefined");if(!this._mapMulti(a,b,this.unmapCommand)){if(b===undefined)return void delete this._commands[a];if(this._commands[a]){var c=this._commands[a].indexOf(b);if(-1!=c)return this._commands[a].splice(c,1),this}}},mapSingleton:function(a,b){if(!a)throw new Error("propertyName cannot be undefined");if(!b)throw new Error("singletonClass cannot be undefined");if(!this._mapMulti(a,b,this.mapSingleton))return this._singletons[a]=_.isFunction(b)?new b(arguments[2],arguments[3],arguments[4]):b,this},unmapSingleton:function(a){if(!a)throw new Error("propertyName cannot be undefined");if(!this._mapMulti(a,null,this.unmapSingleton)&&this._singletons[a])return delete this._singletons[a],this},addTo:function(a){return _.extend(a||{},{context:this})},injectSingletons:function(a){for(var b in a)a[b]===undefined&&this._singletons.hasOwnProperty(b)&&(a[b]=this._singletons[b]);return this},toString:function(){return"conbo.Context"},_allHandler:function(a){var b=_.union(this._commands.all||[],this._commands[a.type]||[]);b.length&&_.each(b,function(b){this._executeCommand(b,a)},this)},_executeCommand:function(a,b){var c,d;return d={event:b},c=new a(this.addTo(d)),c.execute(),c=null,this},_mapMulti:function(a,b,c){if(_.isArray(a)||-1==a.indexOf(" "))return!1;var d=_.isArray(a)?a:a.split(" ");return _.each(d,function(a){c(a,b)},this),!0}}),conbo.Hash=conbo.Bindable.extend({constructor:function(a,b){this._inject(b),this._attributes=_.defaults({},a,_.result(this,"defaults")),this.initialize.apply(this,arguments)},toJSON:function(){return _.clone(this._attributes)},toString:function(){return"conbo.Hash"}});var hashMethods=["keys","values","pairs","invert","pick","omit","size"];_.each(hashMethods,function(a){_.has(_,a)&&(conbo.Hash.prototype[a]=function(){return _[a].apply(_,[this._attributes].concat(_.rest(arguments)))})}),conbo.BindingUtils=conbo.Class.extend({},{bindElement:function(a,b,c,d){if(!(a instanceof conbo.Bindable))throw new Error("Source is not Bindable");return d=d||function(a){return"undefined"==typeof a?"":String(a)},$(c).each(function(c,e){var f=$(e),g=f[0].tagName;switch(g){case"INPUT":case"SELECT":case"TEXTAREA":var h=(f.attr("type")||g).toLowerCase();switch(h){case"checkbox":return f.prop("checked",Boolean(a.get(b))),a.on("change:"+b,function(a){f.prop("checked",Boolean(a.value))}),void f.on("input change",function(){a.set(b,f.is(":checked"))});case"radio":f.val()==a.get(b)&&f.prop("checked",!0),a.on("change:"+b,function(a){f.val()==a.value&&f.prop("checked",!0)});break;default:f.val(a.get(b)),a.on("change:"+b,function(a){f.val()!=a.value&&f.val(a.value)})}f.on("input change",function(){a.set(b,f.val()||f.html())});break;default:f.html(d(a.get(b))),a.on("change:"+b,function(a){var b=d(a.value);f.html(b)})}}),this},bindProperty:function(a,b,c,d,e){if(!(a instanceof conbo.Bindable))throw new Error("Source is not Bindable");return d||(d=b),a.on("change:"+b,function(a){return c instanceof conbo.Bindable?void c.set(d,a.value):void(c[d]=a.value)}),e&&c instanceof conbo.Bindable&&this.bindProperty(c,d,a,b),this},bindSetter:function(a,b,c){if(!(a instanceof conbo.Bindable))throw new Error("Source is not Bindable");if(!_.isFunction(c)){if(!c||!_.has(c,b))throw new Error("Invalid setter function");c=c[b]}return a.on("change:"+b,function(a){c(a.value)}),this},toString:function(){return"conbo.BindingUtils"}});var delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];return conbo.$.fn.cbData=function(){for(var a={},b=this.get()[0].attributes,c=0,d=0;d<b.length;++d)0==b[d].name.indexOf("cb-")&&(a[b[d].name.substr(3)]=b[d].value,++c);return c?a:undefined},conbo.$.expr[":"].cbAttr=function(a,b,c){var d=conbo.$(a),e=c[3].split(","),f=d.cbData();return f?f&&!e.length?!0:e[0]&&!e[1]?f.hasOwnProperty(e[0]):e[0]&&e[1]?f[e[0]]==e[1]:!1:!1},conbo.View=conbo.Bindable.extend({constructor:function(a){a=_.clone(a)||{},this.cid=_.uniqueId("view"),this._addStyle(),this._configure(a),this._ensureElement(),this._inject(a),this.initialize.apply(this,arguments);var b=a.templateUrl||_.result(this,"templateUrl"),c=a.template||_.result(this,"template");b?this.load(b):(c?this.$el.html(c):this.render(),this.$el.addClass("cb-view"),this.bindView(),this.delegateEvents())},tagName:"div",initialize:function(){},$:function(a){return this.$el.find(a)},render:function(){return this},remove:function(){return this.$el.remove(),this.unbindView().off(),this},setElement:function(a,b){return this.$el&&this.undelegateEvents().unbindView(),this.$el=conbo.$(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this instanceof conbo.Application||this.bindView(),this},appendView:function(a){if(arguments.length>1)return _.each(arguments,function(a){this.appendView(a)},this),this;if(!(a instanceof conbo.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.append(a.el),this},prependView:function(a){if(arguments.length>1)return _.each(arguments,function(a){this.prependView(a)},this),this;if(!(a instanceof conbo.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.prepend(a.el),this},mouseEnabled:function(){return this._setClass.apply(this,_.union(["conbo-disabled"],_.toArray(arguments)))},visible:function(){return this._setClass.apply(this,_.union(["conbo-invisible"],_.toArray(arguments)))},includeInLayout:function(){return this._setClass.apply(this,_.union(["conbo-excludeFromLayout"],_.toArray(arguments)))},bindView:function(){var nestedViews=this.$(".cb-view");return this.$("[cb-bind]").filter(function(){return!nestedViews.find(this).length}).each(this.bind(function(index,el){var d=this.$(el).cbData().bind,b=d.split("|"),s=this._cleanPropName(b[0]).split("."),p=s.pop(),m,f;try{m=s.length?eval("this."+s.join(".")):this}catch(e){}try{f=b[1]?eval("this."+this._cleanPropName(b[1])):undefined,f=_.isFunction(f)?f:undefined}catch(e){}if(!m)throw new Error(b[0]+" is not defined in this View");if(!p)throw new Error("Unable to bind to undefined property");conbo.BindingUtils.bindElement(m,p,el,f)})),this},_cleanPropName:function(a){return(a||"").replace(/[^\w,\.]/g,"")},unbindView:function(){return this},load:function(a,b,c){this.unbindView(),this.undelegateEvents();var d=this.bind(function(){this.bindView(),this.delegateEvents(),c&&c.apply(this,arguments)});this.$el.load(a,b,d)},loadCSS:function(a,b){if(!("document"in window))return this;var c=conbo.$("<link>").attr({rel:"stylesheet",type:"text/css",href:a}),d=c[0],e="sheet"in d,f=e?"sheet":"styleSheet",g=e?"cssRules":"rules",h=setInterval(function(){try{d[f]&&d[f][g].length&&(clearInterval(h),clearTimeout(i),b(!0))}catch(a){}},10),i=setTimeout(function(){clearInterval(h),clearTimeout(i),c.remove(),b(!1)},15e3);return conbo.$("head").append(c),this},delegateEvents:function(a){if(a||(a=_.result(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];if(_.isFunction(c)||(c=this[a[b]]),!c)throw new Error('Method "'+a[b]+'" does not exist');var d=b.match(delegateEventSplitter),e=d[1],f=d[2];c=_.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}return this}},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},toString:function(){return"conbo.View"},_addStyle:function(){if(conbo.style)return this;var a=conbo.$('<style type="text/css">.conbo-invisible { visibility:hidden !important; }.conbo-excludeFromLayout { display:none !important; }.conbo-disabled { pointer-events:none !important; }</style>');return conbo.$("head").append(a),conbo.style=a,this},_configure:function(a){this.options&&(a=_.extend({},_.result(this,"options"),a)),_.extend(this,_.pick(a,viewOptions)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1),this.className&&this.$el.addClass(this.className);else{var a=_.extend({},_.result(this,"attributes"));this.id&&(a.id=_.result(this,"id")),this.className&&(a["class"]=_.result(this,"className"));var b=conbo.$("<"+_.result(this,"tagName")+">").attr(a);this.setElement(b,!1)}},_setClass:function(a,b){var c=_.rest(arguments);if(!c.length)return!this.$el.hasClass(a);var d=_.isString(b)||_.isElement(b)||b instanceof conbo.$,e=d?this.$(b):this.$el;return 1==c.length&&d?!e.hasClass(a):(2==c.length&&d&&(b=c[1]),e.removeClass(a),b||e.addClass(a),this)}}),conbo.Application=conbo.View.extend({contextClass:conbo.Context,constructor:function(a){a=_.clone(a)||{},a.app=this,this.defineAccessor("context",undefined,undefined,new this.contextClass(a)),this.defineAccessor("prefix",undefined,undefined,a.prefix||this.prefix||""),this.defineAccessor("namespace",undefined,undefined,a.namespace),conbo.View.prototype.constructor.apply(this,arguments),a.el||a.autoApply===!1||this.applyApp(),a.autoApply!==!1&&this.applyViews()},applyApp:function(){var a;for(var b in this.namespace())if(this instanceof this.namespace()[b]){a=b;break}var c='[cb-app="'+this._addPrefix(a)+'"]',d=conbo.$(c)[0];return d&&(this.el=d),this},applyViews:function(){var a=this.prefix()?'[cb-view^="'+this._addPrefix()+'"]':"[cb-view]";return this.$(a).each(this.bind(function(a,b){var c=this.$(b).cbData().view.replace(this._addPrefix(),""),d=this.namespace()[c];_.isFunction(d)&&new d(this.context().addTo({el:b}))})),this},toString:function(){return"conbo.Application"},_addPrefix:function(a){return a=a||"",this.prefix()?this.prefix()+"."+a:a}}),conbo.Command=conbo.EventDispatcher.extend({constructor:function(a){this._inject(a),this.defineAccessor("event",undefined,undefined,this.options.event||{}),this.initialize.apply(this,arguments)},initialize:function(){},execute:function(){},toString:function(){return"conbo.Command"}}),conbo.ServerApplication=conbo.Bindable.extend({contextClass:conbo.Context,constructor:function(a){a=_.clone(a)||{},a.app=this,a.context||(a.context=new this.contextClass(a)),this._inject(a),this.options=a,this.initialize.apply(this,arguments)},initialize:function(){},toString:function(){return"conbo.ServerApplication"}}),conbo};if("undefined"!=typeof module&&module.exports){var _,$;try{_=require("lodash")}catch(e){try{_=require("underscore")}catch(e){throw new Error("Conbo.js requires underscore or lodash")}}try{$=require("jQuery")}catch(e){try{$=require("jquery")}catch(e){}}module.exports=create(_,$)}else"function"==typeof define&&define.amd?define("conbo",["underscore","jquery"],function(a,b){return create(a,b)}):window.conbo=create(window._,window.jQuery||window.Zepto||window.ender)}(this);