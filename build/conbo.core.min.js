(function(n,t){var i=function(i,r){
/*! 
 * Conbo.js: Lightweight MVC application framework for JavaScript
 * http://conbojs.mesmotronic.com/
 * 
 * Copyright (c) 2013 Mesmotronic Limited
 * Released under the MIT license
 * http://www.mesmotronic.com/legal/mit
 */
var u={VERSION:"1.0.17",_:i,$:r},e,o,h;return u.toString=function(){return"[Conbo "+this.VERSION+"]"},u.Class=function(n){this._inject(n),this.initialize.apply(this,arguments)},u.Class.prototype={initialize:function(){},callLater:function(n){return i.defer(this.bind.apply(this,[n].concat(i.rest(arguments)))),this},callSuper:function(n){return this._super[n]?this._super[n].apply(this,i.rest(arguments)):t},defineProperty:function(n,i,r,u){if(!("defineProperty"in Object))throw new Error("Object.defineProperty is not supported by the current browser");return i=i||function(){return this["_"+n]},r=r||function(t){this["_"+n]=t},Object.defineProperty(this,n,{enumerable:!0,configurable:!0,get:i,set:r}),u!==t&&(this[n]=u),this},defineAccessor:function(n,i,r,u){return i=i||function(){return this["_"+n]},r=r||function(t){return this["_"+n]=t,this},this[n]=function(){return(arguments.length?r:i).apply(this,arguments)},u!==t&&this[n](u),this},bind:function(n){return i.bind.apply(i,[n,this].concat(i.rest(arguments)))},bindAll:function(){return i.bindAll.apply(i,[this].concat(i.toArray(arguments))),this},toString:function(){return"[conbo.Class]"},_inject:function(n){return this.options=i.defaults(n||{},this.options),this.context||(this.context=this.options.context),this.context&&this.context.injectSingletons(this),this}},u.Class.extend=function(n,t){var r,u=this,f;return r=n&&i.has(n,"constructor")?n.constructor:function(){return u.apply(this,arguments)},i.extend(r,u,t),f=function(){this.constructor=r},f.prototype=u.prototype,r.prototype=new f,n&&i.extend(r.prototype,n),r.prototype._super=u.prototype,r},Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){return i.indexOf(this,obj,t)}),Array.prototype.forEach||(Array.prototype.forEach=function(n,t){i.each(this,n,t)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),u.Event=u.Class.extend({constructor:function(n){if(i.isString(n)?this.type=n:i.defaults(this,n),!this.type)throw new Error("Invalid or undefined event type");this.initialize.apply(this,arguments)},initialize:function(){},clone:function(){return i.clone(this)},preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.cancelBubble=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,this.stopPropagation()},toString:function(){return"[conbo.Event]"}},{ALL:"all",all:function(n){var r=[],t;for(t in this)i.isString(this[t])&&this[t]!=this.ALL&&r.push(this[t]);return n?r:r.join(" ")}}),u.ConboEvent=u.Event.extend({initialize:function(n,t){i.defaults(this,t)},toString:function(){return"[conbo.ConboEvent]"}},{ERROR:"error",INVALID:"invalid",CHANGE:"change",ADD:"add",REMOVE:"remove",DESTROY:"destroy",RESET:"reset",SORT:"sort",REQUEST:"request",SYNC:"sync",ROUTE:"route",ALL:"all"}),u.EventDispatcher=u.Class.extend({trigger:function(n){var r,f,e,t,o;if(!n)throw new Error("Event undefined");if((!i.isString(n)&&n instanceof u.Event||(n=new u.Event(n)),!this._queue||!(n.type in this._queue)&&!this._queue.all)||(n.target||(n.target=this),n.currentTarget=this,r=i.union(this._queue[n.type]||[],this._queue.all||[]),!r||!r.length))return this;for(f=0,e=r.length;f<e;++f)if(t=r[f],o=t.handler.call(t.scope||this,n),t.once&&this._off(n.type,t.handler,t.scope),o===!1||n.immediatePropagationStopped)break;return this},on:function(n,t,r,u){if(!n)throw new Error("Event type undefined");if(!t||!i.isFunction(t))throw new Error("Event handler is undefined or not a function");return i.isString(n)&&(n=n.split(" ")),i.isArray(n)?i.each(n,function(n){this._on(n,t,r,u,!1)},this):i.each(n,function(n,t){this._on(t,n,r,u,!1)},this),this},one:function(n,t,r,u){if(!n)throw new Error("Event type undefined");if(!t||!i.isFunction(t))throw new Error("Event handler is undefined or not a function");return i.isString(n)&&(n=n.split(" ")),i.isArray(n)?i.each(n,function(n){this._on(n,t,r,u,!0)},this):i.each(n,function(n,t){this._on(t,n,r,u,!0)},this),this},off:function(n,t){if(!arguments.length)return this._queue={},this;if(!n)throw new Error("Event type undefined");if(arguments.length==2&&!t)return this;var r=arguments;return i.isString(n)&&(n=n.split(" ")),i.isArray(n)?i.each(n,function(){this._off.apply(this,r)},this):i.each(n,function(){this._off.apply(this,r)},this),this},toString:function(){return"[conbo.EventDispatcher]"},addEventListener:function(){this.on.apply(this,arguments)},removeEventListener:function(){this.off.apply(this,arguments)},_on:function(n,t,i,r,u){n=="*"&&(n="all"),this._queue||(this._queue={}),this._off(n,t,i),n in this._queue||(this._queue[n]=[]),this._queue[n].push({handler:t,scope:i,once:u,priority:r||0}),this._queue[n].sort(function(n,t){return t.priority-n.priority})},_off:function(n,t,i){var u,r;if(!this._queue||!(n in this._queue))return this;if(u=this._queue[n],arguments.length==1)return delete this._queue[n],this;for(r=0;r<u.length;r++)u[r].handler!=t&&u[r].handler||u[r].scope!=i&&u[r].scope||u.splice(r--,1);return this}}),u.Bindable=u.EventDispatcher.extend({get:function(n){var t=i.result(this,"_attributes");return i.result(t,n)},set:function(n,t,r){var f=i.result(this,"_attributes"),e,r;return i.isObject(n)?(i.each(n,function(n,t){this.set(t,n,r)},this),this):(e=!1,r||(r={silent:!1}),r.unset?(e=i.has(f,n),delete f[n]):i.isFunction(f[n])&&f[n]()!=t?(f[n](t),e=!0):f[n]!=t&&(f[n]=t,e=!0),e&&!r.silent&&(r={attribute:n,value:t,options:r},this.trigger(new u.ConboEvent("change:"+n,r)),this.trigger(new u.ConboEvent(u.ConboEvent.CHANGE,r))),this)},unset:function(n,r){return r=i.defaults({unset:!0},r),this.set(n,t,r)},toString:function(){return"[conbo.Bindable]"},_attributes:function(){return this}}),u.Context=u.EventDispatcher.extend({constructor:function(n){this._commands={},this._singletons={},this.options=n||{},this.view=this.options.view;this.on(u.Event.ALL,this._allHandler);return this.initialize.apply(this,arguments),this},initialize:function(){},mapCommand:function(n,t){if(!n)throw new Error("eventType cannot be undefined");if(!t)throw new Error("commandClass cannot be undefined");if(!this._mapMulti(n,t,this.mapCommand))return this._commands[n]&&this._commands[n].indexOf(t)!=-1?void 0:(this._commands[n]=this._commands[n]||[],this._commands[n].push(t),this)},unmapCommand:function(n,i){if(!n)throw new Error("eventType cannot be undefined");if(!this._mapMulti(n,i,this.unmapCommand)){if(i===t){delete this._commands[n];return}if(this._commands[n]){var r=this._commands[n].indexOf(i);if(r!=-1)return this._commands[n].splice(r,1),this}}},mapSingleton:function(n,t){if(!n)throw new Error("propertyName cannot be undefined");if(!t)throw new Error("singletonClass cannot be undefined");if(!this._mapMulti(n,t,this.mapSingleton))return this._singletons[n]=i.isFunction(t)?new t(arguments[2],arguments[3],arguments[4]):t,this},unmapSingleton:function(n){if(!n)throw new Error("propertyName cannot be undefined");if(!this._mapMulti(n,null,this.unmapSingleton))return this._singletons[n]?(delete this._singletons[n],this):void 0},addTo:function(n){return i.extend(n||{},{context:this})},injectSingletons:function(n){for(var i in n)n[i]===t&&(n[i]=this._singletons[i]);return this},toString:function(){return"[conbo.Context]"},_allHandler:function(n){var t=i.union(this._commands.all||[],this._commands[n.type]||[]);t.length&&i.each(t,function(t){this._executeCommand(t,n)},this)},_executeCommand:function(n,t){var i,r;return r={event:t},i=new n(this.addTo(r)),i.execute(),i=null,this},_mapMulti:function(n,t,r){if(i.isArray(n)||n.indexOf(" ")==-1)return!1;var u=i.isArray(n)?n:n.split(" ");return i.each(u,function(n){r(n,t)},this),!0}}),u.Map=u.Bindable.extend({constructor:function(n,t){this._inject(t),this._attributes=i.defaults({},n,i.result(this,"defaults")),this.initialize.apply(this,arguments)},toJSON:function(){return i.clone(this._attributes)},toString:function(){return"[conbo.Map]"}}),e=["keys","values","pairs","invert","pick","omit","size"],i.each(e,function(n){u.Map.prototype[n]=function(){return i[n].apply(i,[this._attributes].concat(i.rest(arguments)))}}),u.BindingUtils=u.Class.extend({},{bindElement:function(n,t,i,f){if(!(n instanceof u.Bindable))throw new Error("Source is not Bindable");return f=f||function(n){return typeof n=="undefined"?"":String(n)},r(i).each(function(i,u){var e=r(u),o=e[0].tagName,s;switch(o){case"INPUT":case"SELECT":case"TEXTAREA":s=(e.attr("type")||o).toLowerCase();switch(s){case"checkbox":e.prop("checked",Boolean(n.get(t)));n.on("change:"+t,function(n){e.prop("checked",Boolean(n.value))});e.on("input change",function(){n.set(t,e.is(":checked"))});return;case"radio":e.val()==n.get(t)&&e.prop("checked",!0);n.on("change:"+t,function(n){e.val()==n.value&&e.prop("checked",!0)});break;default:e.val(n.get(t));n.on("change:"+t,function(n){e.val()!=n.value&&e.val(n.value)})}e.on("input change",function(){n.set(t,e.val()||e.html())});break;default:e.html(f(n.get(t)));n.on("change:"+t,function(n){var t=f(n.value);e.html(t)})}}),this},bindProperty:function(n,t,i,r,f){if(!(n instanceof u.Bindable))throw new Error("Source is not Bindable");r=r||t;n.on("change:"+t,function(n){i.get(r)!==n.value&&i.set(r,n.value)});return f&&this.bindProperty(i,r,n,t),this},bindSetter:function(n,t,i){if(!(n instanceof u.Bindable))throw new Error("Source is not Bindable");n.on("change:"+t,function(n){i(n.value)});return this}}),o=/^(\S+)\s*(.*)$/,h=["model","collection","el","id","attributes","className","tagName","events"],u.View=u.Bindable.extend({constructor:function(n){n=i.clone(n)||{},this.cid=i.uniqueId("view"),this._addStyle(),this._configure(n),this._ensureElement(),this._inject(n),this.initialize.apply(this,arguments),this.delegateEvents()},tagName:"div",$:function(n){return this.$el.find(n)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.unbindView().off(),this},setElement:function(n,t){return this.$el&&this.undelegateEvents().unbindView(),this.$el=n instanceof u.$?n:u.$(n),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this instanceof u.Application||this.bindView(),this},appendView:function(n){if(arguments.length>1)return i.each(arguments,function(n){this.appendView(n)},this),this;if(!(n instanceof u.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.append(n.el),this},prependView:function(n){if(arguments.length>1)return i.each(arguments,function(n){this.prependView(n)},this),this;if(!(n instanceof u.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.prepend(n.el),this},mouseEnabled:function(){return this._setClass.apply(this,i.union(["conbo-disabled"],i.toArray(arguments)))},visible:function(){return this._setClass.apply(this,i.union(["conbo-invisible"],i.toArray(arguments)))},includeInLayout:function(){return this._setClass.apply(this,i.union(["conbo-excludeFromLayout"],i.toArray(arguments)))},bindView:function(){return this.$("[data-property]").each(this.bind(function(n,i){var r=this.$(i).data(),e;if(p=r.property,s=r.source,f=typeof this[r.parse]=="function"?this[r.parse]:t,!!s&&!(s in this))throw new Error("Unable to bind element to undefined source: "+s);e=!s?this:this[s],u.BindingUtils.bindElement(e,p,i,f)})),this},unbindView:function(){return this},loadCSS:function(t){if("document"in n){var i;return i=document.createElement("link"),i.type="text/css",i.rel="stylesheet",i.href=t,document.getElementsByTagName("head")[0].appendChild(i),this}},delegateEvents:function(n){var r,t;if(n||(n=i.result(this,"events"))){this.undelegateEvents();for(r in n){if(t=n[r],i.isFunction(t)||(t=this[n[r]]),!t)throw new Error('Method "'+n[r]+'" does not exist');var f=r.match(o),u=f[1],e=f[2];if(t=i.bind(t,this),u+=".delegateEvents"+this.cid,e==="")this.$el.on(u,t);else this.$el.on(u,e,t)}return this}},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},toString:function(){return"[conbo.View]"},_addStyle:function(){if(!!u.style)return this;var n=u.$('<style type="text/css">.conbo-invisible { visibility:hidden !important; }.conbo-excludeFromLayout { display:none !important; }.conbo-disabled { pointer-events:none !important; }<\/style>');return u.$("head").append(n),u.style=n,this},_configure:function(n){this.options&&(n=i.extend({},i.result(this,"options"),n)),i.extend(this,i.pick(n,h)),this.options=n},_ensureElement:function(){var n,t;this.el?(this.setElement(i.result(this,"el"),!1),this.className&&this.$el.addClass(this.className)):(n=i.extend({},i.result(this,"attributes")),this.id&&(n.id=i.result(this,"id")),this.className&&(n["class"]=i.result(this,"className")),t=u.$("<"+i.result(this,"tagName")+">").attr(n),this.setElement(t,!1))},_setClass:function(n,t){var r=i.rest(arguments),f,e;return r.length?(f=i.isString(t)||i.isElement(t)||t instanceof u.$,e=f?this.$(t):this.$el,r.length==1&&f)?!e.hasClass(n):(r.length==2&&f&&(t=r[1]),e.removeClass(n),t||e.addClass(n),this):!this.$el.hasClass(n)}}),u.Actor=u.Bindable.extend({constructor:function(n){this._inject(n),this.initialize.apply(this,arguments)}}),u.Application=u.View.extend({contextClass:u.Context,constructor:function(n){n=i.clone(n)||{},n.view=n.view||this,this.context=n.context||new this.contextClass(n),u.View.prototype.constructor.apply(this,arguments)},toString:function(){return"[conbo.Application]"}}),u.Command=u.EventDispatcher.extend({constructor:function(n){this._inject(n),this.event=this.options.event||{},this.initialize.apply(this,arguments)},initialize:function(){},execute:function(){},toString:function(){return"[conbo.Command]"}}),u.ServerApplication=u.Bindable.extend({contextClass:u.Context,constructor:function(n){n=n||{},n.view=n.view||this,this.context=n.context||new this.contextClass(n),this._inject(n),this.options=n,this.initialize.apply(this,arguments)},initialize:function(){},toString:function(){return"[conbo.ServerApplication]"}}),u},r,u;if(typeof module!="undefined"&&module.exports){try{r=require("underscore")}catch(e){try{r=require("lodash")}catch(e){throw new Error("Conbo.js requires underscore or lodash");}}try{u=require("jQuery")}catch(e){try{u=require("jquery")}catch(e){}}module.exports=i(r,u)}else typeof define=="function"&&define.amd?define("conbo",["underscore","jquery"],function(n,t){return i(n,t)}):n.conbo=i(n._,n.jQuery||n.Zepto||n.ender)})(this)