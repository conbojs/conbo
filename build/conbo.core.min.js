!function(a,b){var c=function(c,d){var e={VERSION:"1.1.1",_:c,$:d,toString:function(){return"[Conbo "+this.VERSION+"]"}};e.Class=function(a){this._inject(a),this.initialize.apply(this,arguments)},e.Class.prototype={initialize:function(){},callLater:function(a){return c.defer(this.bind.apply(this,[a].concat(c.rest(arguments)))),this},callSuper:function(a){return this._super[a]?this._super[a].apply(this,c.rest(arguments)):b},defineProperty:function(a,c,d,e){if(!("defineProperty"in Object))throw new Error("Object.defineProperty is not supported by the current browser");return c=c||function(){return this["_"+a]},d=d||function(b){this["_"+a]=b},Object.defineProperty(this,a,{enumerable:!0,configurable:!0,get:c,set:d}),e!==b&&(this[a]=e),this},defineAccessor:function(a,c,d,e){return c=c||function(){return this["_"+a]},d=d||function(b){return this["_"+a]=b,this},this[a]=function(){return(arguments.length?d:c).apply(this,arguments)},e!==b&&this[a](e),this},bind:function(a){return c.bind.apply(c,[a,this].concat(c.rest(arguments)))},bindAll:function(){return c.bindAll.apply(c,[this].concat(c.toArray(arguments))),this},toString:function(){return"[conbo.Class]"},_inject:function(a){return this.options=c.defaults(a||{},this.options),this.context||(this.context=this.options.context),this.context&&this.context.injectSingletons(this),this}},e.Class.extend=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.prototype._super=e.prototype,d},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){return c.indexOf(this,a,b)}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){c.each(this,a,b)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.Event=e.Class.extend({constructor:function(a){if(c.isString(a)?this.type=a:c.defaults(this,a),!this.type)throw new Error("Invalid or undefined event type");this.initialize.apply(this,arguments)},initialize:function(){},clone:function(){return c.clone(this)},preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.cancelBubble=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,this.stopPropagation()},toString:function(){return"[conbo.Event]"}},{ALL:"all",all:function(a){var b=[];for(var d in this)c.isString(this[d])&&this[d]!=this.ALL&&b.push(this[d]);return a?b:b.join(" ")}}),e.ConboEvent=e.Event.extend({initialize:function(a,b){c.defaults(this,b)},toString:function(){return"[conbo.ConboEvent]"}},{ERROR:"error",INVALID:"invalid",CHANGE:"change",ADD:"add",REMOVE:"remove",DESTROY:"destroy",RESET:"reset",SORT:"sort",REQUEST:"request",SYNC:"sync",ROUTE:"route",ALL:"all"}),e.EventDispatcher=e.Class.extend({trigger:function(a){if(!a)throw new Error("Event undefined");if(!c.isString(a)&&a instanceof e.Event||(a=new e.Event(a)),!this._queue||!(a.type in this._queue)&&!this._queue.all)return this;a.target||(a.target=this),a.currentTarget=this;var b=c.union(this._queue[a.type]||[],this._queue.all||[]);if(!b||!b.length)return this;for(var d=0,f=b.length;f>d;++d){var g=b[d],h=g.handler.call(g.scope||this,a);if(g.once&&this._off(a.type,g.handler,g.scope),h===!1||a.immediatePropagationStopped)break}return this},on:function(a,b,d,e){if(!a)throw new Error("Event type undefined");if(!b||!c.isFunction(b))throw new Error("Event handler is undefined or not a function");return c.isString(a)&&(a=a.split(" ")),c.isArray(a)?c.each(a,function(a){this._on(a,b,d,e,!1)},this):c.each(a,function(a,b){this._on(b,a,d,e,!1)},this),this},one:function(a,b,d,e){if(!a)throw new Error("Event type undefined");if(!b||!c.isFunction(b))throw new Error("Event handler is undefined or not a function");return c.isString(a)&&(a=a.split(" ")),c.isArray(a)?c.each(a,function(a){this._on(a,b,d,e,!0)},this):c.each(a,function(a,b){this._on(b,a,d,e,!0)},this),this},off:function(a,b){if(!arguments.length)return this._queue={},this;if(!a)throw new Error("Event type undefined");if(2==arguments.length&&!b)return this;var d=arguments;return c.isString(a)&&(a=a.split(" ")),c.isArray(a)?c.each(a,function(){this._off.apply(this,d)},this):c.each(a,function(){this._off.apply(this,d)},this),this},toString:function(){return"[conbo.EventDispatcher]"},addEventListener:function(){this.on.apply(this,arguments)},removeEventListener:function(){this.off.apply(this,arguments)},_on:function(a,b,c,d,e){"*"==a&&(a="all"),this._queue||(this._queue={}),this._off(a,b,c),a in this._queue||(this._queue[a]=[]),this._queue[a].push({handler:b,scope:c,once:e,priority:d||0}),this._queue[a].sort(function(a,b){return b.priority-a.priority})},_off:function(a,b,c){if(!(this._queue&&a in this._queue))return this;var d=this._queue[a];if(1==arguments.length)return delete this._queue[a],this;var e;for(e=0;e<d.length;e++)d[e].handler!=b&&d[e].handler||d[e].scope!=c&&d[e].scope||d.splice(e--,1);return this}}),e.Bindable=e.EventDispatcher.extend({get:function(a){var b=c.result(this,"_attributes");return c.result(b,a)},set:function(a,b,d){if(c.isObject(a))return c.each(a,function(a,b){this.set(b,a,d)},this),this;var f=c.result(this,"_attributes"),g=!1;if(d||(d={silent:!1}),d.unset?(g=c.has(f,a),delete f[a]):c.isFunction(f[a])?f[a]()!==b&&(f[a](b),g=!0):f[a]!=b&&(f[a]=b,g=!0),g&&!d.silent){var d={attribute:a,value:b,options:d};this.trigger(new e.ConboEvent("change:"+a,d)),this.trigger(new e.ConboEvent(e.ConboEvent.CHANGE,d))}return this},unset:function(a,d){return d=c.defaults({unset:!0},d),this.set(a,b,d)},toString:function(){return"[conbo.Bindable]"},_attributes:function(){return this}}),e.Context=e.EventDispatcher.extend({constructor:function(a){return this._commands={},this._singletons={},this.options=a||{},this.view=this.options.view,this.on(e.Event.ALL,this._allHandler),this.initialize.apply(this,arguments),this},initialize:function(){},mapCommand:function(a,b){if(!a)throw new Error("eventType cannot be undefined");if(!b)throw new Error("commandClass cannot be undefined");if(!(this._mapMulti(a,b,this.mapCommand)||this._commands[a]&&-1!=this._commands[a].indexOf(b)))return this._commands[a]=this._commands[a]||[],this._commands[a].push(b),this},unmapCommand:function(a,c){if(!a)throw new Error("eventType cannot be undefined");if(!this._mapMulti(a,c,this.unmapCommand)){if(c===b)return void delete this._commands[a];if(this._commands[a]){var d=this._commands[a].indexOf(c);if(-1!=d)return this._commands[a].splice(d,1),this}}},mapSingleton:function(a,b){if(!a)throw new Error("propertyName cannot be undefined");if(!b)throw new Error("singletonClass cannot be undefined");if(!this._mapMulti(a,b,this.mapSingleton))return this._singletons[a]=c.isFunction(b)?new b(arguments[2],arguments[3],arguments[4]):b,this},unmapSingleton:function(a){if(!a)throw new Error("propertyName cannot be undefined");if(!this._mapMulti(a,null,this.unmapSingleton)&&this._singletons[a])return delete this._singletons[a],this},addTo:function(a){return c.extend(a||{},{context:this})},injectSingletons:function(a){for(var c in a)a[c]===b&&(a[c]=this._singletons[c]);return this},toString:function(){return"[conbo.Context]"},_allHandler:function(a){var b=c.union(this._commands.all||[],this._commands[a.type]||[]);b.length&&c.each(b,function(b){this._executeCommand(b,a)},this)},_executeCommand:function(a,b){var c,d;return d={event:b},c=new a(this.addTo(d)),c.execute(),c=null,this},_mapMulti:function(a,b,d){if(c.isArray(a)||-1==a.indexOf(" "))return!1;var e=c.isArray(a)?a:a.split(" ");return c.each(e,function(a){d(a,b)},this),!0}}),e.Hash=e.Bindable.extend({constructor:function(a,b){this._inject(b),this._attributes=c.defaults({},a,c.result(this,"defaults")),this.initialize.apply(this,arguments)},toJSON:function(){return c.clone(this._attributes)},toString:function(){return"[conbo.Hash]"}});var f=["keys","values","pairs","invert","pick","omit","size"];c.each(f,function(a){c.has(c,a)&&(e.Hash.prototype[a]=function(){return c[a].apply(c,[this._attributes].concat(c.rest(arguments)))})}),e.Map=e.Hash,e.BindingUtils=e.Class.extend({},{bindEl:function(a,b,c,f){if(!(a instanceof e.Bindable))throw new Error("Source is not Bindable");return f=f||function(a){return"undefined"==typeof a?"":String(a)},d(c).each(function(c,e){var g=d(e),h=g[0].tagName;switch(h){case"INPUT":case"SELECT":case"TEXTAREA":var i=(g.attr("type")||h).toLowerCase();switch(i){case"checkbox":return g.prop("checked",Boolean(a.get(b))),a.on("change:"+b,function(a){g.prop("checked",Boolean(a.value))}),void g.on("input change",function(){a.set(b,g.is(":checked"))});case"radio":g.val()==a.get(b)&&g.prop("checked",!0),a.on("change:"+b,function(a){g.val()==a.value&&g.prop("checked",!0)});break;default:g.val(a.get(b)),a.on("change:"+b,function(a){g.val()!=a.value&&g.val(a.value)})}g.on("input change",function(){a.set(b,g.val()||g.html())});break;default:g.html(f(a.get(b))),a.on("change:"+b,function(a){var b=f(a.value);g.html(b)})}}),this},bindProperty:function(a,b,c,d,f){if(!(a instanceof e.Bindable))throw new Error("Source is not Bindable");return d||(d=b),a.on("change:"+b,function(a){return c instanceof e.Bindable?void c.set(d,a.value):void(c[d]=a.value)}),f&&c instanceof e.Bindable&&this.bindProperty(c,d,a,b),this},bindSetter:function(a,b,d){if(!(a instanceof e.Bindable))throw new Error("Source is not Bindable");if(!c.isFunction(d)){if(!d||!c.has(d,b))throw new Error("Invalid setter function");d=d[b]}return a.on("change:"+b,function(a){d(a.value)}),this}});var g=/^(\S+)\s*(.*)$/,h=["model","collection","el","id","attributes","className","tagName","events"];return e.$.fn.cbData=function(){for(var a={},c=this.get()[0].attributes,d=0,e=0;e<c.length;++e)0==c[e].name.indexOf("cb-")&&(a[c[e].name.substr(3)]=c[e].value,++d);return d?a:b},e.$.expr[":"].cbAttr=function(a,b,c){var d=e.$(a),f=c[3].split(","),g=d.cbData();return g?g&&!f.length?!0:f[0]&&!f[1]?g.hasOwnProperty(f[0]):f[0]&&f[1]?g[f[0]]==f[1]:!1:!1},e.View=e.Bindable.extend({constructor:function(a){a=c.clone(a)||{},this.cid=c.uniqueId("view"),this._addStyle(),this._configure(a),this._ensureElement(),this._inject(a),this.initialize.apply(this,arguments),this.delegateEvents()},tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.unbindView().off(),this},setElement:function(a,b){return this.$el&&this.undelegateEvents().unbindView(),this.$el=e.$(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this instanceof e.Application||this.bindView(),this},appendView:function(a){if(arguments.length>1)return c.each(arguments,function(a){this.appendView(a)},this),this;if(!(a instanceof e.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.append(a.el),this},prependView:function(a){if(arguments.length>1)return c.each(arguments,function(a){this.prependView(a)},this),this;if(!(a instanceof e.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.prepend(a.el),this},mouseEnabled:function(){return this._setClass.apply(this,c.union(["conbo-disabled"],c.toArray(arguments)))},visible:function(){return this._setClass.apply(this,c.union(["conbo-invisible"],c.toArray(arguments)))},includeInLayout:function(){return this._setClass.apply(this,c.union(["conbo-excludeFromLayout"],c.toArray(arguments)))},bindView:function(){return this.$("[cb-bind]").each(this.bind(function(a,d){var f,g,h=this.$(d).cbData(),i=h.bind.split("."),j=c.isFunction(this[h.parse])?this[h.parse]:b;if(i.length>1?(f=this[i[0]],g=i[1]):(f=this,g=i[0]),!f)throw new Error(h.bind+" is not defined in this View");if(!g)throw new Error("Unable to bind to undefined property");e.BindingUtils.bindEl(f,g,d,j)})),this},unbindView:function(){return this},loadCSS:function(b,c){if(!("document"in a))return this;var d=e.$("<link>").attr({rel:"stylesheet",type:"text/css",href:b}),f=d[0],g="sheet"in f,h=g?"sheet":"styleSheet",i=g?"cssRules":"rules",j=setInterval(function(){try{f[h]&&f[h][i].length&&(clearInterval(j),clearTimeout(k),c(!0))}catch(a){}},10),k=setTimeout(function(){clearInterval(j),clearTimeout(k),d.remove(),c(!1)},15e3);return e.$("head").append(d),this},delegateEvents:function(a){if(a||(a=c.result(this,"events"))){this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),!d)throw new Error('Method "'+a[b]+'" does not exist');var e=b.match(g),f=e[1],h=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===h?this.$el.on(f,d):this.$el.on(f,h,d)}return this}},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},toString:function(){return"[conbo.View]"},_addStyle:function(){if(e.style)return this;var a=e.$('<style type="text/css">.conbo-invisible { visibility:hidden !important; }.conbo-excludeFromLayout { display:none !important; }.conbo-disabled { pointer-events:none !important; }</style>');return e.$("head").append(a),e.style=a,this},_configure:function(a){this.options&&(a=c.extend({},c.result(this,"options"),a)),c.extend(this,c.pick(a,h)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1),this.className&&this.$el.addClass(this.className);else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className"));var b=e.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(b,!1)}},_setClass:function(a,b){var d=c.rest(arguments);if(!d.length)return!this.$el.hasClass(a);var f=c.isString(b)||c.isElement(b)||b instanceof e.$,g=f?this.$(b):this.$el;return 1==d.length&&f?!g.hasClass(a):(2==d.length&&f&&(b=d[1]),g.removeClass(a),b||g.addClass(a),this)}}),e.Application=e.View.extend({contextClass:e.Context,constructor:function(a){if(a=c.clone(a)||{},a.view=a.view||this,!a.el){var b=this.toString().replace(/[\[\]']+/g,""),d=e.$('[cb-app="'+b+'"]')[0];d&&(a.el=d)}this.context=a.context||new this.contextClass(a),e.View.prototype.constructor.apply(this,arguments)},bindViews:function(a){if(!c.isObject(a))throw new Error("Invalid namespace");return this.$("[cb-view]").each(this.bind(function(b,d){var e=this.$(d).cbData("view"),f=a[e];c.isFunction(f)&&new f(this.context.addTo({el:d}))})),this},toString:function(){return"[conbo.Application]"}}),e.Command=e.EventDispatcher.extend({constructor:function(a){this._inject(a),this.event=this.options.event||{},this.initialize.apply(this,arguments)},initialize:function(){},execute:function(){},toString:function(){return"[conbo.Command]"}}),e.ServerApplication=e.Bindable.extend({contextClass:e.Context,constructor:function(a){a=a||{},a.view=a.view||this,this.context=a.context||new this.contextClass(a),this._inject(a),this.options=a,this.initialize.apply(this,arguments)},initialize:function(){},toString:function(){return"[conbo.ServerApplication]"}}),e};if("undefined"!=typeof module&&module.exports){var d,e;try{d=require("lodash")}catch(f){try{d=require("underscore")}catch(f){throw new Error("Conbo.js requires underscore or lodash")}}try{e=require("jQuery")}catch(f){try{e=require("jquery")}catch(f){}}module.exports=c(d,e)}else"function"==typeof define&&define.amd?define("conbo",["underscore","jquery"],function(a,b){return c(a,b)}):a.conbo=c(a._,a.jQuery||a.Zepto||a.ender)}(this);