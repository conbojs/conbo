(function(n,t){function i(){
/*! 
 * Conbo.js: Lightweight MVC application framework for JavaScript
 * http://conbojs.mesmotronic.com/
 * 
 * Copyright (c) 2013 Mesmotronic Limited
 * Released under the MIT license
 * http://www.mesmotronic.com/legal/mit
 */
var r={},e=typeof require=="function",i=r._=e?require("underscore"):n._,u,o,h;try{u=r.$=e?require("jquery"):n.jQuery||n.Zepto||n.ender}catch(c){}return r.VERSION="1.0.15",r.toString=function(){return"[Conbo "+this.VERSION+"]"},r.Class=function(n){i.isObject(n)&&!!n.context&&this._inject(n),this.initialize.apply(this,arguments)},r.Class.prototype={initialize:function(){},callLater:function(n){return i.defer(this.bind.apply(this,[n].concat(i.rest(arguments)))),this},callSuper:function(n){return this._super[n]?this._super[n].apply(this,i.rest(arguments)):t},defineProperty:function(n,i,r,u){if(!("defineProperty"in Object))throw new Error("Object.defineProperty is not supported by the current browser");return i=i||function(){return this["_"+n]},r=r||function(t){this["_"+n]=t},Object.defineProperty(this,n,{enumerable:!0,configurable:!0,get:i,set:r}),u!==t&&(this[n]=u),this},defineAccessor:function(n,i,r,u){return i=i||function(){return this["_"+n]},r=r||function(t){return this["_"+n]=t,this},this[n]=function(){return(arguments.length?r:i).apply(this,arguments)},u!==t&&this[n](u),this},bind:function(n){return i.bind.apply(i,[n,this].concat(i.rest(arguments)))},bindAll:function(){return i.bindAll.apply(i,[this].concat(i.toArray(arguments))),this},_inject:function(n){return this.options=i.defaults(n||{},this.options),this.context||(this.context=this.options.context),this.context&&this.context.injectSingletons(this),this}},r.Class.extend=function(n,t){var r,u=this,f;return r=n&&i.has(n,"constructor")?n.constructor:function(){return u.apply(this,arguments)},i.extend(r,u,t),f=function(){this.constructor=r},f.prototype=u.prototype,r.prototype=new f,n&&i.extend(r.prototype,n),r.prototype._super=u.prototype,r},Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){return i.indexOf(this,obj,t)}),Array.prototype.forEach||(Array.prototype.forEach=function(n,t){i.each(this,n,t)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),r.Event=r.Class.extend({constructor:function(n){if(i.isString(n)?this.type=n:i.defaults(this,n),!this.type)throw new Error("Invalid or undefined event type");this.initialize.apply(this,arguments)},initialize:function(){},clone:function(){return i.clone(this)},preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.cancelBubble=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,this.stopPropagation()},toString:function(){return"[conbo.Event]"}},{ALL:"all",all:function(n){var r=[],t;for(t in this)i.isString(this[t])&&this[t]!=this.ALL&&r.push(this[t]);return n?r:r.join(" ")}}),r.ConboEvent=r.Event.extend({initialize:function(n,t){i.defaults(this,t)},toString:function(){return"[conbo.ConboEvent]"}},{ERROR:"error",INVALID:"invalid",CHANGE:"change",ADD:"add",REMOVE:"remove",DESTROY:"destroy",RESET:"reset",SORT:"sort",REQUEST:"request",SYNC:"sync",ROUTE:"route",ALL:"all"}),r.EventDispatcher=r.Class.extend({trigger:function(n){var u,f,e,t,o;if(!n)throw new Error("Event undefined");if((!i.isString(n)&&n instanceof r.Event||(n=new r.Event(n)),!this._queue||!(n.type in this._queue)&&!this._queue.all)||(n.target||(n.target=this),n.currentTarget=this,u=i.union(this._queue[n.type]||[],this._queue.all||[]),!u||!u.length))return this;for(f=0,e=u.length;f<e;++f)if(t=u[f],o=t.handler.call(t.scope||this,n),t.once&&this._off(n.type,t.handler,t.scope),o===!1||n.immediatePropagationStopped)break;return this},on:function(n,t,r,u){if(!n)throw new Error("Event type undefined");if(!t||!i.isFunction(t))throw new Error("Event handler is undefined or not a function");return i.isString(n)&&(n=n.split(" ")),i.isArray(n)?i.each(n,function(n){this._on(n,t,r,u,!1)},this):i.each(n,function(n,t){this._on(t,n,r,u,!1)},this),this},one:function(n,t,r,u){if(!n)throw new Error("Event type undefined");if(!t||!i.isFunction(t))throw new Error("Event handler is undefined or not a function");return i.isString(n)&&(n=n.split(" ")),i.isArray(n)?i.each(n,function(n){this._on(n,t,r,u,!0)},this):i.each(n,function(n,t){this._on(t,n,r,u,!0)},this),this},off:function(n,t){if(!arguments.length)return this._queue={},this;if(!n)throw new Error("Event type undefined");if(arguments.length==2&&!t)return this;var r=arguments;return i.isString(n)&&(n=n.split(" ")),i.isArray(n)?i.each(n,function(){this._off.apply(this,r)},this):i.each(n,function(){this._off.apply(this,r)},this),this},toString:function(){return"[conbo.EventDispatcher]"},addEventListener:function(){this.on.apply(this,arguments)},removeEventListener:function(){this.off.apply(this,arguments)},_on:function(n,t,i,r,u){n=="*"&&(n="all"),this._queue||(this._queue={}),this._off(n,t,i),n in this._queue||(this._queue[n]=[]),this._queue[n].push({handler:t,scope:i,once:u,priority:r||0}),this._queue[n].sort(function(n,t){return t.priority-n.priority})},_off:function(n,t,i){var u,r;if(!this._queue||!(n in this._queue))return this;if(u=this._queue[n],arguments.length==1)return delete this._queue[n],this;for(r=0;r<u.length;r++)u[r].handler!=t&&u[r].handler||u[r].scope!=i&&u[r].scope||u.splice(r--,1);return this}}),r.Bindable=r.EventDispatcher.extend({get:function(n){var t=i.result(this,"_attributes");return i.result(t,n)},set:function(n,t,u){var f=i.result(this,"_attributes"),e,u;return i.isObject(n)?(i.each(n,function(n,t){this.set(t,n,u)},this),this):(e=!1,u||(u={silent:!1}),u.unset?(e=i.has(f,n),delete f[n]):i.isFunction(f[n])&&f[n]()!=t?(f[n](t),e=!0):f[n]!=t&&(f[n]=t,e=!0),e&&!u.silent&&(u={attribute:n,value:t,options:u},this.trigger(new r.ConboEvent("change:"+n,u)),this.trigger(new r.ConboEvent(r.ConboEvent.CHANGE,u))),this)},unset:function(n,r){return r=i.defaults({unset:!0},r),this.set(n,t,r)},toString:function(){return"[conbo.Bindable]"},_attributes:function(){return this}}),r.Context=r.EventDispatcher.extend({constructor:function(n){this._commands={},this._singletons={},this.options=n||{},this.view=this.options.view;this.on(r.Event.ALL,this._allHandler);return this.initialize.apply(this,arguments),this},initialize:function(){},mapCommand:function(n,t){if(!n)throw new Error("eventType cannot be undefined");if(!t)throw new Error("commandClass cannot be undefined");if(!this._mapMulti(n,t,this.mapCommand))return this._commands[n]&&this._commands[n].indexOf(t)!=-1?void 0:(this._commands[n]=this._commands[n]||[],this._commands[n].push(t),this)},unmapCommand:function(n,i){if(!n)throw new Error("eventType cannot be undefined");if(!this._mapMulti(n,i,this.unmapCommand)){if(i===t){delete this._commands[n];return}if(this._commands[n]){var r=this._commands[n].indexOf(i);if(r!=-1)return this._commands[n].splice(r,1),this}}},mapSingleton:function(n,t){if(!n)throw new Error("propertyName cannot be undefined");if(!t)throw new Error("singletonClass cannot be undefined");if(!this._mapMulti(n,t,this.mapSingleton))return this._singletons[n]=i.isFunction(t)?new t(arguments[2],arguments[3],arguments[4]):t,this},unmapSingleton:function(n){if(!n)throw new Error("propertyName cannot be undefined");if(!this._mapMulti(n,null,this.unmapSingleton))return this._singletons[n]?(delete this._singletons[n],this):void 0},addTo:function(n){return i.extend(n||{},{context:this})},injectSingletons:function(n){for(var i in n)n[i]===t&&(n[i]=this._singletons[i]);return this},toString:function(){return"[conbo.Context]"},_allHandler:function(n){var t=i.union(this._commands.all||[],this._commands[n.type]||[]);t.length&&i.each(t,function(t){this._executeCommand(t,n)},this)},_executeCommand:function(n,t){var i,r;return r={event:t},i=new n(this.addTo(r)),i.execute(),i=null,this},_mapMulti:function(n,t,r){if(i.isArray(n)||n.indexOf(" ")==-1)return!1;var u=i.isArray(n)?n:n.split(" ");return i.each(u,function(n){r(n,t)},this),!0}}),r.Map=r.Bindable.extend({constructor:function(n,t){this._inject(t),this._attributes=i.defaults({},n,this.defaults),this.initialize.apply(this,arguments)},toJSON:function(){return i.clone(this._attributes)},toString:function(){return"[conbo.Map]"}}),r.BindingUtils=r.Class.extend({},{bindElement:function(n,t,i,f){if(!(n instanceof r.Bindable))throw new Error("Source is not Bindable");return f=f||function(n){return typeof n=="undefined"?"":String(n)},u(i).each(function(i,r){var e=u(r),o=e[0].tagName,s;switch(o){case"INPUT":case"SELECT":case"TEXTAREA":s=(e.attr("type")||o).toLowerCase();switch(s){case"checkbox":e.prop("checked",Boolean(n.get(t)));n.on("change:"+t,function(n){e.prop("checked",Boolean(n.value))});e.on("input change",function(){n.set(t,e.is(":checked"))});return;case"radio":e.val()==n.get(t)&&e.prop("checked",!0);n.on("change:"+t,function(n){e.val()==n.value&&e.prop("checked",!0)});break;default:e.val(n.get(t));n.on("change:"+t,function(n){e.val()!=n.value&&e.val(n.value)})}e.on("input change",function(){n.set(t,e.val()||e.html())});break;default:e.html(f(n.get(t)));n.on("change:"+t,function(n){var t=f(n.value);e.html(t)})}}),this},bindProperty:function(n,t,i,u,f){if(!(n instanceof r.Bindable))throw new Error("Source is not Bindable");u=u||t;n.on("change:"+t,function(n){i.get(u)!==n.value&&i.set(u,n.value)});return f&&this.bindProperty(i,u,n,t),this},bindSetter:function(n,t,i){if(!(n instanceof r.Bindable))throw new Error("Source is not Bindable");n.on("change:"+t,function(n){i(n.value)});return this}}),o=/^(\S+)\s*(.*)$/,h=["model","collection","el","id","attributes","className","tagName","events"],r.View=r.Bindable.extend({constructor:function(n){this.cid=i.uniqueId("view"),this._addStyle(),this._configure(n||{}),this._ensureElement(),this._inject(n),this.initialize.apply(this,arguments),this.delegateEvents()},tagName:"div",$:function(n){return this.$el.find(n)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.unbindView().off(),this},setElement:function(n,t){return this.$el&&this.undelegateEvents().unbindView(),this.$el=n instanceof r.$?n:r.$(n),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this instanceof r.Application||this.bindView(),this},appendView:function(n){if(arguments.length>1)return i.each(arguments,function(n){this.appendView(n)},this),this;if(!(n instanceof r.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.append(n.el),this},prependView:function(n){if(arguments.length>1)return i.each(arguments,function(n){this.prependView(n)},this),this;if(!(n instanceof r.View))throw new Error("Parameter must be instance of conbo.View class");return this.$el.prepend(n.el),this},mouseEnabled:function(){return this._setClass.apply(this,i.union(["conbo-disabled"],i.toArray(arguments)))},visible:function(){return this._setClass.apply(this,i.union(["conbo-invisible"],i.toArray(arguments)))},includeInLayout:function(){return this._setClass.apply(this,i.union(["conbo-excludeFromLayout"],i.toArray(arguments)))},bindView:function(){return this.$("[data-property]").each(this.bind(function(n,i){var u=this.$(i).data(),e;if(p=u.property,s=u.source,f=typeof this[u.parse]=="function"?this[u.parse]:t,!!s&&!(s in this))throw new Error("Unable to bind element to undefined source: "+s);e=!s?this:this[s],r.BindingUtils.bindElement(e,p,i,f)})),this},unbindView:function(){return this},loadCSS:function(t){if("document"in n){var i;return i=document.createElement("link"),i.type="text/css",i.rel="stylesheet",i.href=t,document.getElementsByTagName("head")[0].appendChild(i),this}},delegateEvents:function(n){var r,t;if(n||(n=i.result(this,"events"))){this.undelegateEvents();for(r in n){if(t=n[r],i.isFunction(t)||(t=this[n[r]]),!t)throw new Error('Method "'+n[r]+'" does not exist');var f=r.match(o),u=f[1],e=f[2];if(t=i.bind(t,this),u+=".delegateEvents"+this.cid,e==="")this.$el.on(u,t);else this.$el.on(u,e,t)}return this}},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},toString:function(){return"[conbo.View]"},_addStyle:function(){if(!!r.style)return this;var n=r.$('<style type="text/css">.conbo-invisible { visibility:hidden !important; }.conbo-excludeFromLayout { display:none !important; }.conbo-disabled { pointer-events:none !important; }<\/style>');return r.$("head").append(n),r.style=n,this},_configure:function(n){this.options&&(n=i.extend({},i.result(this,"options"),n)),i.extend(this,i.pick(n,h)),this.options=n},_ensureElement:function(){var n,t;this.el?(this.setElement(i.result(this,"el"),!1),this.className&&this.$el.addClass(this.className)):(n=i.extend({},i.result(this,"attributes")),this.id&&(n.id=i.result(this,"id")),this.className&&(n["class"]=i.result(this,"className")),t=r.$("<"+i.result(this,"tagName")+">").attr(n),this.setElement(t,!1))},_setClass:function(n,t){var u=i.rest(arguments),f,e;return u.length?(f=i.isString(t)||i.isElement(t)||t instanceof r.$,e=f?this.$(t):this.$el,u.length==1&&f)?!e.hasClass(n):(u.length==2&&f&&(t=u[1]),e.removeClass(n),t||e.addClass(n),this):!this.$el.hasClass(n)}}),r.Actor=r.Bindable.extend({constructor:function(n){this._inject(n),this.initialize.apply(this,arguments)}}),r.Application=r.View.extend({contextClass:r.Context,constructor:function(n){n=n||{},n.view=n.view||this,this.context=n.context||new this.contextClass(n),r.View.prototype.constructor.apply(this,arguments)},toString:function(){return"[conbo.Application]"}}),r.Command=r.EventDispatcher.extend({constructor:function(n){this._inject(n),this.event=this.options.event||{},this.initialize.apply(this,arguments)},initialize:function(){},execute:function(){},toString:function(){return"[conbo.Command]"}}),r.ServerApplication=r.Bindable.extend({contextClass:r.Context,constructor:function(n){n=n||{},n.view=n.view||this,this.context=n.context||new this.contextClass(n),this._inject(n),this.options=n,this.initialize.apply(this,arguments)},initialize:function(){},toString:function(){return"[conbo.ServerApplication]"}}),r}typeof module!="undefined"&&module.exports?module.exports=i():typeof define=="function"&&define.amd?define("conbo",["jquery","underscore"],function(){return i()}):n.conbo=i()})(this)