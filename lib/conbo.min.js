!function(a,b,c){"function"==typeof define&&define.amd?define("conbo",["jquery"],function(d){return c(a,b,d)}):"undefined"!=typeof module&&module.exports?b?module.exports=c(a,b,require("jquery")):module.exports=c(a):a.conbo=c(a,b,a.$)}(this,this.document,function(window,document,$,undefined){"use strict";var __namespaces={},conbo=function(a){if(!a||!conbo.isString(a))return void conbo.warn("First parameter must be the namespace string, received",a);__namespaces[a]||(__namespaces[a]=new conbo.Namespace);var b=__namespaces[a],c=conbo.rest(arguments),d=c.pop();if(conbo.isFunction(d)){var e=d.apply(b,c);conbo.isObject(e)&&!conbo.isArray(e)&&b.extend(e)}return b};conbo.conbo=conbo,conbo.VERSION="3.2.4",conbo.toString=function(){return"ConboJS v"+this.VERSION},$&&(conbo.$=$,$(function(){conbo.info(conbo.toString())})),function(){var breaker=!1,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;conbo.forEach=function(a,b,c){if(null!=a){var d,e;if(conbo.isIterable(a)){for(d=0,e=a.length;e>d;++d)if(b.call(c,a[d],d,a)===breaker)return}else{var f=conbo.keys(a);for(d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===breaker)return}return a}};var forEach=conbo.forEach;conbo.map=function(a,b,c){var d=[];return null==a?d:nativeMap&&a.map===nativeMap?a.map(b,c):(forEach(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)},conbo.indexOf=function(a,b){return nativeIndexOf.call(a,b)},conbo.lastIndexOf=function(a,b){return nativeLastIndexOf.call(a,b)},conbo.find=function(a,b,c){var d;return conbo.some(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},conbo.findIndex=function(a,b,c){var d=conbo.find(a,b,c);return a.indexOf(d)},conbo.filter=function(a,b,c){var d=[];return null==a?d:nativeFilter&&a.filter===nativeFilter?a.filter(b,c):(forEach(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},conbo.reject=function(a,b,c){return conbo.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},conbo.every=function(a,b,c){b||(b=conbo.identity);var d=!0;return null==a?d:nativeEvery&&a.every===nativeEvery?a.every(b,c):(forEach(a,function(a,e,f){return(d=d&&b.call(c,a,e,f))?void 0:breaker}),!!d)},conbo.some=function(a,b,c){b||(b=conbo.identity);var d=!1;return null==a?d:nativeSome&&a.some===nativeSome?a.some(b,c):(forEach(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?breaker:void 0}),!!d)};var some=conbo.some;conbo.contains=function(a,b){return null==a?!1:-1!=a.indexOf(b)},conbo.invoke=function(a,b){var c=slice.call(arguments,2),d=conbo.isFunction(b);return conbo.map(a,function(a){return(d?b:a[b]).apply(a,c)})},conbo.pluck=function(a,b){return conbo.map(a,conbo.property(b))},conbo.max=function(a,b,c){if(!b&&conbo.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-(1/0),e=-(1/0);return forEach(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},conbo.min=function(a,b,c){if(!b&&conbo.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return forEach(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},conbo.shuffle=function(a){var b,c=0,d=[];return forEach(a,function(a){b=conbo.random(c++),d[c-1]=d[b],d[b]=a}),d};var lookupIterator=function(a){return null==a?conbo.identity:conbo.isFunction(a)?a:conbo.property(a)};conbo.toArray=function(a){return a?conbo.isArray(a)?slice.call(a):conbo.isIterable(a)?conbo.map(a,conbo.identity):conbo.values(a):[]},conbo.size=function(a){return a?conbo.isIterable(a)?a.length:conbo.keys(a).length:0},conbo.last=function(a,b,c){return null==a?undefined:null==b||c?a[a.length-1]:slice.call(a,Math.max(a.length-b,0))},conbo.rest=function(a,b,c){return slice.call(a,null==b||c?1:b)},conbo.compact=function(a){return conbo.filter(a,conbo.identity)};var flatten=function(a,b,c){return b&&conbo.every(a,conbo.isArray)?concat.apply(c,a):(forEach(a,function(a){conbo.isArray(a)||conbo.isArguments(a)?b?push.apply(c,a):flatten(a,b,c):c.push(a)}),c)};conbo.flatten=function(a,b){return flatten(a,b,[])},conbo.without=function(a){return conbo.difference(a,slice.call(arguments,1))},conbo.partition=function(a,b){var c=[],d=[];return forEach(a,function(a){(b(a)?c:d).push(a)}),[c,d]},conbo.uniq=function(a,b,c,d){conbo.isFunction(b)&&(d=c,c=b,b=!1);var e=c?conbo.map(a,c,d):a,f=[],g=[];return forEach(e,function(c,d){(b?d&&g[g.length-1]===c:conbo.contains(g,c))||(g.push(c),f.push(a[d]))}),f},conbo.union=function(){return conbo.uniq(conbo.flatten(arguments,!0))},conbo.intersection=function(a){var b=slice.call(arguments,1);return conbo.filter(conbo.uniq(a),function(a){return conbo.every(b,function(b){return conbo.contains(b,a)})})},conbo.difference=function(a){var b=concat.apply(ArrayProto,slice.call(arguments,1));return conbo.filter(a,function(a){return!conbo.contains(b,a)})},conbo.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},conbo.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var ctor=function(){};conbo.bind=function(a,b){var c;if(nativeBind&&a.bind===nativeBind)return nativeBind.apply(a,slice.call(arguments,1));if(!conbo.isFunction(a))throw new TypeError;return c=slice.call(arguments,2),function(){if(!(this instanceof bound))return a.apply(b,c.concat(slice.call(arguments)));ctor.prototype=a.prototype;var d=new ctor;ctor.prototype=null;var e=a.apply(d,c.concat(slice.call(arguments)));return Object(e)===e?e:d}},conbo.partial=function(a){var b=slice.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===conbo&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},conbo.bindAll=function(a,b){var c=b instanceof RegExp,d=slice.call(arguments,1);return(c||0===d.length)&&(d=conbo.functions(a),c&&(d=conbo.filter(d,function(a){return b.test(a)}))),d.forEach(function(b){a[b]=conbo.bind(a[b],a)}),a},conbo.defer=function(a,b){return b&&(a=conbo.bind(a,b)),setTimeout.apply(null,[a,0].concat(conbo.rest(arguments,2)))},conbo.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},conbo.wrap=function(a,b){return conbo.partial(b,a)},conbo.keys=function(a,b){if(!conbo.isObject(a))return[];if(nativeKeys&&!b)return nativeKeys(a);var c=[];for(var d in a)(b||conbo.has(a,d))&&c.push(d);return c},conbo.getAllPropertyNames=function(a){var b=[];do{var c=Object.getOwnPropertyNames(a);c.forEach(function(a){-1===b.indexOf(a)&&b.push(a)})}while(a=Object.getPrototypeOf(a));return b},conbo.getPublicPropertyNames=function(a){return conbo.filter(conbo.getAllPropertyNames(a),function(a){return!/^_.+/.test(a)})},conbo.getPrivatePropertyNames=function(a){return conbo.filter(conbo.getAllPropertyNames(a),function(a){return/^_[a-z\d]+/i.test(a)})},conbo.getInternalPropertyNames=function(a){return conbo.filter(conbo.getAllPropertyNames(a),function(a){return/^__.+/.test(a)})},conbo.values=function(a,b){for(var c=conbo.keys(a,b),d=c.length,e=new Array(d),f=0;d>f;f++)e[f]=a[c[f]];return e},conbo.functions=function(a){var b=[],c=conbo.getAllPropertyNames(a);return c.forEach(function(c){conbo.isFunction(a[c])&&b.push(c)}),b.sort()},conbo.defineValues=function(a){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)conbo.cloneProperty(b,c,a)}),a},conbo.defineBindableValues=function(a){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)delete a[c],__defineProperty(a,c,b[c])}),a},conbo.pick=function(a){var b={},c=concat.apply(ArrayProto,slice.call(arguments,1));return forEach(c,function(c){c in a&&conbo.cloneProperty(a,c,b)}),b},conbo.omit=function(a){var b={},c=concat.apply(ArrayProto,slice.call(arguments,1));for(var d in a)conbo.contains(c,d)||conbo.cloneProperty(a,d,b);return b},conbo.defineDefaults=function(a){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]===undefined&&conbo.cloneProperty(b,c,a)}),a},conbo.setDefaults=function(a){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]===undefined&&(a[c]=b[c])}),a},conbo.clone=function(a){return conbo.isObject(a)?conbo.isArray(a)?a.slice():conbo.defineValues({},a):a};var eq=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;var e=toString.call(a);if(e!=toString.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0===a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(conbo.isFunction(g)&&g instanceof g&&conbo.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,j=!0;if("[object Array]"==e){if(i=a.length,j=i==b.length)for(;i--&&(j=eq(a[i],b[i],c,d)););}else{for(var k in a)if(conbo.has(a,k)&&(i++,!(j=conbo.has(b,k)&&eq(a[k],b[k],c,d))))break;if(j){for(k in b)if(conbo.has(b,k)&&!i--)break;j=!i}}return c.pop(),d.pop(),j};conbo.isEqual=function(a,b){return eq(a,b,[],[])},conbo.isEmpty=function(a){return!a||conbo.isArray(a)&&0===a.length||!isNaN(a)&&!parseFloat(a)||conbo.isObject(a)&&!conbo.keys(a).length||conbo.isObject(a)&&"length"in a&&0===a.length},conbo.isIterable=function(a){return a&&a.length===+a.length},conbo.isElement=function(a){return!(!a||1!==a.nodeType)},conbo.isArray=nativeIsArray||function(a){return"[object Array]"==toString.call(a)},conbo.isObject=function(a){return a===Object(a)},forEach(["Arguments","Function","String","Number","Date","RegExp"],function(a){conbo["is"+a]=function(b){return toString.call(b)=="[object "+a+"]"}}),conbo.isArguments(arguments)||(conbo.isArguments=function(a){return!(!a||!conbo.has(a,"callee"))}),"function"!=typeof/./&&(conbo.isFunction=function(a){return"function"==typeof a}),conbo.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},conbo.isNaN=function(a){return conbo.isNumber(a)&&a!=+a},conbo.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==toString.call(a)},conbo.isNull=function(a){return null===a},conbo.isUndefined=function(a){return a===undefined},conbo.has=function(a,b){return hasOwnProperty.call(a,b)},conbo.identity=function(a){return a},conbo.property=function(a){return function(b){return b[a]}},conbo.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},conbo.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var idCounter=0;conbo.uniqueId=function(a){var b=++idCounter+"";return a?a+b:b},conbo.isSupported=window.addEventListener&&!!Object.defineProperty&&!!Object.getOwnPropertyDescriptor,conbo.noop=function(){},conbo.noopr=function(a){return a},conbo.notImplemented=function(){conbo.warn("Method not implemented")},conbo.toCamelCase=function(a,b){var c=(a||"").toLowerCase().replace(/([\W_])([a-z])/g,function(a){return a[1].toUpperCase()}).replace(/(\W+)/,"");return b?c.charAt(0).toUpperCase()+c.slice(1):c},conbo.toUnderscoreCase=function(a,b){return b||(b="_"),(a||"").replace(/\W+/g,b).replace(/([a-z\d])([A-Z])/g,"$1"+b+"$2").toLowerCase()},conbo.toKebabCase=function(a){return conbo.toUnderscoreCase(a,"-")},conbo.padLeft=function(a,b,c){for(c||0===c||(c=" "),a||0===a||(a=""),b||(b=2),c=c.toString().charAt(0),string=a.toString();string.length<b;)string=c+string;return string},conbo.addLeadingZero=function(a,b){return conbo.padLeft(a,b,0)},conbo.formatNumber=function(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g=conbo.isUndefined(d)?",":d,h=conbo.isUndefined(c)?".":c,i=e.toFixed(f).split(".");return i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)},conbo.formatCurrency=function(a,b,c,d,e,f){conbo.isUndefined(d)&&(d=2),b||(b="");var g=conbo.formatNumber(a,d,e,f);return c?g+b:b+g},conbo.encodeEntities=function(a){return conbo.isString(a)||(a=conbo.isNumber(a)?a.toString():""),a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"&#"+a.charCodeAt(0)+";"})},conbo.decodeEntities=function(a){return conbo.isString(a)||(a=""),a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)})},conbo.setValues=function(a){return conbo.rest(arguments).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a},conbo.isClass=function(a,b){return!!a&&"function"==typeof a&&a.prototype instanceof(b||conbo.Class)},conbo.cloneProperty=function(a,b,c,d){d||(d=b);var e=Object.getOwnPropertyDescriptor(a,b);return e?Object.defineProperty(c,d,e):c[d]=a[b],this},conbo.sortOn=function(a,b,c){return c||(c={}),conbo.isArray(a)&&b&&a.sort(function(a,d){var e=[a[b],d[b]];return c.descending&&e.reverse(),c.caseInsensitive&&conbo.forEach(e,function(a,b){conbo.isString(a)&&(e[b]=a.toLowerCase())}),e[0]<e[1]?-1:e[0]>e[1]?1:0}),a},conbo.instanceOf=function(a,b){if(!a||conbo.isClass(a))return!1;for(var c=conbo.rest(arguments),d=0,e=c.length;e>d;d++){if(b=c[d],!b)return!1;try{if(a instanceof b)return!0}catch(f){}if(!conbo.isObject(b))return!1;for(var g in b)if(!(g in a)||conbo.isFunction(a[g])!=conbo.isFunction(b[g]))return!1}return!0},conbo.loadCss=function(a,b){if(!("document"in window)||document.querySelector('[href="'+a+'"]'))return this;var c,d;return c=document.createElement("link"),c.rel="stylesheet",c.type="text/css",c.href=a,c.media=b||"all",d=document.getElementsByTagName("head")[0],d.appendChild(c),this},conbo.loadScript=function(a){return conbo.httpRequest({url:a,dataType:"script"})},conbo.properties=function(a,b){return conbo.difference(conbo.keys(a,b),conbo.functions(a))},conbo.makeBindable=function(a,b){return b||(b=conbo.properties(a)),b.forEach(function(b){__defineProperty(a,b)}),this},conbo.makeAllBindable=function(a,b,c){return b=conbo.uniq((b||[]).concat(conbo.properties(a,c))),conbo.makeBindable(a,b),this},conbo.isAccessor=function(a,b){return a?!!a.__lookupGetter__(b)||!!a.__lookupSetter__(b):!1},conbo.isBindable=function(a,b){return conbo.isAccessor(a,b)?!!(a.__lookupSetter__(b)||{}).bindable:!1},conbo.parseTemplate=function(template,data){return template?(data||(data={}),template.replace(/(({{(.+?)}})|(\${(.+?)}))/g,function(propNameInBrackets,propName){var args=propName.split("|"),value,parseFunction;args[0]=conbo.BindingUtils.cleanPropertyName(args[0]);try{value=eval("data."+args[0])}catch(e){}try{parseFunction=eval("data."+args[1])}catch(e){}return conbo.isFunction(parseFunction)||(parseFunction=conbo.BindingUtils.defaultParseFunction),parseFunction(value)})):""},conbo.compileTemplate=function(a,b){return function(c){return conbo.parseTemplate(a,conbo.setDefaults(c||{},b))}},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),conbo.logEnabled=!0;var logMethods=["log","warn","info","error"];logMethods.forEach(function(a){conbo[a]=function(){console&&conbo.logEnabled&&console[a].apply(console,arguments)}})}();var __dispatchChange=function(a,b){if(a instanceof conbo.EventDispatcher){var c={property:b,value:a[b]};return a.dispatchEvent(new conbo.ConboEvent("change:"+b,c)),a.dispatchEvent(new conbo.ConboEvent("change",c)),this}},__defineProperty=function(a,b,c,d,e,f){if(conbo.isAccessor(a,b))return this;conbo.isUndefined(c)&&(c=a[b]);var g=!d&&!e;return arguments.length<6&&(f=0!==b.indexOf("_")),g?(d=function(){return c},e=function(a){conbo.isEqual(a,c)||(c=a,__dispatchChange(this,b,c))},e.bindable=!0):e&&(e=conbo.wrap(e,function(c,d){c.call(this,d),__dispatchChange(this,b,a[b])}),e.bindable=!0),Object.defineProperty(a,b,{enumerable:f,configurable:!0,get:d,set:e}),this},__definePrivateProperty=function(a,b,c){return 2==arguments.length&&(c=a[b]),Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!0,value:c}),this},__definePrivateProperties=function(a,b){for(var c in b)__definePrivateProperty(a,c,b[c]);return this},__denumerate=function(a){var b=arguments[1],c=b instanceof RegExp?conbo.filter(conbo.keys(a),function(a){return b.test(a)}):arguments.length>1?conbo.rest(arguments):conbo.keys(a);return c.forEach(function(b){var c=Object.getOwnPropertyDescriptor(a,b)||{value:a[b],configurable:!0,writable:!0};c.enumerable=!1,Object.defineProperty(a,b,c)}),this};conbo.initDom=function(a,b){if(!a)throw new Error("initDom: namespace is undefined");conbo.isString(a)&&(a=conbo(a));var c=$(b||"html");return $(function(){c.find("*").not(".cb-app").each(function(b,c){var d=$(c),e=d.attr("cb-app")||conbo.toCamelCase(c.tagName,!0),f=a[e];f&&conbo.isClass(f,conbo.Application)&&new f({el:c})})}),this};var __observers=[],__getObserverIndex=function(a,b){for(var c=__observers.length,d=0;c>d;d++){var e=__observers[d];if(e[0]==a&&e[1]==b)return d}return-1};if(conbo.observeDom=function(a,b){if(conbo.isString(a)&&(a=conbo(a)),-1==__getObserverIndex(a,b)){var c,d=$(b||"html");return c=new conbo.MutationObserver,c.observe(d[0]),c.addEventListener(conbo.ConboEvent.ADD,function(b){b.nodes.forEach(function(b){var c=$(b),d=c.cbAttrs().app;a[d]&&!c.hasClass("cb-app")&&new a[d]({el:b})})}),__observers.push([a,b,c]),this}},conbo.unobserveDom=function(a,b){conbo.isString(a)&&(a=conbo(a));var c=__getObserverIndex(a,b);if(-1!=c){var d=__observers[c];d[2].removeEventListener(),__observers.slice(c,1)}return this},$&&($.fn.attrs=function(a){var b=$(this);if(arguments.length)return b.each(function(b,c){var d=$(c);for(var e in a)d.attr(e,a[e])}),b;var c={};return conbo.forEach(b[0].attributes,function(a){c[conbo.toCamelCase(a.nodeName)]=a.nodeValue}),c},$.fn.cbAttrs=function(a){for(var b,c={},d=conbo.toArray(this.get()[0].attributes),e=0;e<d.length;++e)0===d[e].name.indexOf("cb-")&&(b=d[e].name.substr(3),a!==!1&&(b=conbo.toCamelCase(b)),c[b]=d[e].value);return c},$.fn.cbViews=function(a){return this.find(".cb-view, .cb-glimpse").filter(function(){return conbo.instanceOf(this.cbView||this.cbGlimpse,a)})},$.expr[":"].cbAttr=function(a,b,c,d){var e=$(a),f=(c[3]||"").split(","),g=e.cbAttrs(),h=conbo.keys(g);return h.length?g&&!f.length?!0:f[0]&&!f[1]?f[0]in g:f[0]&&f[1]?g[f[0]]==f[1]:!1:!1}),$){var $head=$("head");if($head.find("#cb-style").length)return;$head.append('<style id="cb-style" type="text/css">\n.cb-hide { visibility:hidden !important; }\n.cb-exclude { display:none !important; }\n.cb-disable { pointer-events:none !important; cursor:default !important; }\n.cb-app span { font:inherit; color:inherit; }\n</style>')}conbo.Class=function(a){this.declarations.apply(this,arguments),this.preinitialize.apply(this,arguments),this.initialize.apply(this,arguments)},conbo.Class.prototype={declarations:function(){},preinitialize:function(){},initialize:function(){},get supro(){return Object.getPrototypeOf(Object.getPrototypeOf(this))},bind:function(a){return conbo.bind.apply(conbo,[a,this].concat(conbo.rest(arguments)))},bindAll:function(){return conbo.bindAll.apply(conbo,[this].concat(conbo.toArray(arguments))),this},toString:function(){return"conbo.Class"}},__denumerate(conbo.Class.prototype),conbo.Class.extend=function(a,b){var c,d=this;c=a&&conbo.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},conbo.defineValues(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&conbo.defineValues(c.prototype,a),conbo.makeBindable(c.prototype),c},conbo.Class.implement=function(){var a=conbo.defineDefaults.apply(conbo,conbo.union([{}],arguments)),b=conbo.keys(a),c=this.prototype;conbo.defineDefaults(this.prototype,a);var d=conbo.reject(b,function(a){return c[a]!==conbo.notImplemented});if(d.length)throw new Error(c.toString()+" does not implement the following method(s): "+d.join(", "));return this},conbo.ConboClass=conbo.Class.extend({constructor:function(a){var b=conbo.toArray(arguments);b[0]===undefined&&(b[0]={}),this.declarations.apply(this,b),this.preinitialize.apply(this,b),this.__construct.apply(this,b),this.initialize.apply(this,b),conbo.makeAllBindable(this,this.bindable),this.__postInitialize.apply(this,b)},toString:function(){return"conbo.ConboClass"},__construct:function(){},__postInitialize:function(){}}),__denumerate(conbo.ConboClass.prototype),conbo.Namespace=conbo.ConboClass.extend({__construct:function(){if($){var a=this.bind(function(){this.autoInit!==!1&&this.initDom()});$(a)}},initDom:function(a){return conbo.initDom(this,a),this},observeDom:function(a){return conbo.observeDom(this,a),this},unobserveDom:function(a){return conbo.unobserveDom(this,a),this},extend:function(a){return conbo.setDefaults.apply(conbo,[this].concat(conbo.toArray(arguments))),this}}),conbo.IInjectable={get context(){return this.__context},set context(a){a!=this.__context&&(a instanceof conbo.Context&&a.injectSingletons(this),this.__context=a,__denumerate(this,"__context"))}},conbo.Event=conbo.Class.extend({constructor:function(a){if(this.preinitialize.apply(this,arguments),conbo.isString(a)?this.type=a:conbo.defineDefaults(this,a),!this.type)throw new Error("Invalid or undefined event type");this.initialize.apply(this,arguments)},initialize:function(a,b){this.data=b},clone:function(){return conbo.clone(this)},preventDefault:function(){return this.defaultPrevented=!0,this},stopPropagation:function(){return this.cancelBubble=!0,this},stopImmediatePropagation:function(){return this.immediatePropagationStopped=!0,this.stopPropagation(),this},toString:function(){return"conbo.Event"}},{ALL:"*"}),__denumerate(conbo.Event.prototype),conbo.ConboEvent=conbo.Event.extend({initialize:function(a,b){conbo.defineDefaults(this,b)},toString:function(){return"conbo.ConboEvent"}},{ALL:"*",ERROR:"error",INVALID:"invalid",CHANGE:"change",ADD:"add",REMOVE:"remove",DESTROY:"destroy",RESET:"reset",SORT:"sort",REQUEST:"request",SYNC:"sync",ROUTE:"route",NAVIGATE:"navigate",STARTED:"started",STOPPED:"stopped",TEMPLATE_LOADED:"templateloaded",TEMPLATE_ERROR:"templateerror",BIND:"bind",BOUND:"bound",UNBOUND:"unbound",INIT:"init",CREATION_COMPLETE:"creationcomplete",DETACH:"detach",RESULT:"result",FAULT:"fault"}),__denumerate(conbo.ConboEvent.prototype),conbo.EventDispatcher=conbo.ConboClass.extend({__construct:function(a){a.context&&(this.context=a.context)},addEventListener:function(a,b,c,d,e){if(!a)throw new Error("Event type undefined");if(!b||!conbo.isFunction(b))throw new Error("Event handler is undefined or not a function");return conbo.isString(a)&&(a=a.split(" ")),conbo.isArray(a)&&conbo.forEach(a,function(a,f,g){this.__addEventListener(a,b,c,d,!!e)},this),this},removeEventListener:function(a,b,c){return arguments.length?(conbo.isString(a)&&(a=a.split(" ")),conbo.isArray(a)||(a=[undefined]),conbo.forEach(a,function(a,d,e){this.__removeEventListener(a,b,c)},this),this):(__definePrivateProperty(this,"__queue",{}),this)},hasEventListener:function(a,b,c){if(!(this.__queue&&a in this.__queue&&this.__queue[a].length))return!1;for(var d=this.__queue[a],e=d.length,f=0;e>f;f++)if(!(b&&d[f].handler!=b||c&&d[f].scope!=c))return!0;return!1},dispatchEvent:function(a){if(!a)throw new Error("Event undefined");var b=conbo.isString(a);if(b&&conbo.warn('Use of dispatchEvent("'+a+'") is deprecated, please use dispatchEvent(new conbo.Event("'+a+'"))'),!b&&a instanceof conbo.Event||(a=new conbo.Event(a)),!this.__queue||!(a.type in this.__queue)&&!this.__queue.all)return this;a.target||(a.target=this),a.currentTarget=this;var c=conbo.union(this.__queue[a.type]||[],this.__queue.all||[]);if(!c||!c.length)return this;for(var d=0,e=c.length;e>d;++d){var f=c[d],g=f.handler.call(f.scope||this,a);if(f.once&&this.__removeEventListener(a.type,f.handler,f.scope),g===!1||a.immediatePropagationStopped)break}return this},dispatchChange:function(){return conbo.forEach(arguments,function(a){__dispatchChange(this,a)},this),this},toString:function(){return"conbo.EventDispatcher"},__addEventListener:function(a,b,c,d,e){"*"==a&&(a="all"),this.__queue||__definePrivateProperty(this,"__queue",{}),this.hasEventListener(a,b,c)||(a in this.__queue||(this.__queue[a]=[]),this.__queue[a].push({handler:b,scope:c,once:e,priority:d||0}),this.__queue[a].sort(function(a,b){return b.priority-a.priority}))},__removeEventListener:function(a,b,c){if("*"==a&&(a="all"),this.__queue){var d,e,f=this,g=function(a,d){for(e=0;e<a.length;e++)a[e].handler&&a[e].handler!=b||a[e].scope&&a[e].scope!=c||a.splice(e--,1);a.length||delete f.__queue[d]};a in this.__queue?(d=this.__queue[a],g(d,a)):a==undefined&&conbo.forEach(this.__queue,function(a,b){g(a,b)})}}}).implement(conbo.IInjectable),__definePrivateProperty(conbo.EventDispatcher.prototype,"bindable"),__denumerate(conbo.EventDispatcher.prototype),conbo.Context=conbo.EventDispatcher.extend({__construct:function(a){__definePrivateProperties(this,{__commands:{},__singletons:{},__app:a.app,__namespace:a.namespace||a.app.namespace,__parentContext:a instanceof conbo.Context?a:undefined}),this.addEventListener(conbo.Event.ALL,this.__allHandler)},get app(){return this.__app},get namespace(){return this.__namespace},get parentContext(){return this.__parentContext},createSubcontext:function(a){return a||(a=conbo.Context),new a(this)},mapCommand:function(a,b){if(!a)throw new Error("eventType cannot be undefined");if(!b)throw new Error("commandClass for "+a+" cannot be undefined");if(!(this.__mapMulti(a,b,this.mapCommand)||this.__commands[a]&&-1!=this.__commands[a].indexOf(b)))return this.__commands[a]=this.__commands[a]||[],this.__commands[a].push(b),this},unmapCommand:function(a,b){if(!a)throw new Error("eventType cannot be undefined");if(!this.__mapMulti(a,b,this.unmapCommand)){if(b===undefined)return void delete this.__commands[a];if(this.__commands[a]){var c=this.__commands[a].indexOf(b);if(-1!=c)return this.__commands[a].splice(c,1),this}}},mapSingleton:function(a,b){if(!a)throw new Error("propertyName cannot be undefined");return b===undefined&&conbo.warn("singletonClass for "+a+" is undefined"),this.__mapMulti(a,b,this.mapSingleton)?void 0:(this.__singletons[a]=conbo.isClass(b)?new b(arguments[2],arguments[3],arguments[4]):b,this)},unmapSingleton:function(a){if(!a)throw new Error("propertyName cannot be undefined");if(!this.__mapMulti(a,null,this.unmapSingleton)&&this.__singletons[a])return delete this.__singletons[a],this},mapConstant:function(a,b){return this.mapSingleton(a,b)},unmapConstant:function(a){return this.unmapSingleton(a)},addTo:function(a){return conbo.defineValues(a||{},{context:this})},injectSingletons:function(a){for(var b in a)a[b]===undefined&&b in this.__singletons&&(a[b]=this.__singletons[b]);return this},uninjectSingletons:function(a){for(var b in a)b in this.__singletons&&(a[b]=undefined);return this},toString:function(){return"conbo.Context"},__allHandler:function(a){var b=conbo.union(this.__commands.all||[],this.__commands[a.type]||[]);b.length&&conbo.forEach(b,function(b,c,d){this.__executeCommand(b,a)},this)},__executeCommand:function(a,b){var c,d;return d={event:b},c=new a(this.addTo(d)),c.execute(),c=null,this},__mapMulti:function(a,b,c){if(conbo.isArray(a)||-1==a.indexOf(" "))return!1;var d=conbo.isArray(a)?a:a.split(" ");return conbo.forEach(d,function(a){c(a,b)},this),!0}}),__denumerate(conbo.Context.prototype),conbo.Hash=conbo.EventDispatcher.extend({__construct:function(a){a.context&&(this.context=a.context),conbo.setDefaults(this,a.source,this.defaults),delete this.defaults},toJSON:function(){var a=function(a){return 0!==String(a).indexOf("_")},b={},c=conbo.filter(conbo.properties(this),a);return c.forEach(function(a){b[a]=this[a]},this),b},toString:function(){return"conbo.Hash"}}),__denumerate(conbo.Hash.prototype),conbo.LocalHash=conbo.Hash.extend({__construct:function(a){var b="ConboLocalHash";a=conbo.defineDefaults(a,{name:b});var c=a.name,d=a.session?window.sessionStorage:window.localStorage;c==b&&conbo.warn("No name specified for "+this.toString+', using "'+b+'"');var e=function(){return c in d?JSON.parse(d.getItem(c)||"{}"):a.source||{}};this.addEventListener(conbo.ConboEvent.CHANGE,function(a){d.setItem(c,JSON.stringify(this.toJSON()))},this,1e3),a.source=e(),conbo.Hash.prototype.__construct.call(this,a)},flush:function(){this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE))},toString:function(){return"conbo.LocalHash"}}),__denumerate(conbo.LocalHash.prototype),conbo.List=conbo.EventDispatcher.extend({itemClass:conbo.Hash,__construct:function(a){this.addEventListener(conbo.ConboEvent.CHANGE,this.__changeHandler,this,999);var b=["context","itemClass"];conbo.setValues(this,conbo.pick(a,b)),this.source=a.source||[]},get source(){return this._source||(this._source=[]),this._source},set source(a){this._source=[],this.push.apply(this,conbo.toArray(a)),this.dispatchChange("source","length")},get length(){return this.source?this.source.length:0},push:function(a){var b=conbo.toArray(arguments);return b.length&&(this.source.push.apply(this.source,this.__applyItemClass(b)),this.__updateBindings(b),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),this.dispatchChange("length")),this.length},pop:function(){if(this.length){var a=this.source.pop();return this.__updateBindings(a,!1),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),this.dispatchChange("length"),a}},unshift:function(a){return a&&(this.source.unshift.apply(this.source,this.__applyItemClass(conbo.toArray(arguments))),this.__updateBindings(conbo.toArray(arguments)),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),this.dispatchChange("length")),this.length},shift:function(){if(this.length){var a=this.source.shift();return this.__updateBindings(a,!1),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),this.dispatchChange("length"),a}},slice:function(a,b){return a||(a=0),conbo.isUndefined(b)&&(b=this.length),new conbo.List({source:this.source.slice(a,b)})},splice:function(a,b){a||(a=0),conbo.isUndefined(b)&&(b=this.length);var c=conbo.rest(arguments,2),d=this.source.splice.apply(this.source,[a,b].concat(c));return d.length&&this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),c.length&&this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),(d.length||c.length)&&this.dispatchChange("length"),new conbo.List({source:d})},getItemAt:function(a){return this.source[a]},setItemAt:function(a,b){var c=this.length,d=this.source[a];return this.__updateBindings(d,!1),this.source[a]=model,this.__updateBindings(model),this.length>c&&(this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),this.dispatchChange("length")),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE,{item:b})),d},sort:function(a){return this.source.sort(a),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.SORT)),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE)),this},clone:function(){return new this.constructor(this.source)},toJSON:function(){var a=[];return this.forEach(function(b){conbo.isFunction(b.toJSON)?a.push(b.toJSON()):a.push(b)}),a},toString:function(){return"conbo.List"},__updateBindings:function(a,b){var c=b===!1?"removeEventListener":"addEventListener";for(a=(conbo.isArray(a)?a:[a]).slice();a.length;){var d=a.pop();d instanceof conbo.EventDispatcher&&d[c](conbo.ConboEvent.CHANGE,this.dispatchEvent,this)}},__changeHandler:function(a){
var b,c=this.bind(function(a){Object.defineProperty(this,a,{get:function(){return this.getItemAt(a)},set:function(b){this.setItemAt(a,b)},configurable:!0,enumerable:!0})});for(b=0;b<this.length;b++)c(b);for(;b in this;)delete this[b++]},__applyItemClass:function(a){if(a instanceof Array){for(var b=0;b<a.length;b++)a[b]=this.__applyItemClass(a[b]);return a}return!conbo.isObject(a)||conbo.isClass(a)||a instanceof conbo.Class||(a=new this.itemClass({source:a,context:this.context})),a}}).implement(conbo.IInjectable);var listMethods=["forEach","map","reduce","reduceRight","find","findIndex","filter","reject","every","any","contains","invoke","indexOf","lastIndexOf","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","shuffle","isEmpty","chain","sortOn"];listMethods.forEach(function(a){a in conbo&&(conbo.List.prototype[a]=function(){var b=[this.source].concat(conbo.toArray(arguments)),c=conbo[a].apply(conbo,b);return conbo.isArray(c)?new conbo.List({source:c,itemClass:this.itemClass}):c})}),__denumerate(conbo.List.prototype),conbo.LocalList=conbo.List.extend({__construct:function(a){var b="ConboLocalList";a=conbo.defineDefaults(a,this.options,{name:b});var c=a.name,d=a.session?window.sessionStorage:window.localStorage;c==b&&conbo.warn("No name specified for "+this.toString+', using "'+b+'"');var e=function(){return c in d?JSON.parse(d.getItem(c)||"[]"):a.source||[]};this.addEventListener(conbo.ConboEvent.CHANGE,function(a){d.setItem(c,JSON.stringify(this))},this,1e3),a.source=e(),conbo.List.prototype.__construct.call(this,a)},flush:function(){this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE))},toString:function(){return"conbo.LocalList"}}),__denumerate(conbo.LocalList.prototype),conbo.AttributeBindings=conbo.Class.extend({initialize:function(){this.cbClass.multiple=!0,this.cbStyle.multiple=!0,this.cbIncludeIn.raw=!0,this.cbExcludeFrom.raw=!0},canHandleMultiple:function(a){var b=conbo.toCamelCase(a);return b in this?!!this[b].multiple:!1},cbShow:function(a,b){this.cbHide(a,!b)},cbHide:function(a,b){var c=a.classList;b?c.add("cb-hide"):c.remove("cb-hide")},cbInclude:function(a,b){this.cbExclude(a,!b)},cbExclude:function(a,b){var c=a.classList;b?c.add("cb-exclude"):c.remove("cb-exclude")},cbEnabled:function(a,b){a.disabled=!b},cbHtml:function(a,b){$(a).html(b)},cbText:function(a,b){b=conbo.encodeEntities(b).replace(/\r?\n|\r/g,"<br/>"),$(a).html(b)},cbClass:function(a,b,c,d){d||conbo.warn('cb-class attributes must specify one or more CSS classes in the format cb-class="myProperty:class-name"');var e=a.classList;b?e.add.apply(e,d.split(" ")):e.remove.apply(e,d.split(" "))},cbClasses:function(a,b){a.className=b},cbStyle:function(a,b,c,d){d||conbo.warn('cb-style attributes must specify one or more styles in the format cb-style="myProperty:style-name"'),$(a).css(d,b)},cbRepeat:function(a,b,c,d){var e,f,g=conbo.toArray(arguments),h=$(a);c||(c={}),c.context&&c.context.namespace&&(f=conbo.BindingUtils.getClass(d,c.context.namespace)),f||(f=conbo.ItemRenderer),a.cbRepeat||(a.cbRepeat={});var i=a.cbRepeat.elements||[];switch(a.classList.remove("cb-exclude"),a.cbRepeat.list!=b&&b instanceof conbo.List&&(a.cbRepeat.list&&a.cbRepeat.list.removeEventListener("change",a.cbRepeat.changeHandler),a.cbRepeat.changeHandler=this.bind(function(a){this.cbRepeat.apply(this,g)}),b.addEventListener("change",a.cbRepeat.changeHandler),a.cbRepeat.list=b),!0){case b instanceof Array:case b instanceof conbo.List:e=b;break;default:e=conbo.isIterable(b)?conbo.toArray(b):[]}for(i.length&&$(i[0]).before(h);i.length;){var j=i.pop();j.cbView?j.cbView.remove():$(j).remove()}for(var k=0,l=e.length;l>k;++k){var m=b[k];!conbo.isObject(m)||m instanceof conbo.Hash||(m=new conbo.Hash({source:m}));var n=h.clone().removeAttr("cb-repeat"),o={data:m,el:n,index:k,isLast:k==e.length-1,list:e},p=new f(conbo.setValues(o,c));p.el.classList.add("cb-repeat"),i.push(p.el)}h.before(i),a.cbRepeat.elements=i,i.length?h.detach():a.classList.add("cb-exclude")},cbDataset:function(a,b){conbo.isObject(b)&&conbo.setValues(a.dataset,b)},cbData:function(a,b){a.cbGlimpse?a.cbGlimpse.data=b:this.cbDataset(a,b)},cbIncludeIn:function(a,b,c){var d=c.view,e=b.split(" "),f=function(){this.cbInclude(a,-1!=e.indexOf(d.currentState))};d.addEventListener("change:currentState",f,this),f.call(this)},cbExcludeFrom:function(a,b,c){var d=c.view,e=b.split(" "),f=function(){this.cbExclude(a,-1!=e.indexOf(d.currentState))};d.addEventListener("change:currentState",f,this),f.call(this)},cbRemove:function(a,b){if(b){var c=$(a);c.remove()}},cbKeep:function(a,b){this.cbRemove(a,!b)},cbOnbind:function(a,b){a.addEventListener("bind",b)},cbJshref:function(a){"A"==a.tagName&&(a.onclick=function(b){return window.location=a.href,b.preventDefault(),!1})},cbDetectChange:function(a,b){var c=$(a),d=c.closest("form"),e=c.val()||c.html(),f=function(){d.removeClass("cb-changed cb-unchanged").addClass(d.find(".cb-changed").length?"cb-changed":"cb-unchanged")},g=function(){var a=(c.val()||c.html())!=e;c.removeClass("cb-changed cb-unchanged").addClass(a?"cb-changed":"cb-unchanged"),f()};c.on("change input",g).addClass("cb-unchanged"),f()},cbValidate:function(a,b){var c;switch(!0){case conbo.isFunction(b):c=b;break;case conbo.isString(b):b=new RegExp(b);case conbo.isRegExp(b):c=function(a){return b.test(a)}}if(!conbo.isFunction(c))return void conbo.warn(b+" cannot be used with cb-validate");var d=$(a),e=d.closest("form"),f=function(a){return function(b,c){return c.split(/\s+/).filter(function(b){return a.test(b)}).join(" ")}},g=function(){var a=d.val()||d.html(),b=c(a),g=b===!0,h=[];h.push(g?"cb-valid":"cb-invalid"),conbo.isString(b)&&h.push("cb-invalid-"+b),d.removeClass("cb-valid cb-invalid").removeClass(f(/^cb-invalid-/)).addClass(h.join(" ")),e.length&&(e.removeClass("cb-valid cb-invalid").removeClass(f(/^cb-invalid-/)),g&&(g=!e.find(".cb-invalid").length,g&&e.find("[required]").each(function(){var a=$(this);return $.trim(a.val()||a.html())?void 0:(g=!1,!1)})),e.addClass(g?"cb-valid":"cb-invalid"))};d.on("change input blur",g)},cbRestrict:function(a,b){a.cbRestrict&&a.removeEventListener("keypress",a.cbRestrict),a.cbRestrict=function(a){if(!a.ctrlKey){var c=a.keyCode||a.which,d=a.key||String.fromCharCode(c),e=b;conbo.isRegExp(e)||(e=new RegExp("["+e+"]","g")),d.match(e)||a.preventDefault()}},a.addEventListener("keypress",a.cbRestrict)},cbMaxChars:function(a,b){var c=$(a);a.cbMaxChars&&a.removeEventListener("keypress",a.cbMaxChars),a.cbMaxChars=function(a){(c.val()||c.html()).length>=b&&a.preventDefault()},a.addEventListener("keypress",a.cbMaxChars)}});var BindingUtils__cbAttrs=new conbo.AttributeBindings,BindingUtils__customAttrs={},BindingUtils__reservedAttrs=["cb-app","cb-view","cb-glimpse","cb-content"],BindingUtils__reservedNamespaces=["cb","data","aria"],BindingUtils__registeredNamespaces=["cb"],BindingUtils__set=function(a,b){return this[a]===b?this:(b&&conbo.isString(b)&&!isNaN(b)&&(b=parseFloat(b),isNaN(b)&&(b="")),this[a]=b,this)},BindingUtils__isReservedAttr=function(a){return-1!=BindingUtils__reservedAttrs.indexOf(a)},BindingUtils__makeBindable=function(a,b){conbo.isAccessor(a,b)||(a instanceof conbo.EventDispatcher?conbo.makeBindable(a,[b]):conbo.warn('It will not be possible to detect changes to "'+b+'" because "'+a.toString()+'" is not an EventDispatcher'))};conbo.BindingUtils=conbo.Class.extend({},{bindElement:function(a,b,c,d){var e=a instanceof conbo.EventDispatcher;if(!c)throw new Error("element is undefined");BindingUtils__makeBindable(a,b);var f,g,h=[];return d||(d=this.defaultParseFunction),$(c).each(function(c,i){var j=$(i),k=j[0].tagName;switch(k){case"INPUT":case"SELECT":case"TEXTAREA":var l=(j.attr("type")||k).toLowerCase();switch(l){case"checkbox":return j.prop("checked",!!a[b]),e&&(f="change:"+b,g=function(a){j.prop("checked",!!a.value)},a.addEventListener(f,g),h.push([a,f,g])),f="input change",g=function(c){BindingUtils__set.call(a,b,j.is(":checked"))},j.on(f,g),void h.push([j,f,g]);case"radio":j.val()==a[b]&&j.prop("checked",!0),e&&(f="change:"+b,g=function(a){null==a.value&&(a.value=""),j.val()==a.value&&j.prop("checked",!0)},a.addEventListener(f,g),h.push([a,f,g]));break;default:var m=function(){j.val(a[b])};"select"==l?conbo.defer(m):m(),e&&(f="change:"+b,g=function(a){null==a.value&&(a.value=""),j.val()!=a.value&&j.val(a.value)},a.addEventListener(f,g),h.push([a,f,g]))}f="input change",g=function(c){BindingUtils__set.call(a,b,j.val()===undefined?j.html():j.val())},j.on(f,g),h.push([j,f,g]);break;default:j.html(d(a[b])),e&&(f="change:"+b,g=function(a){var b=d(a.value);j.html(b)},a.addEventListener(f,g),h.push([a,f,g]))}}),h},unbindElement:function(a,b,c){},bindAttribute:function(a,b,c,d,e,f){var g=[];if(BindingUtils__isReservedAttr(d))return g;if(!c)throw new Error("element is undefined");var h=d.split("-"),i=h.length>1;if(!i)return g;if("cb-bind"==d)return this.bindElement(a,b,c,e);BindingUtils__makeBindable(a,b);var j,k,l=conbo.toArray(arguments).slice(5),m=conbo.toCamelCase(d),n=h[0],o="cb"==n,p=o&&m in BindingUtils__cbAttrs,q=!p&&m in BindingUtils__customAttrs,r=o&&2==h.length&&h[1]in c,s=BindingUtils__cbAttrs;switch(e||(e=this.defaultParseFunction),!0){case q:s=BindingUtils__customAttrs;case p:if(!(a instanceof conbo.EventDispatcher))return conbo.warn("Source is not EventDispatcher"),this;var t=s[m];t.raw?t.apply(s,[c,b].concat(l)):(k=function(d){t.apply(s,[c,e(a[b])].concat(l))},j="change:"+b,a.addEventListener(j,k),k(),g.push([a,j,k]));break;case r:var u=h[1];switch(!0){case 0!==u.indexOf("on")&&conbo.isFunction(c[u]):conbo.warn(d+" is not a recognised attribute, did you mean cb-on"+u+"?");break;case 0===u.indexOf("on"):return conbo.isFunction(a[b])?($(c).on(u.substr(2),a[b]),this):(conbo.warn(b+" is not a function and cannot be bound to DOM events"),this);default:if(!(a instanceof conbo.EventDispatcher))return conbo.warn("Source is not EventDispatcher"),this;k=function(){var d;d=e(a[b]),d=conbo.isBoolean(c[u])?!!d:d,c[u]=d},j="change:"+b,a.addEventListener(j,k),k(),g.push([a,j,k]);var v=$(c);k=function(){BindingUtils__set.call(a,b,c[u])},j="input change",v.on(j,k),g.push([v,j,k])}break;default:conbo.warn(d+" is not recognised or does not exist on specified element")}return g},applyAttribute:function(a,b){if(this.attributeExists(b)){var c=conbo.toCamelCase(b),d=b.split("-")[0],e="cb"==d?BindingUtils__cbAttrs:BindingUtils__customAttrs,f=e[c];return f.readOnly?f.call(e,a):conbo.warn(attr+" attribute cannot be used without a value"),this}return conbo.warn(attr+" attribute does not exist"),this},attributeExists:function(a){var b=conbo.toCamelCase(a);return b in BindingUtils__cbAttrs||b in BindingUtils__customAttrs},bindView:function(view){if(!view)throw new Error("view is undefined");view.__bindings&&this.unbindView(view);var options={view:view},bindings=[],$ignored=view.$("[cb-repeat]"),scope=this;view.subcontext&&view.subcontext.addTo(options);var ns=view.context&&view.context.namespace;return ns&&this.applyViews(view,ns,"glimpse").applyViews(view,ns,"view"),view.$("*").add(view.el).filter(function(){return this==view.el?!0:$ignored.find(this).length?!1:!0}).each(function(index,el){var $el=$(el),attrs=$el.attrs();if(conbo.keys(attrs).length){var keys=conbo.keys(attrs);-1!=keys.indexOf("cbRepeat")&&(keys=["cbRepeat"]),keys.forEach(function(key){var type=conbo.toUnderscoreCase(key,"-"),typeSplit=type.split("-");if(!(typeSplit.length<2||-1==BindingUtils__registeredNamespaces.indexOf(typeSplit[0])||BindingUtils__isReservedAttr(type))){var splits=attrs[key].split(",");BindingUtils__cbAttrs.canHandleMultiple(type)||(splits=[splits[0]]);for(var splitsLength=splits.length,i=0;splitsLength>i;i++){var parseFunction,d=splits[i];if(!d&&!conbo.isString(d)){scope.applyAttribute(el,type);break}var b=d.split("|"),v=b[0].split(":"),propertyName=v[0],param=v[1],split=scope.cleanPropertyName(propertyName).split("."),property=split.pop(),model;try{parseFunction=b[1]?eval("view."+scope.cleanPropertyName(b[1])):undefined,parseFunction=conbo.isFunction(parseFunction)?parseFunction:undefined}catch(e){}try{model=split.length?eval("view."+split.join(".")):view}catch(e){}if(!model)return void conbo.warn(propertyName+" is not defined in this View");var opts=conbo.defineValues({propertyName:property},options),args=[model,property,el,type,parseFunction,opts,param];bindings=bindings.concat(scope.bindAttribute.apply(scope,args))}conbo.defer(function(){var a;a=document.createEvent("CustomEvent"),a.initCustomEvent("bind",!1,!1,{}),el.dispatchEvent(a)})}})}}),__definePrivateProperty(view,"__bindings",bindings),this},unbindView:function(a){if(!a)throw new Error("view is undefined");if(!a.__bindings||!a.__bindings.length)return this;for(var b=a.__bindings;b.length;){var c=b.pop();try{switch(!0){case c[0]instanceof $:c[0].off(c[1],c[2]);break;case c[0]instanceof conbo.EventDispatcher:case!!c[0]&&!!c[0].removeEventListener:c[0].removeEventListener(c[1],c[2])}}catch(d){}}return delete a.__bindings,this},applyViews:function(a,b,c){var d=["view","glimpse"];if(c||(c="view"),-1==d.indexOf(c))throw new Error(c+" is not a valid type parameter for applyView");var e=conbo[c.charAt(0).toUpperCase()+c.slice(1)],f=this,g=a instanceof conbo.View?a.$el:$(a);return g.find("*").not(".cb-view, .cb-glimpse").each(function(d,g){var h=$(g),i=h.cbAttrs()[c]||conbo.toCamelCase(g.tagName,!0),j=f.getClass(i,b);if(j&&conbo.isClass(j,e)&&("glimpse"==c&&conbo.isClass(j,conbo.Glimpse)||"view"==c&&conbo.isClass(j,conbo.View))){var k=h.closest(".cb-view")[0],l=k?k.cbView.subcontext:a.subcontext;new j({el:g,context:l})}}),this},bindProperty:function(a,b,c,d,e){if(!(a instanceof conbo.EventDispatcher))throw new Error(b+" source is not EventDispatcher");return d||(d=b),BindingUtils__makeBindable(a,b),a.addEventListener("change:"+b,function(a){return c instanceof conbo.EventDispatcher?void BindingUtils__set.call(c,d,a.value):void(c[d]=a.value)}),e&&c instanceof conbo.EventDispatcher&&this.bindProperty(c,d,a,b),this},bindSetter:function(a,b,c){if(!(a instanceof conbo.EventDispatcher))throw new Error("Source is not EventDispatcher");if(!conbo.isFunction(c)){if(!(c&&b in c))throw new Error("Invalid setter function");c=c[b]}return BindingUtils__makeBindable(a,b),a.addEventListener("change:"+b,function(a){c(a.value)}),this},defaultParseFunction:function(a){return"undefined"==typeof a?"":a},cleanPropertyName:function(a){return(a||"").replace(/[^\w\._]/g,"")},getClass:function(a,b){if(a&&b)try{var c=b[a];if(conbo.isClass(c))return c}catch(d){}},registerAttribute:function(a,b,c,d){if(!conbo.isString(a)||!conbo.isFunction(b))return conbo.warn("registerAttribute: both 'name' and 'handler' parameters are required"),this;var e=conbo.toUnderscoreCase(a).split("_");if(e.length<2)return conbo.warn("registerAttribute: "+a+" does not include a namespace, e.g. "+conbo.toCamelCase("my-"+a)),this;var f=e[0];return-1!=BindingUtils__reservedNamespaces.indexOf(f)?(conbo.warn("registerAttribute: custom attributes cannot to use the "+f+" namespace"),this):(BindingUtils__registeredNamespaces=conbo.union(BindingUtils__registeredNamespaces,[f]),conbo.setValues(b,{readOnly:!!c,raw:!!d}),BindingUtils__customAttrs[a]=b,this)},registerAttributes:function(a,b){for(var c in a)this.addAttribute(c,a[c],b);return this},toString:function(){return"conbo.BindingUtils"}}),conbo.MutationObserver=conbo.EventDispatcher.extend({initialize:function(){this.bindAll()},observe:function(a){if(this.disconnect(),a){var b=window.MutationObserver||window.WebKitMutationObserver;if(b){var c=new b(this.bind(function(a,b){var c=a[0].addedNodes,d=a[0].removedNodes;c.length&&this.__addHandler(conbo.toArray(c)),a[0].removedNodes.length&&this.__removeHandler(conbo.toArray(d))}));c.observe(a,{childList:!0,subtree:!0}),this.__mo=c}else a.addEventListener("DOMNodeInserted",this.__addHandler),a.addEventListener("DOMNodeRemoved",this.__removeHandler),this.__el=a;return this}},disconnect:function(){var a=this.__mo,b=this.__el;return a&&a.disconnect(),b&&(b.removeEventListener("DOMNodeInserted",__addHandler),b.removeEventListener("DOMNodeRemoved",__removeHandler)),this},__addHandler:function(a){var b=conbo.isArray(a)?a:[a.target];this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD,{nodes:b}))},__removeHandler:function(a){var b=conbo.isArray(a)?a:[a.target];this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE,{nodes:b}))}}),conbo.Promise=conbo.EventDispatcher.extend({initialize:function(a){this.bindAll("dispatchResult","dispatchFault")},dispatchResult:function(a){return this.dispatchEvent(new conbo.ConboEvent("result",{result:a})),this},dispatchFault:function(a){return this.dispatchEvent(new conbo.ConboEvent("fault",{fault:a})),this},then:function(a,b,c){return a&&this.addEveventListener("result",a,c),b&&this.addEveventListener("fault",b,c),this},toString:function(){return"conbo.Promise"}}),conbo.IDataRenderer={data:undefined,index:-1,isLast:!1,list:undefined},conbo.Glimpse=conbo.EventDispatcher.extend({__construct:function(a){this.__setEl(a.el||document.createElement(this.tagName)),this.template&&(this.el.innerHTML=this.template)},get tagName(){return this.__tagName||"div"},set tagName(a){__definePrivateProperty(this,"__tagName",a)},get el(){return this.__el},toString:function(){return"conbo.Glimpse"},__setEl:function(a){var b=conbo.setValues({},this.attributes);this.id&&!a.id&&(b.id=this.id);var c=a,d=c.classList;return c.cbGlimpse=this,d.add("cb-glimpse"),this.className&&d.add.apply(d,this.className.split(" ")),conbo.setValues(c,b),__definePrivateProperty(this,"__el",c),this}}),__denumerate(conbo.Glimpse.prototype);var View__templateCache={};conbo.View=conbo.Glimpse.extend({__construct:function(a){a=conbo.clone(a)||{};var b=conbo.union(["attributes","className","data","id","tagName","template","templateUrl","templateCacheEnabled","autoInitTemplate"],conbo.intersection(conbo.properties(this,!0),conbo.properties(a)));conbo.setValues(this,conbo.pick(a,b)),conbo.makeBindable(this,["currentState"]),this.context=a.context,this.__setEl(a.el||document.createElement(this.tagName))},__postInitialize:function(a){__definePrivateProperty(this,"__initialized",!0),this.__content=this.el.innerHTML,this.autoInitTemplate!==!1&&this.initTemplate()},get $el(){return this.__el?$(this.el):void 0},get el(){return this.__el},get initialized(){return!!this.__initialized},get parent(){return this.initialized?this.__getParent():void 0},get parentApp(){return this.initialized?this.__getParent(!0):void 0},get hasTemplate(){return!(!this.template&&!this.templateUrl)},get $content(){if(this.initialized){var a=this.$("[cb-content]:first");if(a.closest(".cb-view")[0]==this.el)return a}},get content(){return this.$content?this.$content[0]:void 0},get hasContent(){return!!this.content},get $body(){return this.$content||this.$el},get body(){return this.content||this.el},get subcontext(){return this.__subcontext||this.context},set subcontext(a){this.__subcontext=a},$:function(a,b){if(b)return this.$el.find(a);var c=this.$el.find(".cb-app, [cb-app], .cb-view, [cb-view]");return this.$el.find(a).filter(function(){return c.find(this).length||c.filter(this).length?!1:!0})},detach:function(){return this.$el.detach(),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.DETACH)),this},remove:function(){return this.unbindView().removeEventListener(),this.$el.remove(),this.data&&(this.data=undefined),this.context&&(this.context.uninjectSingletons(this).removeEventListener(undefined,undefined,this),this.context=undefined),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),this},appendView:function(a){if(arguments.length>1)return conbo.forEach(arguments,function(a,b,c){this.appendView(a)},this),this;if(!(a instanceof conbo.View))throw new Error("Parameter must be instance of conbo.View class");return this.$body.append(a.el),this},prependView:function(a){if(arguments.length>1)return conbo.forEach(arguments,function(a,b,c){this.prependView(a)},this),this;if(!(a instanceof conbo.View))throw new Error("Parameter must be instance of conbo.View class");return this.$body.prepend(a.el),this},bindView:function(){return conbo.BindingUtils.bindView(this),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.BOUND)),this},unbindView:function(){return conbo.BindingUtils.unbindView(this),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.UNBOUND)),this},initTemplate:function(){var a=this.template;return this.templateUrl?this.loadTemplate():(conbo.isFunction(a)&&(a=a(this)),conbo.isString(a)&&this.$el.html(a),this.__initView()),this},loadTemplate:function(a){a||(a=this.templateUrl);var b=this.el;if(this.unbindView(),this.templateCacheEnabled!==!1&&View__templateCache[a])return b.innerHTML=View__templateCache[a],this.__initView(),this;var c=this.bind(function(c,d,e){"error"==d?(this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.TEMPLATE_ERROR)),b.innerHTML=""):(this.templateCacheEnabled!==!1&&(View__templateCache[a]=c),b.innerHTML=c),this.__initView()});return this.$el.load(a,undefined,c),this},toString:function(){return"conbo.View"},__setEl:function(a){a instanceof $&&(a=a[0]);var b=conbo.setValues({},this.attributes);this.id&&!a.id&&(b.id=this.id);var c=a,d=c.classList;return c.cbView=this,d.add("cb-view"),this.className&&d.add.apply(d,this.className.split(" ")),conbo.setValues(c,b),__definePrivateProperty(this,"__el",c),this},__initView:function(){return this.hasTemplate&&this.hasContent&&(this.content.innerHTML=this.__content),delete this.__content,this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.TEMPLATE_LOADED)).bindView(),conbo.defer(this.bind(function(){this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.INIT)).dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CREATION_COMPLETE))})),this},__getParent:function(a){if(this.el&&this.el.parentElement&&!conbo.instanceOf(this,conbo.Application)){var b=a?".cb-app":".cb-view",c=this.$el.parents(b)[0],d=this.parentApp;return c&&(a||d&&d.$el.has(c).length)?c.cbView:void 0}}}),__denumerate(conbo.View.prototype),conbo.ItemRenderer=conbo.View.extend().implement(conbo.IDataRenderer),conbo.Application=conbo.View.extend({__construct:function(a){if(a=conbo.clone(a)||{},!(this.namespace instanceof conbo.Namespace))throw new Error("Application namespace must be an instance of conbo.Namespace");a.app=this,a.context=new this.contextClass(a),a.el||(a.el=this.__findAppElement()),conbo.View.prototype.__construct.call(this,a)},get contextClass(){return conbo.Context},get observeEnabled(){return!!this.__mo},set observeEnabled(a){if(a!=this.observeEnabled){var b;return a?(b=new conbo.MutationObserver,b.observe(this.el),b.addEventListener(conbo.ConboEvent.ADD,function(){conbo.BindingUtils.applyViews(this,this.namespace),conbo.BindingUtils.applyViews(this,this.namespace,"glimpse")},this),this.__mo=b):this.__mo&&(b=this.__mo,b.removeEventListener(),b.disconnect(),delete this.__mo),this.dispatchChange("observeEnabled"),this}},toString:function(){return"conbo.Application"},__findAppElement:function(){var a=$("[cb-app]");if(!a.length)return undefined;if(!this.namespace)return a.length&&conbo.warn("Application namespace not specified: unable to bind to cb-app element"),undefined;var b;for(var c in this.namespace)if(conbo.isClass(this.namespace[c])&&this instanceof this.namespace[c]){b=c;break}if(!b)return undefined;var d='[cb-app="'+b+'"]',e=$(d)[0];return e||undefined},__updateEl:function(){conbo.View.prototype.__updateEl.call(this),this.$el.addClass("cb-app")}}),__denumerate(conbo.Application.prototype),conbo.Command=conbo.EventDispatcher.extend({__construct:function(a){this.context=a.context,this.event=a.event||{}},initialize:function(){},execute:function(){},toString:function(){return"conbo.Command"}}).implement(conbo.IInjectable),__denumerate(conbo.Command.prototype),conbo.httpRequest=function(a){if(!$)throw new Error("conbo.httpRequest requires jQuery");return new conbo.AsyncToken({promise:$.ajax(a),resultClass:a.resultClass,makeObjectsBindable:a.makeObjectsBindable})},conbo.HttpService=conbo.EventDispatcher.extend({__construct:function(a){a=conbo.setDefaults(a,{contentType:conbo.HttpService.CONTENT_TYPE_JSON}),conbo.setValues(this,conbo.setDefaults(conbo.pick(a,"rootUrl","contentType","dataType","headers","encodeFunction","decodeFunction","resultClass","makeObjectsBindable"),{dataType:"json"})),conbo.EventDispatcher.prototype.__construct.apply(this,arguments)},get rootUrl(){return this._rootUrl||""},set rootUrl(a){a=String(a),a&&"/"!=a.slice(-1)&&(a+="/"),this._rootUrl=a},call:function(a,b,c,d){b=conbo.clone(b||{}),a=this.parseUrl(a,b),b=this.encodeFunction(b,c);var e=conbo.httpRequest({data:b,type:c||"GET",headers:this.headers,url:this.rootUrl+a,contentType:this.contentType||conbo.HttpService.CONTENT_TYPE_JSON,dataType:this.dataType,dataFilter:this.decodeFunction,resultClass:d||this.resultClass,makeObjectsBindable:this.makeObjectsBindable});return e.addResponder(new conbo.Responder(this.dispatchEvent,this.dispatchEvent,this)),e},addCommand:function(a,b,c){return conbo.isObject(a)&&(b=a.method,c=a.resultClass,a=a.command),this[conbo.toCamelCase(a)]=function(d){return this.call(a,d,b,c)},this},addCommands:function(a){return conbo.isArray(a)?(a.forEach(function(a){this.addCommand(a)},this),this):this},encodeFunction:function(a,b){return"GET"!=(b||"GET").toUpperCase()&&this.contentType==conbo.HttpService.CONTENT_TYPE_JSON?JSON.stringify(a):a},parseUrl:function(a,b){var c=a,d=c.match(/:\b\w+\b/g);return d&&d.forEach(function(a){if(a=a.substr(1),!(a in b))throw new Error('Property "'+a+'" required but not found in data')}),conbo.keys(b).forEach(function(a){var d=new RegExp(":\\b"+a+"\\b","g");d.test(c)&&(c=c.replace(d,b[a]),delete b[a])}),c},toString:function(){return"conbo.HttpService"}},{CONTENT_TYPE_JSON:"application/json",CONTENT_TYPE_FORM:"application/x-www-form-urlencoded"}).implement(conbo.IInjectable),conbo.AsyncToken=conbo.Promise.extend({initialize:function(a){a||(a={}),conbo.setValues(this,conbo.pick(a,"makeObjectsBindable","resultClass")),this.responders=[],this.bindAll("dispatchResult","dispatchFault");var b=a.promise;b&&b.done(this.dispatchResult).fail(this.dispatchFault)},addResponder:function(a){return conbo.instanceOf(a,conbo.Responder)?(this.responders.push(a),this):void conbo.warn(a+" is not a Responder")},dispatchResult:function(a,b,c){var d=this.resultClass;if(!d&&this.makeObjectsBindable)switch(!0){case conbo.isArray(a):d=conbo.List;break;case conbo.isObject(a):d=conbo.Hash}d&&(a=new d(a));var e=new conbo.ConboEvent("result",{result:a,status:c.status,xhr:c});return this.responders.forEach(function(a){a.resultHandler&&a.resultHandler.call(a.scope,e)}),this.dispatchEvent(e),this},dispatchFault:function(a,b,c){var d={error:c,fault:a.responseJSON,status:a.status,xhr:a},e=new conbo.ConboEvent("fault",d);return this.responders.forEach(function(a){a.faultHandler&&a.faultHandler.call(a.scope,e)}),this.dispatchEvent(e),this},toString:function(){return"conbo.AsyncToken"}}),__denumerate(conbo.AsyncToken.prototype),conbo.Responder=conbo.Class.extend({initialize:function(a,b,c){this.resultHandler=a,this.faultHandler=b,this.scope=c},toString:function(){return"conbo.Responder"}}),__denumerate(conbo.Responder.prototype),conbo.ISyncable={load:conbo.notImplemented,save:conbo.notImplemented,destroy:conbo.notImplemented},conbo.RemoteHash=conbo.Hash.extend({__construct:function(a){a=conbo.defineDefaults(a,this.options),a.context&&(this.context=a.context),this.preinitialize(a),this._httpService=new conbo.HttpService(a),this._command=a.command;var b=function(a){conbo.makeBindable(this,conbo.properties(a.result)),conbo.setValues(this,a.result),this.dispatchEvent(a)};this._httpService.addEventListener("result",b,this).addEventListener("fault",this.dispatchEvent,this),__denumerate(this),conbo.Hash.prototype.__construct.apply(this,arguments)},load:function(a){return a=arguments.length?a:this.toJSON(),this._httpService.call(this._command,a,"GET"),this},save:function(){return this._httpService.call(this._command,this.toJSON(),"POST"),this},destroy:function(){return this._httpService.call(this._command,this.toJSON(),"DELETE"),this},toString:function(){return"conbo.RemoteHash"}}).implement(conbo.ISyncable,conbo.IPreinitialize),__denumerate(conbo.HttpService.prototype),conbo.RemoteList=conbo.List.extend({__construct:function(a){a=conbo.defineDefaults(a,this.options),this.context=a.context,this._httpService=new conbo.HttpService(a),this._command=a.command;var b=function(a){this.source=a.result,this.dispatchEvent(a)};this._httpService.addEventListener("result",b,this).addEventListener("fault",this.dispatchEvent,this),__denumerate(this),conbo.List.prototype.__construct.apply(this,arguments)},load:function(){return this._httpService.call(this._command,this.toJSON(),"GET"),this},save:function(){return this._httpService.call(this._command,this.toJSON(),"POST"),this},destroy:function(){},toString:function(){return"conbo.RemoteList"}}).implement(conbo.ISyncable,conbo.IPreinitialize),__denumerate(conbo.HttpService.prototype);var routeStripper=/^#!|^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,trailingSlash=/\/$/;conbo.History=conbo.EventDispatcher.extend({started:!1,__construct:function(a){this.handlers=[],this.bindAll("checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history),a.context&&(this.context=a.context)},get isSupported(){return"onhashchange"in window},getHash:function(a){if(a||this.location){var b=(a||this).location.href.match(/#!?(.*)$/);return b?b[1]:""}},getFragment:function(a){return a||(a=this.getHash()),a.replace(routeStripper,"")},start:function(a){if(this.started)throw new Error("conbo.history has already been started");return this.started=!0,this.fragment=this.getFragment(),window.addEventListener("hashchange",this.checkUrl),(a||{}).silent?(this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.STARTED)),this):this.loadUrl()},stop:function(){return window.removeEventListener("hashchange",this.checkUrl),this.started=!1,this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.STOPPED)),this},route:function(a,b){return this.handlers.unshift({route:a,callback:b}),this},checkUrl:function(a){var b=this.getFragment()!==this.fragment;return b&&(this.loadUrl()||this.loadUrl(this.getHash())),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.NAVIGATE)),!b},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=conbo.some(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){return this.started?(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a),this.fragment!==a?(this.fragment=a,this.__updateHash(this.location,a,b.replace),b.trigger&&this.loadUrl(a),this):void 0):!1},toString:function(){return"conbo.History"},__updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#!/"+b)}else a.hash="#!/"+b}}).implement(conbo.IInjectable),__denumerate(conbo.History.prototype),document&&(conbo.history=new conbo.History);var optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;return conbo.Router=conbo.EventDispatcher.extend({__construct:function(a){a.routes&&(this.routes=a.routes),this.__bindRoutes(),this.context=a.context},get history(){return conbo.history},start:function(a){return this.history.start(a),this.history.addEventListener(conbo.ConboEvent.NAVIGATE,this.dispatchEvent,this),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.STARTED)),this},stop:function(){return this.history.stop(),this.history.removeEventListener(conbo.ConboEvent.NAVIGATE,this.dispatchEvent,this),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.STOPPED)),this},route:function(a,b,c){return conbo.isRegExp(a)||(a=this.__routeToRegExp(a)),c||(c=this[b]),conbo.isFunction(b)&&(c=b,b=""),c||(c=this[b]),this.history.route(a,this.bind(function(d){var e=this.__extractParameters(a,d);c&&c.apply(this,e);var f={router:this,route:a,name:b,parameters:e,
fragment:d};this.dispatchEvent(new conbo.ConboEvent("route:"+b,f)),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ROUTE,f)),this.history.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ROUTE,f))})),this},navigate:function(a,b){return this.history.navigate(a,b),this},navigateTo:function(a,b){return b||(b={}),b.trigger=!0,this.navigate(a,b)},get path(){return this.history.getHash()},set path(a){this.navigateTo(a)},toString:function(){return"conbo.Router"},__bindRoutes:function(){if(this.routes)for(var a,b=conbo.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])},__routeToRegExp:function(a){return a=a.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(a,b){return b?a:"([^/]+)"}).replace(splatParam,"(.*?)"),new RegExp("^"+a+"$")},__extractParameters:function(a,b){var c=a.exec(b).slice(1);return conbo.map(c,function(a){if(a)try{return decodeURIComponent(a)}catch(b){return unescape(a)}return null})}}).implement(conbo.IInjectable),__denumerate(conbo.Router.prototype),conbo});