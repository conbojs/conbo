!function(a,b,c,d){"function"==typeof define&&define.amd?define("conbo",function(){return c(a,b)}):"undefined"!=typeof module&&module.exports?module.exports=c(a,b):a.conbo=c(a,b)}(this,this.document,function(window,document,undefined){"use strict";var __namespaces={},conbo=function(a){if(!a||!conbo.isString(a))return void conbo.warn("First parameter must be the namespace string, received",a);__namespaces[a]||(__namespaces[a]=new conbo.Namespace);var b=__namespaces[a],c=conbo.rest(arguments),d=c.pop();if(conbo.isFunction(d)){var e=d.apply(b,c);conbo.isObject(e)&&!conbo.isArray(e)&&b.import(e)}return b};conbo.conbo=conbo,conbo.VERSION="4.1.4",conbo.toString=function(){return"ConboJS v"+this.VERSION},conbo.CONTENT_TYPE_JSON="application/json",conbo.CONTENT_TYPE_FORM="application/x-www-form-urlencoded",conbo.DATA_TYPE_JSON="json",conbo.DATA_TYPE_SCRIPT="script",conbo.DATA_TYPE_TEXT="text";var __dispatchChange=function(a,b){if(!(a instanceof conbo.EventDispatcher))return this;var c={property:b,value:a[b]};return a.dispatchEvent(new conbo.ConboEvent("change:"+b,c)),a.dispatchEvent(new conbo.ConboEvent("change",c)),this},__defineProperty=function(a,b,c,d,e,f){if(conbo.isAccessor(a,b))return this;conbo.isUndefined(c)&&(c=a[b]);var g=!d&&!e;return arguments.length<6&&(f=0!==b.indexOf("_")),g?(d=function(){return c},e=function(a){conbo.isEqual(a,c)||(c=a,__dispatchChange(this,b))},e.bindable=!0):e&&(e=conbo.wrap(e,function(a,c){a.call(this,c),__dispatchChange(this,b)}),e.bindable=!0),Object.defineProperty(a,b,{enumerable:f,configurable:!0,get:d,set:e}),this},__definePrivateProperty=function(a,b,c){return 2==arguments.length&&(c=a[b]),Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!0,value:c}),this},__definePrivateProperties=function(a,b){for(var c in b)__definePrivateProperty(a,c,b[c]);return this},__denumerate=function(a){var b=arguments[1],c=b instanceof RegExp?conbo.filter(conbo.keys(a),function(a){return b.test(a)}):arguments.length>1?conbo.rest(arguments):conbo.keys(a);return c.forEach(function(b){var c=Object.getOwnPropertyDescriptor(a,b)||{value:a[b],configurable:!0,writable:!0};c.enumerable=!1,Object.defineProperty(a,b,c)}),this},__deprecated=function(a){conbo.warn("Deprecation warning: "+a)},__ep=function(a){return new conbo.ElementProxy(a)};!function(){var breaker=!1,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIsArray=Array.isArray,nativeKeys=Object.keys;conbo.forEach=function(a,b,c){if(a!=undefined){var d,e;if(conbo.isIterable(a)){for(d=0,e=a.length;e>d;++d)if(b.call(c,a[d],d,a)===breaker)return}else{var f=conbo.keys(a);for(d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===breaker)return}return a}};var forEach=conbo.forEach;conbo.map=function(a,b,c){var d=[];return a==undefined?d:nativeMap&&a.map===nativeMap?a.map(b,c):(forEach(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)},conbo.indexOf=function(a,b){return nativeIndexOf.call(a,b)},conbo.lastIndexOf=function(a,b){return nativeLastIndexOf.call(a,b)},conbo.find=function(a,b,c){var d;return conbo.some(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},conbo.findIndex=function(a,b,c){var d=conbo.find(a,b,c);return a.indexOf(d)},conbo.filter=function(a,b,c){var d=[];return a==undefined?d:nativeFilter&&a.filter===nativeFilter?a.filter(b,c):(forEach(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},conbo.reject=function(a,b,c){return conbo.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},conbo.every=function(a,b,c){b||(b=conbo.identity);var d=!0;return a==undefined?d:nativeEvery&&a.every===nativeEvery?a.every(b,c):(forEach(a,function(a,e,f){return(d=d&&b.call(c,a,e,f))?void 0:breaker}),!!d)},conbo.some=function(a,b,c){b||(b=conbo.identity);var d=!1;return a==undefined?d:nativeSome&&a.some===nativeSome?a.some(b,c):(forEach(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?breaker:void 0}),!!d)};var some=conbo.some;conbo.contains=function(a,b){return a==undefined?!1:-1!=a.indexOf(b)},conbo.invoke=function(a,b){var c=slice.call(arguments,2),d=conbo.isFunction(b);return conbo.map(a,function(a){return(d?b:a[b]).apply(a,c)})},conbo.pluck=function(a,b){return conbo.map(a,conbo.property(b))},conbo.max=function(a,b,c){if(!b&&conbo.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-(1/0),e=-(1/0);return forEach(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},conbo.min=function(a,b,c){if(!b&&conbo.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return forEach(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},conbo.shuffle=function(a){var b,c=0,d=[];return forEach(a,function(a){b=conbo.random(c++),d[c-1]=d[b],d[b]=a}),d};var lookupIterator=function(a){return a==undefined?conbo.identity:conbo.isFunction(a)?a:conbo.property(a)};conbo.toArray=function(a){return a?conbo.isArray(a)?slice.call(a):conbo.isIterable(a)?conbo.map(a,conbo.identity):conbo.values(a):[]},conbo.size=function(a){return a?conbo.isIterable(a)?a.length:conbo.keys(a).length:0},conbo.last=function(a,b,c){return a==undefined?undefined:b==undefined||c?a[a.length-1]:slice.call(a,Math.max(a.length-b,0))},conbo.rest=function(a,b,c){return slice.call(a,b==undefined||c?1:b)},conbo.compact=function(a){return conbo.filter(a,conbo.identity)};var flatten=function(a,b,c){return b&&conbo.every(a,conbo.isArray)?concat.apply(c,a):(forEach(a,function(a){conbo.isArray(a)||conbo.isArguments(a)?b?push.apply(c,a):flatten(a,b,c):c.push(a)}),c)};conbo.flatten=function(a,b){return flatten(a,b,[])},conbo.without=function(a){return conbo.difference(a,slice.call(arguments,1))},conbo.partition=function(a,b){var c=[],d=[];return forEach(a,function(a){(b(a)?c:d).push(a)}),[c,d]},conbo.uniq=function(a,b,c,d){conbo.isFunction(b)&&(d=c,c=b,b=!1);var e=c?conbo.map(a,c,d):a,f=[],g=[];return forEach(e,function(c,d){(b?d&&g[g.length-1]===c:conbo.contains(g,c))||(g.push(c),f.push(a[d]))}),f},conbo.union=function(){return conbo.uniq(conbo.flatten(arguments,!0))},conbo.intersection=function(a){var b=slice.call(arguments,1);return conbo.filter(conbo.uniq(a),function(a){return conbo.every(b,function(b){return conbo.contains(b,a)})})},conbo.difference=function(a){var b=concat.apply(ArrayProto,slice.call(arguments,1));return conbo.filter(a,function(a){return!conbo.contains(b,a)})},conbo.object=function(a,b){if(a==undefined)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},conbo.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var ctor=function(){};conbo.bindAll=function(a){var b;return b=arguments.length>1?conbo.rest(arguments):conbo.filter(conbo.getFunctionNames(a,!0),function(b){return!conbo.isNative(a[b])}),b.forEach(function(b){a[b]=a[b].bind(a)}),a},conbo.partial=function(a){var b=slice.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===conbo&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}};var ready__domContentLoaded=!document||-1!=["complete","loaded"].indexOf(document.readyState);conbo.ready=function(a,b){var c=conbo.toArray(arguments),d=function(){document&&document.removeEventListener("DOMContentLoaded",d),ready__domContentLoaded=!0,conbo.defer.apply(conbo,c)};return ready__domContentLoaded?d():document.addEventListener("DOMContentLoaded",d),conbo},conbo.defer=function(a,b){return b&&(a=a.bind(b)),setTimeout.apply(undefined,[a,0].concat(conbo.rest(arguments,2)))};var callLater__tasks=[],callLater__run=function(){for(var a;a=callLater__tasks.shift();)a()};conbo.callLater=function(a,b){0===callLater__run.length&&window.requestAnimationFrame(callLater__run);var c=function(){a.apply(b,conbo.rest(arguments,2))};return callLater__tasks.push(c),conbo},conbo.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=undefined,b)}},conbo.wrap=function(a,b){return conbo.partial(b,a)},conbo.keys=function(a,b){if(!a)return[];if(b){var c=[];for(var d in a)c.push(d);return c}return nativeKeys(a)},conbo.functions=function(a,b,c){return conbo.filter(conbo.keys(a,b),function(b){return c?conbo.isFunction(a[b]):conbo.isFunc(a,b)})},conbo.variables=function(a,b){return conbo.difference(conbo.keys(a,b),conbo.functions(a,b))},conbo.properties=function(a,b){return __deprecated("conbo.properties is deprecated, use conbo.variables"),conbo.variables(a,b)},conbo.getPropertyNames=function(a,b){if(!a)return[];if(b){var c=[];do c=c.concat(Object.getOwnPropertyNames(a));while(a=Object.getPrototypeOf(a));return conbo.uniq(c)}return Object.getOwnPropertyNames(a)},conbo.getFunctionNames=function(a,b,c){return conbo.filter(conbo.getPropertyNames(a,b),function(b){return c?conbo.isFunction(a[b]):conbo.isFunc(a,b)})},conbo.getVariableNames=function(a,b){return conbo.difference(conbo.getPropertyNames(a,b),conbo.getFunctionNames(a,b))},conbo.getPropertyDescriptor=function(a,b){if(a)do{var c=Object.getOwnPropertyDescriptor(a,b);if(c)return c}while(a=Object.getPrototypeOf(a))},conbo.values=function(a,b){for(var c=conbo.keys(a,b),d=c.length,e=new Array(d),f=0;d>f;f++)e[f]=a[c[f]];return e},conbo.defineValues=function(a,b){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)conbo.cloneProperty(b,c,a)}),a},conbo.defineBindableValues=function(a,b){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)delete a[c],__defineProperty(a,c,b[c])}),a},conbo.pick=function(a){var b={},c=concat.apply(ArrayProto,slice.call(arguments,1));return forEach(c,function(c){c in a&&conbo.cloneProperty(a,c,b)}),b},conbo.omit=function(a){var b={},c=concat.apply(ArrayProto,slice.call(arguments,1));for(var d in a)conbo.contains(c,d)||conbo.cloneProperty(a,d,b);return b},conbo.defineDefaults=function(a){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]===undefined&&conbo.cloneProperty(b,c,a)}),a},conbo.setDefaults=function(a){return forEach(slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]===undefined&&(a[c]=b[c])}),a},conbo.clone=function(a){return conbo.isObject(a)?conbo.isArray(a)?a.slice():conbo.defineValues({},a):a};var eq=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;var e=toString.call(a);if(e!=toString.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0===a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(conbo.isFunction(g)&&g instanceof g&&conbo.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,j=!0;if("[object Array]"==e){if(i=a.length,j=i==b.length)for(;i--&&(j=eq(a[i],b[i],c,d)););}else{for(var k in a)if(conbo.has(a,k)&&(i++,!(j=conbo.has(b,k)&&eq(a[k],b[k],c,d))))break;if(j){for(k in b)if(conbo.has(b,k)&&!i--)break;j=!i}}return c.pop(),d.pop(),j};conbo.isEqual=function(a,b){return eq(a,b,[],[])},conbo.isEmpty=function(a){return!a||conbo.isArray(a)&&0===a.length||!isNaN(a)&&!parseFloat(a)||conbo.isObject(a)&&!conbo.keys(a).length||conbo.isObject(a)&&"length"in a&&0===a.length},conbo.isIterable=function(a){return a&&a.length===+a.length},conbo.isElement=function(a){return!(!a||1!==a.nodeType)},conbo.isArray=nativeIsArray||function(a){return"[object Array]"==toString.call(a)},conbo.isObject=function(a){return a===Object(a)},forEach(["Arguments","Function","String","Number","Date","RegExp"],function(a){conbo["is"+a]=function(b){return toString.call(b)=="[object "+a+"]"}}),conbo.isArguments(arguments)||(conbo.isArguments=function(a){return!(!a||!conbo.has(a,"callee"))}),"function"!=typeof/./&&(conbo.isFunction=function(a){return"function"==typeof a}),conbo.isFunc=function(a,b){var c=conbo.getPropertyDescriptor(a,b);return c&&"function"==typeof c.value},conbo.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},conbo.isNaN=function(a){return conbo.isNumber(a)&&a!=+a},conbo.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==toString.call(a)},conbo.isNull=function(a){return null===a},conbo.isUndefined=function(a){return a===undefined},conbo.has=function(a,b){return hasOwnProperty.call(a,b)},conbo.identity=function(a){return a},conbo.property=function(a){return function(b){return b[a]}},conbo.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},conbo.random=function(a,b){return b==undefined&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var idCounter=0;conbo.uniqueId=function(a){var b=++idCounter+"";return a?a+b:b},conbo.guid=function(){return window.crypto?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)}):"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)})},conbo.isSupported=window.addEventListener&&!!Object.defineProperty&&!!Object.getOwnPropertyDescriptor,conbo.isNode="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0),conbo.noop=function(){},conbo.notImplemented=function(){conbo.warn("Method not implemented")},conbo.toCamelCase=function(a,b){var c=(a||"").toLowerCase().replace(/([\W_])([a-z])/g,function(a){return a[1].toUpperCase()}).replace(/(\W+)/,"");return b?c.charAt(0).toUpperCase()+c.slice(1):c},conbo.toUnderscoreCase=function(a,b){return b||(b="_"),(a||"").replace(/\W+/g,b).replace(/([a-z\d])([A-Z])/g,"$1"+b+"$2").toLowerCase()},conbo.toKebabCase=function(a){return conbo.toUnderscoreCase(a,"-")},conbo.padLeft=function(a,b,c){for(c||0===c||(c=" "),a||0===a||(a=""),b||(b=2),c=c.toString().charAt(0),string=a.toString();string.length<b;)string=c+string;return string},conbo.addLeadingZero=function(a,b){return conbo.padLeft(a,b,0)},conbo.formatNumber=function(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g=conbo.isUndefined(d)?",":d,h=conbo.isUndefined(c)?".":c,i=e.toFixed(f).split(".");return i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)},conbo.formatCurrency=function(a,b,c,d,e,f){conbo.isUndefined(d)&&(d=2),b||(b="");var g=conbo.formatNumber(a,d,e,f);return c?g+b:b+g},conbo.encodeEntities=function(a){return conbo.isString(a)||(a=conbo.isNumber(a)?a.toString():""),a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"&#"+a.charCodeAt(0)+";"})},conbo.decodeEntities=function(a){return conbo.isString(a)||(a=""),a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)})},conbo.setValues=function(a){return conbo.rest(arguments).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a},conbo.isClass=function(a,b){return!!a&&"function"==typeof a&&a.prototype instanceof(b||conbo.Class)},conbo.cloneProperty=function(a,b,c,d){d||(d=b);var e=Object.getOwnPropertyDescriptor(a,b);return e?Object.defineProperty(c,d,e):c[d]=a[b],this},conbo.sortOn=function(a,b,c){return c||(c={}),conbo.isArray(a)&&b&&a.sort(function(a,d){var e=[a[b],d[b]];return c.descending&&e.reverse(),c.caseInsensitive&&conbo.forEach(e,function(a,b){conbo.isString(a)&&(e[b]=a.toLowerCase())}),e[0]<e[1]?-1:e[0]>e[1]?1:0}),a},conbo.instanceOf=function(a,b){if(!a||conbo.isClass(a)||!b)return!1;try{if(a instanceof b||a.constructor===b)return!0}catch(c){}return!1},conbo.is=function(a,b,c){if(!a||conbo.isClass(a)||!b)return!1;if(conbo.instanceOf(a,b))return!0;if(c=c!==!1,!conbo.isObject(b)||!conbo.keys(b).length)return!1;for(var d in b)if(!(d in a)||c&&!conbo.isUndefined(b[d])&&!conbo.is(a[d],b[d],c))return!1;return!0},conbo.loadCss=function(a,b){if(!("document"in window)||document.querySelector('[href="'+a+'"]'))return undefined;var c,d;return d=new conbo.Promise,c=document.createElement("link"),c.rel="stylesheet",c.type="text/css",c.media=b||"all",c.addEventListener("load",function(a){d.dispatchResult()}),c.addEventListener("error",function(a){d.dispatchFault()}),c.href=a,document.querySelector("head").appendChild(c),d},conbo.loadScript=function(a,b){return conbo.httpRequest({url:a,dataType:"script",scope:b})},conbo.makeBindable=function(a,b){return b=conbo.uniq(b||conbo.getVariableNames(a,!0)),b.forEach(function(b){__defineProperty(a,b)}),this},conbo.makeAllBindable=function(a,b){return b=(b||[]).concat(conbo.getVariableNames(a,!0)),conbo.makeBindable(a,b),this},conbo.isAccessor=function(a,b){return a?!!a.__lookupGetter__(b)||!!a.__lookupSetter__(b):!1},conbo.isBindable=function(a,b){return conbo.isAccessor(a,b)?!!(a.__lookupSetter__(b)||{}).bindable:!1},conbo.isNative=function(a){var b=Object.prototype.toString,c=Function.prototype.toString,d=/^\[object .+?Constructor\]$/,e=RegExp("^"+String(b).replace(/[.*+?^${}()|[\]\/\\]/g,"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),f=typeof a;return"function"==f?e.test(c.call(a)):a&&"object"==f&&d.test(b.call(a))||!1},conbo.parseTemplate=function(template,data){return template?(data||(data={}),template.replace(/(({{(.+?)}})|(\${(.+?)}))/g,function(propNameInBrackets,propName){var args=propName.split("|"),value,parseFunction;args[0]=conbo.bindingUtils.cleanPropertyName(args[0]);try{value=eval("data."+args[0])}catch(e){}try{parseFunction=eval("data."+args[1])}catch(e){}return conbo.isFunction(parseFunction)||(parseFunction=conbo.bindingUtils.defaultParseFunction),parseFunction(value)})):""},conbo.compileTemplate=function(a,b){return function(c){return conbo.parseTemplate(a,conbo.setDefaults(c||{},b))}},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),conbo.toQueryString=function(a){return conbo.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")},conbo.getValue=function(a,b,c){if(c!==!1)return a[b];for(var d in a)if(d.toLowerCase()==b.toLowerCase())return a[d]},conbo.jsonify=function(a,b){if(this!=conbo&&(b=a,a=this),conbo.isObject(a)){if(this!=a&&"toJSON"in a)return a.toJSON();if(conbo.isIterable(a))return conbo.map(a,function(a){return conbo.jsonify(a,b)});var c=conbo.filter(conbo.variables(a,b),function(a){return/^[a-z]*$/i.test(a)});return conbo.pick.apply(conbo,[a].concat(c))}return a},conbo.logEnabled=!0;var logMethods=["log","warn","info","error"];logMethods.forEach(function(a){conbo[a]=function(){console&&conbo.logEnabled&&console[a].apply(console,arguments)}})}(),function(){conbo.initDom=function(a,b){if(!a)throw new Error("initDom: namespace is undefined");conbo.isString(a)&&(a=conbo(a)),b||(b=document.querySelector("html"));var c=function(){var c=conbo.toArray(b.querySelectorAll(":not(.cb-app)"));c.forEach(function(b){var c=__ep(b).attributes.cbApp||conbo.toCamelCase(b.tagName,!0),d=a[c];d&&conbo.isClass(d,conbo.Application)&&new d({el:b})})};return conbo.ready(c),this};var a=[],b=function(b,c){for(var d=a.length,e=0;d>e;e++){var f=a[e];if(f[0]==b&&f[1]==c)return e}return-1};conbo.observeDom=function(c,d){if(conbo.isString(c)&&(c=conbo(c)),-1==b(c,d)){d||(d=document.querySelector("html"));var e=new conbo.MutationObserver;return e.observe(d),e.addEventListener(conbo.ConboEvent.ADD,function(a){a.nodes.forEach(function(a){var b=__ep(a),d=b.cbAttributes.app||conbo.toCamelCase(a.tagName,!0);d&&c[d]&&!b.hasClass("cb-app")&&new c[d]({el:a})})}),a.push([c,d,e]),this}},conbo.unobserveDom=function(c,d){conbo.isString(c)&&(c=conbo(c));var e=b(c,d);if(-1!=e){var f=a[e];f[2].removeEventListener(),a.slice(e,1)}return this}}(),document&&!document.querySelector("#cb-style")&&(document.querySelector("head").innerHTML+='<style id="cb-style" type="text/css">\n.cb-hide { visibility:hidden !important; }\n.cb-exclude { display:none !important; }\n.cb-disable { pointer-events:none !important; cursor:default !important; }\nspan { font:inherit; color:inherit; }\n</style>'),conbo.conbons=function(a){return function(b){var c={};return c[b.name]=b,conbo(a).import(c),b}},conbo.Class=function(){this.declarations.apply(this,arguments),this.preinitialize.apply(this,arguments),this.initialize.apply(this,arguments)},conbo.Class.prototype={declarations:function(){},preinitialize:function(){},initialize:function(){},get supro(){return Object.getPrototypeOf(Object.getPrototypeOf(this))},bindAll:function(){return conbo.bindAll.apply(conbo,[this].concat(conbo.toArray(arguments))),this},toString:function(){return"conbo.Class"}},__denumerate(conbo.Class.prototype),conbo.Class.extend=function(a,b){var c=this,d=a&&conbo.has(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)};conbo.defineValues(d,c,b);var e=function(){this.constructor=d};return e.prototype=c.prototype,d.prototype=new e,a&&conbo.defineValues(d.prototype,a),d},conbo.Class.implement=function(){var a=conbo.defineDefaults.apply(conbo,conbo.union([{}],arguments)),b=conbo.keys(a),c=this.prototype;conbo.defineDefaults(this.prototype,a);var d=conbo.reject(b,function(a){return c[a]!==conbo.notImplemented});if(d.length)throw new Error(c.toString()+" does not implement the following method(s): "+d.join(", "));return this},conbo.ConboClass=conbo.Class.extend({constructor:function(a){var b=conbo.toArray(arguments);b[0]===undefined?b[0]={}:b[0]instanceof conbo.Context&&conbo.is(this,conboIInjectable,!1)&&(b[0]=b[0].addTo()),this.declarations.apply(this,b),this.preinitialize.apply(this,b),this.__construct.apply(this,b),this.initialize.apply(this,b),conbo.makeAllBindable(this,this.bindable),this.__postInitialize.apply(this,b)},toString:function(){return"conbo.ConboClass"},__construct:function(){},__postInitialize:function(){}}),__denumerate(conbo.ConboClass.prototype),conbo.Namespace=conbo.ConboClass.extend({__construct:function(){var a=function(){document&&this.autoInit!==!1&&this.initDom()};conbo.ready(a,this)},initDom:function(a){return conbo.initDom(this,a),this},observeDom:function(a){return conbo.observeDom(this,a),this},unobserveDom:function(a){return conbo.unobserveDom(this,a),this},"import":function(a){return conbo.setDefaults.apply(conbo,[this].concat(conbo.toArray(arguments))),this}}),conbo.IInjectable={get context(){return this.__context},set context(a){a!=this.__context&&(a instanceof conbo.Context&&a.injectSingletons(this),this.__context=a,__denumerate(this,"__context"))}},conbo.Event=conbo.Class.extend({constructor:function(a){if(this.preinitialize.apply(this,arguments),conbo.isString(a)?this.type=a:conbo.defineDefaults(this,a),!this.type)throw new Error("Invalid or undefined event type");this.initialize.apply(this,arguments)},initialize:function(a,b){this.data=b},clone:function(){return conbo.clone(this)},preventDefault:function(){return this.defaultPrevented=!0,this},stopPropagation:function(){return this.cancelBubble=!0,this},stopImmediatePropagation:function(){return this.immediatePropagationStopped=!0,this.stopPropagation(),this},toString:function(){return"conbo.Event"}},{ALL:"*"}),__denumerate(conbo.Event.prototype),conbo.ConboEvent=conbo.Event.extend({initialize:function(a,b){conbo.defineDefaults(this,b)},toString:function(){return"conbo.ConboEvent"}},{ALL:"*",CHANGE:"change",ADD:"add",REMOVE:"remove",ROUTE:"route",START:"start",STOP:"stop",TEMPLATE_COMPLETE:"templateComplete",TEMPLATE_ERROR:"templateError",BIND:"bind",UNBIND:"unbind",CREATION_COMPLETE:"creationComplete",DETACH:"detach",RESULT:"result",FAULT:"fault"}),function(){var a=function(a,b,c,d,e){"*"==a&&(a="all"),this.__queue||__definePrivateProperty(this,"__queue",{}),this.hasEventListener(a,b,c)||(a in this.__queue||(this.__queue[a]=[]),this.__queue[a].push({handler:b,scope:c,once:e,priority:d||0}),this.__queue[a].sort(function(a,b){return b.priority-a.priority}))},b=function(a,b,c){if("*"==a&&(a="all"),this.__queue){var d,e,f=this,g=function(a,d){for(e=0;e<a.length;e++)a[e].handler&&a[e].handler!=b||a[e].scope&&a[e].scope!=c||a.splice(e--,1);a.length||delete f.__queue[d]};a in this.__queue?(d=this.__queue[a],g(d,a)):a==undefined&&conbo.forEach(this.__queue,function(a,b){g(a,b)})}};conbo.EventDispatcher=conbo.ConboClass.extend({__construct:function(a){a.context&&(this.context=a.context)},addEventListener:function(b,c,d,e,f){if(!b)throw new Error("Event type undefined");if(!c||!conbo.isFunction(c))throw new Error("Event handler is undefined or not a function");return conbo.isString(b)&&(b=b.split(" ")),conbo.isArray(b)&&conbo.forEach(b,function(b,g,h){a.call(this,b,c,d,e,!!f)},this),this},removeEventListener:function(a,c,d){return arguments.length?(conbo.isString(a)&&(a=a.split(" ")),conbo.isArray(a)||(a=[undefined]),conbo.forEach(a,function(a,e,f){b.call(this,a,c,d)},this),this):(__definePrivateProperty(this,"__queue",{}),this)},hasEventListener:function(a,b,c){if(!(this.__queue&&a in this.__queue&&this.__queue[a].length))return!1;for(var d=this.__queue[a],e=d.length,f=0;e>f;f++)if(!(b&&d[f].handler!=b||c&&d[f].scope!=c))return!0;return!1},dispatchEvent:function(a){if(!a)throw new Error("Event undefined");var c=conbo.isString(a);if(c&&conbo.warn('Use of dispatchEvent("'+a+'") is deprecated, please use dispatchEvent(new conbo.Event("'+a+'"))'),!c&&a instanceof conbo.Event||(a=new conbo.Event(a)),!this.__queue||!(a.type in this.__queue)&&!this.__queue.all)return this;a.target||(a.target=this),a.currentTarget=this;var d=conbo.union(this.__queue[a.type]||[],this.__queue.all||[]);if(!d||!d.length)return this;for(var e=0,f=d.length;f>e;++e){var g=d[e],h=g.handler.call(g.scope||this,a);if(g.once&&b.call(this,a.type,g.handler,g.scope),h===!1||a.immediatePropagationStopped)break}return this},dispatchChange:function(a){return conbo.forEach(arguments,function(a){__dispatchChange(this,a)},this),this},toString:function(){return"conbo.EventDispatcher"}}).implement(conbo.IInjectable),__denumerate(conbo.EventDispatcher.prototype)}(),conbo.EventProxy=conbo.Class.extend({constructor:function(a){this.__obj=a},addEventListener:function(a,b){var c=this.__obj;if(c)switch(!0){case conbo.$&&c instanceof conbo.$:case window.$&&c instanceof window.$:c.on(a,b);break;case c instanceof conbo.EventDispatcher:c.addEventListener(a,b);break;default:var d=a.split(" ");d.forEach(function(a){c.addEventListener(a,b)})}return this},removeEventListener:function(a,b){var c=this.__obj;if(c)switch(!0){case conbo.$&&c instanceof conbo.$:case window.$&&c instanceof window.$:c.off(a,b);break;case c instanceof conbo.obj:c.removeEventListener(a,b);break;default:var d=a.split(" ");d.forEach(function(a){c.removeEventListener(a,b)})}return this}}),conbo.ServerApplication=conbo.EventDispatcher.extend({contextClass:conbo.Context,__construct:function(a){a=conbo.clone(a||{}),a.app=this,this.context=new this.contextClass(a)},toString:function(){return"conbo.ServerApplication"}}).implement(conbo.IInjectable),__denumerate(conbo.ServerApplication.prototype),conbo.Context=conbo.EventDispatcher.extend({__construct:function(a){__definePrivateProperties(this,{__commands:{},__singletons:{},__app:a.app,__namespace:a.namespace||a.app.namespace,__parentContext:a instanceof conbo.Context?a:undefined}),this.addEventListener(conbo.Event.ALL,this.__allHandler)},get app(){return this.__app},get namespace(){return this.__namespace},get parentContext(){return this.__parentContext},createSubcontext:function(a){return a||(a=conbo.Context),new a(this)},mapCommand:function(a,b){if(!a)throw new Error("eventType cannot be undefined");if(!b)throw new Error("commandClass for "+a+" cannot be undefined");if(!this.__mapMulti(a,b,this.mapCommand))return this.__commands[a]&&-1!=this.__commands[a].indexOf(b)?this:(this.__commands[a]=this.__commands[a]||[],this.__commands[a].push(b),this)},unmapCommand:function(a,b){if(!a)throw new Error("eventType cannot be undefined");if(!this.__mapMulti(a,b,this.unmapCommand)){if(b===undefined)return delete this.__commands[a],this;if(this.__commands[a]){var c=this.__commands[a].indexOf(b);if(-1!=c)return this.__commands[a].splice(c,1),this}}},mapSingleton:function(a,b){if(!a)throw new Error("propertyName cannot be undefined");return b===undefined&&conbo.warn("singletonClass for "+a+" is undefined"),this.__mapMulti(a,b,this.mapSingleton)?void 0:(this.__singletons[a]=conbo.isClass(b)?new b(arguments[2],arguments[3],arguments[4]):b,this)},unmapSingleton:function(a){if(!a)throw new Error("propertyName cannot be undefined");if(!this.__mapMulti(a,null,this.unmapSingleton)&&this.__singletons[a])return delete this.__singletons[a],this},mapConstant:function(a,b){return this.mapSingleton(a,b)},unmapConstant:function(a){return this.unmapSingleton(a)},addTo:function(a){return conbo.defineValues(a||{},{context:this})},injectSingletons:function(a){for(var b in a)a[b]===undefined&&b in this.__singletons&&(a[b]=this.__singletons[b]);return this},uninjectSingletons:function(a){for(var b in a)b in this.__singletons&&(a[b]=undefined);return this},toString:function(){return"conbo.Context"},__allHandler:function(a){var b=conbo.union(this.__commands.all||[],this.__commands[a.type]||[]);b.length&&conbo.forEach(b,function(b,c,d){this.__executeCommand(b,a)},this)},__executeCommand:function(a,b){var c,d;return d={event:b},c=new a(this.addTo(d)),c.execute(),c=null,this},__mapMulti:function(a,b,c){if(conbo.isArray(a)||-1==a.indexOf(" "))return!1;var d=conbo.isArray(a)?a:a.split(" ");return conbo.forEach(d,function(a){c(a,b)},this),!0}}),__denumerate(conbo.Context.prototype),conbo.Hash=conbo.EventDispatcher.extend({__construct:function(a){a.context&&(this.context=a.context),conbo.setValues(this,conbo.setDefaults({},a.source,this.toJSON(),this._defaults)),delete this._defaults},toJSON:conbo.jsonify,toString:function(){return"conbo.Hash"}}),__denumerate(conbo.Hash.prototype),conbo.LocalHash=conbo.Hash.extend({__construct:function(a){var b="ConboLocalHash";a=conbo.defineDefaults(a,{name:b});var c=a.name,d=a.session?window.sessionStorage:window.localStorage;c==b&&conbo.warn("No name specified for "+this.toString+', using "'+b+'"');var e=function(){return c in d?JSON.parse(d.getItem(c)||"{}"):a.source||{}};this.addEventListener(conbo.ConboEvent.CHANGE,function(a){d.setItem(c,JSON.stringify(this.toJSON()))},this,1e3),a.source=e(),conbo.Hash.prototype.__construct.call(this,a)},flush:function(){this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE))},toString:function(){return"conbo.LocalHash"}}),__denumerate(conbo.LocalHash.prototype),conbo.List=conbo.EventDispatcher.extend({itemClass:conbo.Hash,__construct:function(a){this.addEventListener(conbo.ConboEvent.CHANGE,this.__changeHandler,this,999);var b=["context","itemClass"];conbo.setValues(this,conbo.pick(a,b)),this.source=a.source||[]},get source(){return this.__source||(this.__source=[]),this.__source},set source(a){this.__source=[],this.push.apply(this,conbo.toArray(a)),this.dispatchChange("source","length")},get length(){return this.source?this.source.length:0},push:function(a){var b=conbo.toArray(arguments);return b.length&&(this.source.push.apply(this.source,this.__applyItemClass(b)),this.__updateBindings(b),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),this.dispatchChange("length")),this.length},pop:function(){if(this.length){var a=this.source.pop();return this.__updateBindings(a,!1),
this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),this.dispatchChange("length"),a}},unshift:function(a){return a&&(this.source.unshift.apply(this.source,this.__applyItemClass(conbo.toArray(arguments))),this.__updateBindings(conbo.toArray(arguments)),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),this.dispatchChange("length")),this.length},shift:function(){if(this.length){var a=this.source.shift();return this.__updateBindings(a,!1),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),this.dispatchChange("length"),a}},slice:function(a,b){return a||(a=0),conbo.isUndefined(b)&&(b=this.length),new conbo.List({source:this.source.slice(a,b)})},splice:function(a,b){a||(a=0),conbo.isUndefined(b)&&(b=this.length);var c=conbo.rest(arguments,2),d=this.source.splice.apply(this.source,[a,b].concat(c));return d.length&&this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),c.length&&this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),(d.length||c.length)&&this.dispatchChange("length"),new conbo.List({source:d})},getItemAt:function(a){return this.source[a]},setItemAt:function(a,b){var c=this.length,d=this.source[a];return this.__updateBindings(d,!1),this.source[a]=model,this.__updateBindings(model),this.length>c&&(this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD)),this.dispatchChange("length")),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE,{item:b})),d},sort:function(a){return this.source.sort(a),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE)),this},clone:function(){return new this.constructor(this.source)},toJSON:function(){return conbo.jsonify(this.source)},toString:function(){return"conbo.List"},__updateBindings:function(a,b){var c=b===!1?"removeEventListener":"addEventListener";for(a=(conbo.isArray(a)?a:[a]).slice();a.length;){var d=a.pop();d instanceof conbo.EventDispatcher&&d[c](conbo.ConboEvent.CHANGE,this.dispatchEvent,this)}},__changeHandler:function(a){var b,c=function(a){Object.defineProperty(this,a,{get:function(){return this.getItemAt(a)},set:function(b){this.setItemAt(a,b)},configurable:!0,enumerable:!0})}.bind(this);for(b=0;b<this.length;b++)c(b);for(;b in this;)delete this[b++]},__applyItemClass:function(a){if(a instanceof Array){for(var b=0;b<a.length;b++)a[b]=this.__applyItemClass(a[b]);return a}return!conbo.isObject(a)||conbo.isClass(a)||a instanceof conbo.Class||(a=new this.itemClass({source:a,context:this.context})),a}}).implement(conbo.IInjectable);var listMethods=["forEach","map","find","findIndex","filter","reject","every","contains","invoke","indexOf","lastIndexOf","max","min","toArray","size","rest","last","without","shuffle","isEmpty","sortOn"];listMethods.forEach(function(a){a in conbo&&(conbo.List.prototype[a]=function(){var b=[this.source].concat(conbo.toArray(arguments)),c=conbo[a].apply(conbo,b);return conbo.isArray(c)?new conbo.List({source:c,itemClass:this.itemClass}):c})}),__denumerate(conbo.List.prototype),conbo.LocalList=conbo.List.extend({__construct:function(a){var b="ConboLocalList";a=conbo.defineDefaults(a,this.options,{name:b});var c=a.name,d=a.session?window.sessionStorage:window.localStorage;c==b&&conbo.warn("No name specified for "+this.toString+', using "'+b+'"');var e=function(){return c in d?JSON.parse(d.getItem(c)||"[]"):a.source||[]};this.addEventListener(conbo.ConboEvent.CHANGE,function(a){d.setItem(c,JSON.stringify(this))},this,1e3),a.source=e(),conbo.List.prototype.__construct.call(this,a)},flush:function(){this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE))},toString:function(){return"conbo.LocalList"}}),__denumerate(conbo.LocalList.prototype),conbo.AttributeBindings=conbo.Class.extend({initialize:function(){this.cbClass.multiple=!0,this.cbStyle.multiple=!0,this.cbIncludeIn.raw=!0,this.cbExcludeFrom.raw=!0},canHandleMultiple:function(a){var b=conbo.toCamelCase(a);return b in this?!!this[b].multiple:!1},cbShow:function(a,b){this.cbHide(a,!b)},cbHide:function(a,b){var c=__ep(a);b?c.addClass("cb-hide"):c.removeClass("cb-hide")},cbInclude:function(a,b){this.cbExclude(a,!b)},cbExclude:function(a,b){var c=__ep(a);b?c.addClass("cb-exclude"):c.removeClass("cb-exclude")},cbEnabled:function(a,b){a.disabled=!b},cbHtml:function(a,b){a.innerHTML=b},cbText:function(a,b){b=conbo.encodeEntities(b).replace(/\r?\n|\r/g,"<br/>"),a.innerHTML=b},cbClass:function(a,b,c,d){d||conbo.warn('cb-class attributes must specify one or more CSS classes in the format cb-class="myProperty:class-name"'),b?__ep(a).addClass(d):__ep(a).removeClass(d)},cbClasses:function(a,b){a.cbClasses&&__ep(a).removeClass(a.cbClasses),a.cbClasses=b,b&&__ep(a).addClass(b)},cbStyle:function(a,b,c,d){d||conbo.warn('cb-style attributes must specify one or more styles in the format cb-style="myProperty:style-name"'),d=conbo.toCamelCase(d),a.style[d]=b},cbRepeat:function(a,b,c,d){var e,f,g=conbo.toArray(arguments),h=__ep(a);c||(c={}),c.context&&c.context.namespace&&(d||(d=conbo.toCamelCase(a.tagName,!0)),f=conbo.bindingUtils.getClass(d,c.context.namespace)),f||(f=conbo.ItemRenderer),a.cbRepeat||(a.cbRepeat={});var i=a.cbRepeat.elements||[];switch(h.removeClass("cb-exclude"),a.cbRepeat.list!=b&&b instanceof conbo.List&&(a.cbRepeat.list&&a.cbRepeat.list.removeEventListener("change",a.cbRepeat.changeHandler),a.cbRepeat.changeHandler=function(a){this.cbRepeat.apply(this,g)}.bind(this),b.addEventListener("change",a.cbRepeat.changeHandler),a.cbRepeat.list=b),!0){case b instanceof Array:case b instanceof conbo.List:e=b;break;default:e=conbo.isIterable(b)?conbo.toArray(b):[]}for(i.length&&i[0].parentNode&&i[0].parentNode.insertBefore(a,i[0]);i.length;){var j=i.pop(),k=j.cbView||j.cbGlimpse;k?k.remove():j.parentNode.removeChild(j)}for(var l=0,m=e.length;m>l;++l){var n=e[l],o=a.cloneNode(!0);!conbo.isObject(n)||n instanceof conbo.Hash||(n=new conbo.Hash({source:n})),o.removeAttribute("cb-repeat");var p={data:n,el:o,index:l,isLast:l==e.length-1,list:e,className:"cb-repeat"},q=new f(conbo.setValues(p,c));i.push(q.el)}var r=document.createDocumentFragment();i.forEach(function(a){r.appendChild(a)}),a.parentNode.insertBefore(r,a),a.cbRepeat.elements=i,i.length?a.parentNode.removeChild(a):a.className+=" cb-exclude"},cbDataset:function(a,b){conbo.isObject(b)&&conbo.setValues(a.dataset,b)},cbData:function(a,b){a.cbGlimpse?a.cbGlimpse.data=b:this.cbDataset(a,b)},cbIncludeIn:function(a,b,c){var d=c.view,e=b.split(" "),f=function(){this.cbInclude(a,-1!=e.indexOf(d.currentState))}.bind(this);d.addEventListener("change:currentState",f,this),f.call(this)},cbExcludeFrom:function(a,b,c){var d=c.view,e=b.split(" "),f=function(){this.cbExclude(a,-1!=e.indexOf(d.currentState))};d.addEventListener("change:currentState",f,this),f.call(this)},cbRemove:function(a,b){b&&a.parentNode.removeChild(a)},cbKeep:function(a,b){this.cbRemove(a,!b)},cbOnbind:function(a,b){a.addEventListener("bind",b)},cbJshref:function(a){"A"==a.tagName&&(a.onclick=function(b){return window.location=a.href,b.preventDefault(),!1})},cbDetectChange:function(a,b){var c=__ep(a),d=c.closest("form"),e=__ep(d),f=a.value||a.innerHTML,g=function(){e.removeClass("cb-changed cb-unchanged").addClass(d.querySelector(".cb-changed")?"cb-changed":"cb-unchanged")},h=function(){var b=(a.value||a.innerHTML)!=f;c.removeClass("cb-changed cb-unchanged").addClass(b?"cb-changed":"cb-unchanged"),g()};c.addEventListener("change input",h).addClass("cb-unchanged"),g()},cbValidate:function(a,b){var c;switch(!0){case conbo.isFunction(b):c=b;break;case conbo.isString(b):b=new RegExp(b);case conbo.isRegExp(b):c=function(a){return b.test(a)}}if(!conbo.isFunction(c))return void conbo.warn(b+" cannot be used with cb-validate");var d=__ep(a),e=d.closest("form"),f=function(a){return function(b){return b.split(/\s+/).filter(function(b){return a.test(b)}).join(" ")}},g=function(){var b=a.value||a.innerHTML,g=c(b),h=g===!0,i=[];if(i.push(h?"cb-valid":"cb-invalid"),conbo.isString(g)&&i.push("cb-invalid-"+g),d.removeClass("cb-valid cb-invalid").removeClass(f(/^cb-invalid-/)).addClass(i.join(" ")),e){var j=__ep(e);j.removeClass("cb-valid cb-invalid").removeClass(f(/^cb-invalid-/)),h&&(h=!e.querySelector(".cb-invalid"),h&&conbo.toArray(e.querySelectorAll("[required]")).forEach(function(a){return String(a.value||a.innerHTML).trim()?void 0:(h=!1,!1)})),j.addClass(h?"cb-valid":"cb-invalid")}};d.addEventListener("change input blur",g)},cbRestrict:function(a,b){a.cbRestrict&&a.removeEventListener("keypress",a.cbRestrict),a.cbRestrict=function(a){if(!a.ctrlKey){var c=a.keyCode||a.which,d=a.key||String.fromCharCode(c),e=b;conbo.isRegExp(e)||(e=new RegExp("["+e+"]","g")),d.match(e)||a.preventDefault()}},a.addEventListener("keypress",a.cbRestrict)},cbMaxChars:function(a,b){a.cbMaxChars&&a.removeEventListener("keypress",a.cbMaxChars),a.cbMaxChars=function(c){(a.value||a.innerHTML).length>=b&&c.preventDefault()},a.addEventListener("keypress",a.cbMaxChars)}}),function(){var BindingUtils__cbAttrs=new conbo.AttributeBindings,BindingUtils__customAttrs={},BindingUtils__reservedAttrs=["cb-app","cb-view","cb-glimpse","cb-content"],BindingUtils__reservedNamespaces=["cb","data","aria"],BindingUtils__registeredNamespaces=["cb"],BindingUtils__set=function(a,b){return this[a]===b?this:(b&&conbo.isString(b)&&!isNaN(b)&&(b=parseFloat(b),isNaN(b)&&(b="")),this[a]=b,this)},BindingUtils__isReservedAttr=function(a){return-1!=BindingUtils__reservedAttrs.indexOf(a)},BindingUtils__makeBindable=function(a,b){conbo.isAccessor(a,b)||(a instanceof conbo.EventDispatcher?conbo.makeBindable(a,[b]):conbo.warn('It will not be possible to detect changes to "'+b+'" because "'+a.toString()+'" is not an EventDispatcher'))},BindingUtils__cleanPropertyName=function(a){return(a||"").trim().replace(/[^\w\._\s]/g,"")};conbo.BindingUtils=conbo.Class.extend({removeAttributeAfterBinding:!0,bindElement:function(a,b,c,d){var e=a instanceof conbo.EventDispatcher;if(!c)throw new Error("el is undefined");BindingUtils__makeBindable(a,b);var f,g,h=[];d||(d=this.defaultParseFunction);var i=new conbo.EventProxy(c),j=c.tagName;switch(j){case"INPUT":case"SELECT":case"TEXTAREA":var k=(c.type||j).toLowerCase();switch(k){case"checkbox":return c.checked=!!a[b],e&&(f="change:"+b,g=function(a){c.checked=!!a.value},a.addEventListener(f,g),h.push([a,f,g])),f="input change",g=function(d){BindingUtils__set.call(a,b,c.checked)},i.addEventListener(f,g),void h.push([i,f,g]);case"radio":c.value==a[b]&&(c.checked=!0),e&&(f="change:"+b,g=function(a){null==a.value&&(a.value=""),c.value==a.value&&(c.checked=!0)},a.addEventListener(f,g),h.push([a,f,g]));break;default:var l=function(){c.value=a[b]};"select"==k?conbo.defer(l):l(),e&&(f="change:"+b,g=function(a){null==a.value&&(a.value=""),c.value!=a.value&&(c.value=a.value)},a.addEventListener(f,g),h.push([a,f,g]))}f="input change",g=function(d){BindingUtils__set.call(a,b,c.value===undefined?c.innerHTML:c.value)},i.addEventListener(f,g),h.push([i,f,g]);break;default:c.innerHTML=d(a[b]),e&&(f="change:"+b,g=function(a){var b=d(a.value);c.innerHTML=b},a.addEventListener(f,g),h.push([a,f,g]))}return h},unbindElement:function(a,b,c){return this},bindAttribute:function(a,b,c,d,e,f){var g=[];if(BindingUtils__isReservedAttr(d))return g;if(!c)throw new Error("element is undefined");var h=d.split("-"),i=h.length>1;if(!i)return g;if("cb-bind"==d)return g=this.bindElement(a,b,c,e),this.removeAttributeAfterBinding&&c.removeAttribute(d),g;BindingUtils__makeBindable(a,b);var j,k,l=conbo.toArray(arguments).slice(5),m=conbo.toCamelCase(d),n=h[0],o="cb"==n,p=o&&m in BindingUtils__cbAttrs,q=!p&&m in BindingUtils__customAttrs,r=o&&2==h.length&&h[1]in c,s=BindingUtils__cbAttrs;switch(e||(e=this.defaultParseFunction),!0){case q:s=BindingUtils__customAttrs;case p:if(!(a instanceof conbo.EventDispatcher))return conbo.warn("Source is not EventDispatcher"),this;var t=s[m];t.raw?t.apply(s,[c,b].concat(l)):(k=function(d){t.apply(s,[c,e(a[b])].concat(l))},j="change:"+b,a.addEventListener(j,k),k(),g.push([a,j,k]));break;case r:var u=h[1];switch(!0){case 0!==u.indexOf("on")&&conbo.isFunction(c[u]):conbo.warn(d+" is not a recognised attribute, did you mean cb-on"+u+"?");break;case 0===u.indexOf("on"):if(!conbo.isFunction(a[b]))return conbo.warn(b+" is not a function and cannot be bound to DOM events"),this;j=u.substr(2),k=a[b],c.addEventListener(j,k),g.push([c,j,k]);break;default:if(!(a instanceof conbo.EventDispatcher))return conbo.warn("Source is not EventDispatcher"),this;k=function(){var d;d=e(a[b]),d=conbo.isBoolean(c[u])?!!d:d,c[u]=d},j="change:"+b,a.addEventListener(j,k),k(),g.push([a,j,k]);var v=new conbo.EventProxy(c);k=function(){BindingUtils__set.call(a,b,c[u])},j="input change",v.addEventListener(j,k),g.push([v,j,k])}break;default:conbo.warn(d+" is not recognised or does not exist on specified element")}return"cb-repeat"!==d&&this.removeAttributeAfterBinding&&c.removeAttribute(d),g},applyAttribute:function(a,b){if(this.attributeExists(b)){var c=conbo.toCamelCase(b),d=b.split("-")[0],e="cb"==d?BindingUtils__cbAttrs:BindingUtils__customAttrs,f=e[c];return f.readOnly?f.call(e,a):conbo.warn(attr+" attribute cannot be used without a value"),this}return conbo.warn(attr+" attribute does not exist"),this},attributeExists:function(a){var b=conbo.toCamelCase(a);return b in BindingUtils__cbAttrs||b in BindingUtils__customAttrs},bindView:function(view){if(!view)throw new Error("view is undefined");view.__bindings&&this.unbindView(view);var options={view:view},bindings=[],scope=this;view.subcontext&&view.subcontext.addTo(options);var ns=view.context&&view.context.namespace;ns&&this.applyViews(view,ns,"glimpse").applyViews(view,ns,"view");var ignored=[];view.querySelectorAll("[cb-repeat]").forEach(function(a){ignored=ignored.concat(conbo.toArray(a.querySelectorAll("*")))});var elements=conbo.difference(view.querySelectorAll("*").concat([view.el]),ignored);return elements.forEach(function(el,index){var attrs=__ep(el).attributes;if(conbo.keys(attrs).length){var keys=conbo.keys(attrs);-1!=keys.indexOf("cbRepeat")&&(keys=["cbRepeat"]),keys.forEach(function(key){var type=conbo.toUnderscoreCase(key,"-"),typeSplit=type.split("-");if(!(typeSplit.length<2||-1==BindingUtils__registeredNamespaces.indexOf(typeSplit[0])||BindingUtils__isReservedAttr(type))){var splits=attrs[key].split(",");BindingUtils__cbAttrs.canHandleMultiple(type)||(splits=[splits[0]]);for(var splitsLength=splits.length,i=0;splitsLength>i;i++){var parseFunction,d=splits[i];if(!d&&!conbo.isString(d)){scope.applyAttribute(el,type);break}var b=d.split("|"),v=b[0].split(":"),propertyName=v[0],param=v[1],split=BindingUtils__cleanPropertyName(propertyName).split("."),property=split.pop(),model;try{parseFunction=b[1]?eval("view."+BindingUtils__cleanPropertyName(b[1])):undefined,parseFunction=conbo.isFunction(parseFunction)?parseFunction:undefined}catch(e){}try{model=split.length?eval("view."+split.join(".")):view}catch(e){}if(!model)return void conbo.warn(propertyName+" is not defined in this View");var opts=conbo.defineValues({propertyName:property},options),args=[model,property,el,type,parseFunction,opts,param];bindings=bindings.concat(scope.bindAttribute.apply(scope,args))}conbo.defer(function(){var a;a=document.createEvent("CustomEvent"),a.initCustomEvent("bind",!1,!1,{}),el.dispatchEvent(a)})}})}}),__definePrivateProperty(view,"__bindings",bindings),this},unbindView:function(a){if(!a)throw new Error("view is undefined");if(!a.__bindings||!a.__bindings.length)return this;for(var b=a.__bindings;b.length;){var c=b.pop();try{c[0].removeEventListener(c[1],c[2])}catch(d){}}return delete a.__bindings,this},applyViews:function(a,b,c){if(c||(c="view"),-1==["view","glimpse"].indexOf(c))throw new Error(c+" is not a valid type parameter for applyView");var d=(conbo[c.charAt(0).toUpperCase()+c.slice(1)],this),e=conbo.isElement(a)?a:a.el;for(var f in b){var g=d.getClass(f,b),h=conbo.isClass(g,conbo.View),i=conbo.isClass(g,conbo.Glimpse)&&!h;if("glimpse"==c&&i||"view"==c&&h){var j=conbo.toKebabCase(f),k=conbo.toArray(e.querySelectorAll(j+":not(.cb-"+c+"):not([cb-repeat]), [cb-"+c+"="+f+"]:not(.cb-"+c+"):not([cb-repeat])"));k.forEach(function(b){var c=__ep(b),d=c.closest(".cb-view"),e=d?d.cbView.subcontext:a.subcontext;new g({el:b,context:e})})}}return this},bindProperty:function(a,b,c,d,e){if(!(a instanceof conbo.EventDispatcher))throw new Error(b+" source is not EventDispatcher");return d||(d=b),BindingUtils__makeBindable(a,b),a.addEventListener("change:"+b,function(a){return c instanceof conbo.EventDispatcher?void BindingUtils__set.call(c,d,a.value):void(c[d]=a.value)}),e&&c instanceof conbo.EventDispatcher&&this.bindProperty(c,d,a,b),this},bindSetter:function(a,b,c){if(!(a instanceof conbo.EventDispatcher))throw new Error("Source is not EventDispatcher");if(!conbo.isFunction(c)){if(!(c&&b in c))throw new Error("Invalid setter function");c=c[b]}return BindingUtils__makeBindable(a,b),a.addEventListener("change:"+b,function(a){c(a.value)}),this},defaultParseFunction:function(a){return"undefined"==typeof a?"":a},getClass:function(a,b){if(a&&b)try{var c=b[a];if(conbo.isClass(c))return c}catch(d){}},registerAttribute:function(a,b,c,d){if(!conbo.isString(a)||!conbo.isFunction(b))return conbo.warn("registerAttribute: both 'name' and 'handler' parameters are required"),this;var e=conbo.toUnderscoreCase(a).split("_");if(e.length<2)return conbo.warn("registerAttribute: "+a+" does not include a namespace, e.g. "+conbo.toCamelCase("my-"+a)),this;var f=e[0];return-1!=BindingUtils__reservedNamespaces.indexOf(f)?(conbo.warn("registerAttribute: custom attributes cannot to use the "+f+" namespace"),this):(BindingUtils__registeredNamespaces=conbo.union(BindingUtils__registeredNamespaces,[f]),conbo.setValues(b,{readOnly:!!c,raw:!!d}),BindingUtils__customAttrs[a]=b,this)},registerAttributes:function(a,b){for(var c in a)this.addAttribute(c,a[c],b);return this},toString:function(){return"conbo.BindingUtils"}}),conbo.bindingUtils=new conbo.BindingUtils}(),conbo.MutationObserver=conbo.EventDispatcher.extend({initialize:function(){this.bindAll()},observe:function(a){if(this.disconnect(),a){var b=window.MutationObserver||window.WebKitMutationObserver;if(b){var c=new b(function(a,b){var c=a[0].addedNodes,d=a[0].removedNodes;c.length&&this.__addHandler(conbo.toArray(c)),a[0].removedNodes.length&&this.__removeHandler(conbo.toArray(d))}.bind(this));c.observe(a,{childList:!0,subtree:!0}),this.__mo=c}else a.addEventListener("DOMNodeInserted",this.__addHandler),a.addEventListener("DOMNodeRemoved",this.__removeHandler),this.__el=a;return this}},disconnect:function(){var a=this.__mo,b=this.__el;return a&&a.disconnect(),b&&(b.removeEventListener("DOMNodeInserted",this.__addHandler),b.removeEventListener("DOMNodeRemoved",this.__removeHandler)),this},__addHandler:function(a){var b=conbo.isArray(a)?a:[a.target];this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ADD,{nodes:b}))},__removeHandler:function(a){var b=conbo.isArray(a)?a:[a.target];this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE,{nodes:b}))}}),function(){var a=function(){this.removeEventListener()};conbo.Promise=conbo.EventDispatcher.extend({initialize:function(b){this.bindAll("dispatchResult","dispatchFault").addEventListener("result fault",a,this,Number.NEGATIVE_INFINITY),this.resolve=this.dispatchResult,this.reject=this.dispatchFault,conbo.isFunction(b)&&b(dispatchResult,dispatchFault)},dispatchResult:function(a){return this.dispatchEvent(new conbo.ConboEvent("result",{result:a})),this},dispatchFault:function(a){return this.dispatchEvent(new conbo.ConboEvent("fault",{fault:a})),this},then:function(a,b,c){return a&&this.addEventListener("result",a,c),b&&this.addEventListener("fault",b,c),this},"catch":function(a,b){return a&&this.addEventListener("fault",a,b),this},toString:function(){return"conbo.Promise"}})}(),conbo.ElementProxy=conbo.EventProxy.extend({getAttributes:function(){var a=this.__obj,b={};return a&&conbo.forEach(a.attributes,function(a){b[conbo.toCamelCase(a.name)]=a.value}),b},setAttributes:function(a){var b=this.__obj;return b&&a&&conbo.forEach(a,function(a,c){b.setAttribute(conbo.toKebabCase(c),a)}),this},get attributes(){return this.getAttributes()},set attributes(a){return this.setAttributes(a)},get cbAttributes(){var a=this.__obj,b={};return a&&conbo.forEach(a.attributes,function(a){0===a.name.indexOf("cb-")&&(b[conbo.toCamelCase(a.name.substr(3))]=a.value)}),b},addClass:function(a){var b=this.__obj;if(b&&a){var c=a.trim().split(" "),d=(b.className||"").trim().split(" ").concat(c);b.className=conbo.uniq(conbo.compact(d)).join(" ")}return this},removeClass:function(a){var b=this.__obj;if(b&&a){conbo.isFunction(a)&&(a=a(b.className));var c=(b.className||"").trim().split(" "),d=a.trim().split(" ");c=conbo.difference(c,d),b.className=conbo.uniq(conbo.compact(c)).join(" ")}return this},hasClass:function(a){var b=this.__obj;if(b&&a){var c=(b.className||"").trim().split(" ");return-1!=c.indexOf(a)}return!1},closest:function(a){var b=this.__obj;if(b){var c;["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(a){return"function"==typeof document.body[a]?(c=a,!0):!1});for(var d;b;){if(d=b.parentElement,d&&d[c](a))return d;b=d}}}}),conbo.IDataRenderer={data:undefined,index:-1,isLast:!1,list:undefined},conbo.Glimpse=conbo.EventDispatcher.extend({__construct:function(a){this.__setEl(a.el||document.createElement(this.tagName)),a.context&&(this.context=a.context),this.template&&(this.el.innerHTML=this.template)},get tagName(){return this.__tagName||"div"},set tagName(a){__definePrivateProperty(this,"__tagName",a)},get el(){return this.__el},toString:function(){return"conbo.Glimpse"},__setEl:function(a){var b=conbo.setValues({},this.attributes);this.id&&!a.id&&(b.id=this.id),a.className+=" cb-glimpse "+(this.className||""),a.cbGlimpse=this;for(var c in b)a.setAttribute(conbo.toKebabCase(c),b[c]);return this.style&&(a.style=conbo.setValues(a.style,this.style)),__definePrivateProperty(this,"__el",a),this}}),__denumerate(conbo.Glimpse.prototype);var View__templateCache={};return conbo.View=conbo.Glimpse.extend({__construct:function(a){a=conbo.clone(a)||{},a.className&&this.className&&(a.className+=" "+this.className);var b=conbo.union(["attributes","className","data","id","style","tagName","template","templateUrl","templateCacheEnabled","autoInitTemplate"],conbo.intersection(conbo.variables(this,!0),conbo.variables(a)));conbo.setValues(this,conbo.pick(a,b)),conbo.makeBindable(this,["currentState"]),this.context=a.context,this.__setEl(a.el||document.createElement(this.tagName))},__postInitialize:function(a){__definePrivateProperty(this,"__initialized",!0),this.__content=this.el.innerHTML,this.autoInitTemplate!==!1&&this.initTemplate()},get el(){return this.__el},get initialized(){return!!this.__initialized},get parent(){return this.initialized?this.__getParent(".cb-view"):void 0},get parentApp(){return this.initialized?this.__getParent(".cb-app"):void 0},get hasTemplate(){return!(!this.template&&!this.templateUrl)},get content(){return this.querySelector("[cb-content]")},get hasContent(){return!!this.content},get body(){return this.content||this.el},get subcontext(){return this.__subcontext||this.context},set subcontext(a){this.__subcontext=a},querySelector:function(a,b){return this.querySelectorAll(a,b)[0]},querySelectorAll:function(a,b){if(this.el){var c=conbo.toArray(this.el.querySelectorAll(a));if(!b){var d=this.el.querySelectorAll(".cb-view, [cb-view], [cb-app]");conbo.forEach(d,function(b){var d=conbo.toArray(b.querySelectorAll(a));c=conbo.difference(c,d.concat(b))})}return c}return[]},detach:function(){var a=this.el;return a.parentNode&&(a.parentNode.removeChild(a),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.DETACH))),this},remove:function(){return this.unbindView().removeEventListener(),this.data&&(this.data=undefined),this.context&&(this.context.uninjectSingletons(this).removeEventListener(undefined,undefined,this),this.context=undefined),this.detach().dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.REMOVE)),this},appendView:function(a){if(arguments.length>1)return conbo.forEach(arguments,function(a,b,c){this.appendView(a)},this),this;if(!(a instanceof conbo.View))throw new Error("Parameter must be instance of conbo.View class");return this.body.appendChild(a.el),this},prependView:function(a){if(arguments.length>1)return conbo.forEach(arguments,function(a,b,c){this.prependView(a)},this),this;if(!(a instanceof conbo.View))throw new Error("Parameter must be instance of conbo.View class");var b=this.body.firstChild;return b?this.body.insertBefore(a.el,b):this.appendView(a),this},bindView:function(){return conbo.bindingUtils.bindView(this),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.BIND)),this},unbindView:function(){return conbo.bindingUtils.unbindView(this),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.UNBIND)),this},initTemplate:function(){var a=this.template;return this.templateUrl?this.loadTemplate():(conbo.isFunction(a)&&(a=a(this)),conbo.isString(a)&&(this.el.innerHTML=a),this.__initView()),this},loadTemplate:function(a){a||(a=this.templateUrl);var b=this.body;if(this.unbindView(),this.templateCacheEnabled!==!1&&View__templateCache[a])return b.innerHTML=View__templateCache[a],this.__initView(),this;var c=function(c){var d=c.result;this.templateCacheEnabled!==!1&&(View__templateCache[a]=d),b.innerHTML=d,this.__initView()},d=function(a){b.innerHTML="",this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.TEMPLATE_ERROR)),this.__initView()};return conbo.httpRequest({url:a,dataType:"text"}).then(c,d,this),this},toString:function(){return"conbo.View"},__setEl:function(a){if(!conbo.isElement(a))return void conbo.error("Invalid element passed to View");var b=conbo.setValues({},this.attributes);this.id&&!a.id&&(b.id=this.id),this.style&&conbo.setValues(a.style,this.style);var c=__ep(a);return a.cbView=this,c.addClass("cb-view").addClass(this.className).setAttributes(b),__definePrivateProperty(this,"__el",a),this},__initView:function(){return this.hasTemplate&&this.hasContent&&(this.content.innerHTML=this.__content),delete this.__content,this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.TEMPLATE_COMPLETE)).bindView(),conbo.defer(function(){this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CREATION_COMPLETE))},this),this},__getParent:function(a){var b=__ep(this.el).closest(a);return b?b.cbView:void 0}}),__denumerate(conbo.View.prototype),conbo.ItemRenderer=conbo.View.extend().implement(conbo.IDataRenderer),conbo.Application=conbo.View.extend({__construct:function(a){if(a=conbo.clone(a)||{},!(this.namespace instanceof conbo.Namespace))throw new Error("Application namespace must be an instance of conbo.Namespace");a.app=this,a.context=new this.contextClass(a),a.el||(a.el=this.__findAppElement()),conbo.View.prototype.__construct.call(this,a)},get contextClass(){return this.__contextClass||conbo.Context},set contextClass(a){this.__contextClass=a},get observeEnabled(){return!!this.__mo},set observeEnabled(a){if(a!=this.observeEnabled){var b;return a?(b=new conbo.MutationObserver,b.observe(this.el),b.addEventListener(conbo.ConboEvent.ADD,function(a){conbo.bindingUtils.applyViews(this,this.namespace).applyViews(this,this.namespace,"glimpse")},this),this.__mo=b):this.__mo&&(b=this.__mo,b.removeEventListener(),b.disconnect(),delete this.__mo),this.dispatchChange("observeEnabled"),this}},toString:function(){return"conbo.Application"},__setEl:function(a){return conbo.View.prototype.__setEl.call(this,a),__ep(this.el).addClass("cb-app"),this},__findAppElement:function(){var a=$("[cb-app]");if(!a.length)return undefined;if(!this.namespace)return a.length&&conbo.warn("Application namespace not specified: unable to bind to cb-app element"),undefined;var b;for(var c in this.namespace)if(conbo.isClass(this.namespace[c])&&this instanceof this.namespace[c]){b=c;break}if(!b)return undefined;var d='[cb-app="'+b+'"]',e=$(d)[0];return e||undefined}}),__denumerate(conbo.Application.prototype),conbo.Command=conbo.EventDispatcher.extend({__construct:function(a){this.context=a.context,this.event=a.event||{}},execute:function(){},toString:function(){return"conbo.Command"}}).implement(conbo.IInjectable),__denumerate(conbo.Command.prototype),conbo.httpRequest=function(options){if(conbo.isString(options)&&(options={url:options,data:arguments[1],method:arguments[2]}),!conbo.isObject(options)||!options.url)throw new Error("httpRequest called without specifying a URL");var promise=new conbo.Promise,xhr=new window.XMLHttpRequest,aborted,url=options.url,method=(options.method||options.type||"GET").toUpperCase(),data=options.data||options.body,headers=options.headers||{},timeoutTimer,contentType=conbo.getValue(headers,"Content-Type",!1)||options.contentType||conbo.CONTENT_TYPE_JSON,dataType=options.dataType||conbo.DATA_TYPE_JSON,decodeFunction=options.decodeFunction||options.dataFilter,getXml=function(){if("document"===xhr.responseType)return xhr.responseXML;var a=xhr.responseXML&&"parsererror"===xhr.responseXML.documentElement.nodeName;return""!==xhr.responseType||a?null:xhr.responseXML},getResult=function(){var result=xhr.response||xhr.responseText||getXml(xhr);if(conbo.isFunction(decodeFunction))result=decodeFunction(result);else switch(dataType){case conbo.DATA_TYPE_SCRIPT:(function(){eval(result)}).call(options.scope||window);break;case conbo.DATA_TYPE_JSON:try{result=JSON.parse(result)}catch(e){result=undefined}break;case conbo.DATA_TYPE_TEXT:}var resultClass=options.resultClass;if(!resultClass&&options.makeObjectsBindable)switch(!0){case conbo.isArray(result):resultClass=conbo.List;break;case conbo.isObject(result):resultClass=conbo.Hash}return resultClass&&(result=new resultClass({source:result})),result},getResponseHeaders=function(){var a=xhr.getAllResponseHeaders(),b={};return a.split("\r\n").forEach(function(a){var c=a.indexOf(":"),d=a.substr(0,c).trim();b[d]=a.substr(c+1).trim()}),b},errorHandler=function(){clearTimeout(timeoutTimer);var a={fault:getResult(),responseHeaders:getResponseHeaders(),status:xhr.status,method:method,url:url,xhr:xhr};promise.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.FAULT,a))},loadHandler=function(){if(!aborted){clearTimeout(timeoutTimer);var a=1223===xhr.status?204:xhr.status;if(0===a||a>=400)return void errorHandler();var b={result:getResult(),responseHeaders:getResponseHeaders(),status:a,method:method,url:url,xhr:xhr};promise.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.RESULT,b))}},readyStateChangeHandler=function(){4===xhr.readyState&&conbo.defer(loadHandler)};if("GET"!==method&&"HEAD"!==method)conbo.getValue(headers,"Content-Type",!1)||(headers["Content-Type"]=contentType),contentType==conbo.CONTENT_TYPE_JSON&&conbo.isObject(data)&&(data=JSON.stringify(data));else if("GET"===method&&conbo.isObject(data)){var query=conbo.toQueryString(data);query&&(url+="?"+query),data=undefined}"onload"in xhr?xhr.onload=loadHandler:xhr.onreadystatechange=readyStateChangeHandler,xhr.onerror=errorHandler,xhr.onprogress=function(){},xhr.onabort=function(){aborted=!0},xhr.ontimeout=errorHandler,xhr.open(method,url,!0,options.username,options.password),xhr.withCredentials=!!options.withCredentials,options.timeout>0&&(timeoutTimer=setTimeout(function(){aborted||(aborted=!0,xhr.abort("timeout"),errorHandler())},options.timeout));for(var key in headers)headers.hasOwnProperty(key)&&xhr.setRequestHeader(key,headers[key]);return"responseType"in options&&(xhr.responseType=options.responseType),"function"==typeof options.beforeSend&&options.beforeSend(xhr),xhr.send(data||null),promise},conbo.HttpService=conbo.EventDispatcher.extend({__construct:function(a){a=conbo.setDefaults(a,{contentType:conbo.CONTENT_TYPE_JSON}),conbo.setValues(this,conbo.setDefaults(conbo.pick(a,"rootUrl","contentType","dataType","headers","encodeFunction","decodeFunction","resultClass","makeObjectsBindable"),{dataType:"json"}));var b=["POST","GET","PUT","PATCH","DELETE"];b.forEach(function(a){
this[a.toLowerCase()]=function(b,c,d,e){return this.call(b,c,a,e)}},this),conbo.EventDispatcher.prototype.__construct.apply(this,arguments)},get rootUrl(){return this._rootUrl||""},set rootUrl(a){a=String(a),a&&"/"!=a.slice(-1)&&(a+="/"),this._rootUrl=a},call:function(a,b,c,d){b=conbo.clone(b||{}),a=this.parseUrl(a,b),b=this.encodeFunction(b,c);var e=conbo.httpRequest({data:b,type:c||"GET",headers:this.headers,url:this.rootUrl+a,contentType:this.contentType||conbo.CONTENT_TYPE_JSON,dataType:this.dataType,dataFilter:this.decodeFunction,resultClass:d||this.resultClass,makeObjectsBindable:this.makeObjectsBindable});return e.then(this.dispatchEvent,this.dispatchEvent,this),e},addCommand:function(a,b,c){return conbo.isObject(a)&&(b=a.method,c=a.resultClass,a=a.command),this[conbo.toCamelCase(a)]=function(d){return this.call(a,d,b,c)},this},addCommands:function(a){return conbo.isArray(a)?(a.forEach(function(a){this.addCommand(a)},this),this):this},encodeFunction:function(a,b){return a},parseUrl:function(a,b){var c=a,d=c.match(/:\b\w+\b/g);return d&&d.forEach(function(a){if(a=a.substr(1),!(a in b))throw new Error('Property "'+a+'" required but not found in data')}),conbo.keys(b).forEach(function(a){var d=new RegExp(":\\b"+a+"\\b","g");d.test(c)&&(c=c.replace(d,b[a]),delete b[a])}),c},toString:function(){return"conbo.HttpService"}}).implement(conbo.IInjectable),conbo.ISyncable={load:conbo.notImplemented,save:conbo.notImplemented,destroy:conbo.notImplemented},conbo.RemoteHash=conbo.Hash.extend({__construct:function(a){a=conbo.defineDefaults(a,this.options),a.context&&(this.context=a.context),this.preinitialize(a),this._httpService=new conbo.HttpService(a),this._command=a.command;var b=function(a){conbo.makeBindable(this,conbo.variables(a.result)),conbo.setValues(this,a.result),this.dispatchEvent(a)};this._httpService.addEventListener(conbo.ConboEvent.RESULT,b,this).addEventListener(conbo.ConboEvent.FAULT,this.dispatchEvent,this),__denumerate(this),conbo.Hash.prototype.__construct.apply(this,arguments)},load:function(a){return a=arguments.length?a:this.toJSON(),this._httpService.call(this._command,a,"GET"),this},save:function(){return this._httpService.call(this._command,this.toJSON(),"POST"),this},destroy:function(){return this._httpService.call(this._command,this.toJSON(),"DELETE"),this},toString:function(){return"conbo.RemoteHash"}}).implement(conbo.ISyncable),__denumerate(conbo.HttpService.prototype),conbo.RemoteList=conbo.List.extend({__construct:function(a){a=conbo.defineDefaults(a,this.options),this.context=a.context,this._httpService=new conbo.HttpService(a),this._command=a.command;var b=function(a){this.source=a.result,this.dispatchEvent(a)};this._httpService.addEventListener(conbo.ConboEvent.RESULT,b,this).addEventListener(conbo.ConboEvent.FAULT,this.dispatchEvent,this),__denumerate(this),conbo.List.prototype.__construct.apply(this,arguments)},load:function(){return this._httpService.call(this._command,this.toJSON(),"GET"),this},save:function(){return this._httpService.call(this._command,this.toJSON(),"POST"),this},destroy:function(){},toString:function(){return"conbo.RemoteList"}}).implement(conbo.ISyncable,conbo.IPreinitialize),__denumerate(conbo.HttpService.prototype),conbo.History=conbo.EventDispatcher.extend({__construct:function(a){this.handlers=[],this.location=window.location,this.history=window.history,this.bindAll("__checkUrl")},start:function(a){return a||(a={}),window.addEventListener("hashchange",this.__checkUrl),this.fragment=this.__getFragment(),a.trigger!==!1&&this.__loadUrl(),this},stop:function(){return window.removeEventListener("hashchange",this.__checkUrl),this},addRoute:function(a,b){return this.handlers.unshift({route:a,callback:b}),this},getPath:function(){var a=this.location.href.match(/#!?(.*)$/);return a?a[1]:""},setPath:function(a,b){if(b||(b={}),a=this.__getFragment(a),this.fragment!==a){var c=this.location;if(this.fragment=a,b.replace){var d=c.href.replace(/(javascript:|#).*$/,"");c.replace(d+"#!/"+a)}else c.hash="#!/"+a;return b.trigger&&this.__loadUrl(a),this}},__checkUrl:function(a){var b=this.__getFragment()!==this.fragment;return b&&(this.__loadUrl(),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.CHANGE))),!b},__getFragment:function(a){return(a||this.getPath()).replace(/^#!|^[#\/]|\s+$/g,"")},__loadUrl:function(a){var b=this.fragment=this.__getFragment(a),c=conbo.some(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c||this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.FAULT)),c}}),conbo.Router=conbo.EventDispatcher.extend({__construct:function(a){a.routes&&(this.routes=a.routes),this.historyClass=conbo.History,this.context=a.context},start:function(a){return this.__history||(this.__history=new this.historyClass,this.__bindRoutes(),this.__history.addEventListener(conbo.ConboEvent.FAULT,this.dispatchEvent,this).addEventListener(conbo.ConboEvent.CHANGE,this.dispatchEvent,this).start(a),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.START))),this},stop:function(){return this.__history&&(this.__history.removeEventListener().stop(),delete this.__history,this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.STOP))),this},addRoute:function(a,b,c){var d=conbo.isRegExp(a)?a:this.__routeToRegExp(a);return c||(c=this[b]),conbo.isFunction(b)&&(c=b,b=""),c||(c=this[b]),this.__history.addRoute(d,function(e){var f=this.__extractParameters(d,e),g=conbo.isString(a)?conbo.object((a.match(/:\w+/g)||[]).map(function(a){return a.substr(1)}),f):{};c&&c.apply(this,f);var h={router:this,route:d,name:b,parameters:f,params:g,path:e};this.dispatchEvent(new conbo.ConboEvent("route:"+b,h)),this.dispatchEvent(new conbo.ConboEvent(conbo.ConboEvent.ROUTE,h))}.bind(this)),this},setPath:function(a,b){return b=conbo.setDefaults({},b,{trigger:!0}),this.__history.setPath(a,b),this},get path(){return this.__history?this.__history.getPath():""},set path(a){return this.setPath(a)},toString:function(){return"conbo.Router"},__bindRoutes:function(){if(this.routes)for(var a,b=conbo.keys(this.routes);null!=(a=b.pop());)this.addRoute(a,this.routes[a])},__routeToRegExp:function(a){var b=/^\/+|\/+$/g,c=/\((.*?)\)/g,d=/(\(\?)?:\w+/g,e=/\*\w+/g,f=/[\-{}\[\]+?.,\\\^$|#\s]/g;return a=a.replace(b,"").replace(f,"\\$&").replace(c,"(?:$1)?").replace(d,function(a,b){return b?a:"([^/]+)"}).replace(e,"(.*?)"),new RegExp("^"+a+"$")},__extractParameters:function(a,b){var c=a.exec(b).slice(1);return conbo.map(c,function(a){if(a)try{return decodeURIComponent(a)}catch(b){return unescape(a)}return null})}}).implement(conbo.IInjectable),__denumerate(conbo.Router.prototype),conbo.ready(function(){!conbo.isNode&&conbo.info("%c"+conbo.toString(),"font-weight:bold")}),conbo});